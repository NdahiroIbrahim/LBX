(function(g){var window=this;'use strict';var qjB=function(N){var p=new g.ki("und",new g.Sa("Default","und",!0));p.captionTracks=N.captionTracks;return p},Nu0=function(N){return new g.JB(function(p,S){var O=N.length,P=[];
if(O)for(var W=function(h,x){O--;P[h]=x;O==0&&p(P)},X=function(h){S(h)},l,b=0;b<N.length;b++)l=N[b],g.pUS(l,g.RH(W,b),X);
else p(P)})},G1=function(N){this.T=N},dr=function(){G1.apply(this,arguments)},ppd=function(){dr.apply(this,arguments)},ohf=function(){dr.apply(this,arguments)},SSB=function(){dr.apply(this,arguments)},O8E=function(){dr.apply(this,arguments)},PWC=function(){dr.apply(this,arguments)},Wny=function(){G1.apply(this,arguments)},XpB=function(){dr.apply(this,arguments)},fjB=function(){dr.apply(this,arguments)},ljB=function(){dr.apply(this,arguments)},b8f=function(){dr.apply(this,arguments)},jnl=function(){dr.apply(this,
arguments)},sn0=function(){dr.apply(this,arguments)},h8E=function(){dr.apply(this,arguments)},x8Y=function(){dr.apply(this,arguments)},yOt=function(){dr.apply(this,arguments)},VZR=function(){dr.apply(this,arguments)},LnV=function(){dr.apply(this,arguments)},TuC=function(){dr.apply(this,arguments)},vhf=function(){G1.apply(this,arguments)},BuY=function(){dr.apply(this,arguments)},z8s=function(){dr.apply(this,arguments)},EhE=function(){dr.apply(this,arguments)},$8G=function(){dr.apply(this,arguments)},
JOy=function(){dr.apply(this,arguments)},m8q=function(){dr.apply(this,arguments)},U8t=function(){dr.apply(this,arguments)},H8l=function(){dr.apply(this,arguments)},i8Q=function(){dr.apply(this,arguments)},ajE=function(){G1.apply(this,arguments)},QnB=function(){G1.apply(this,arguments)},ght=function(){G1.apply(this,arguments)},cOy=function(){dr.apply(this,arguments)},Fnt=function(){dr.apply(this,arguments)},nhQ=function(){dr.apply(this,arguments)},rOB=function(){dr.apply(this,arguments)},MZC=function(){dr.apply(this,
arguments)},Knq=function(){dr.apply(this,arguments)},YSf=function(){dr.apply(this,arguments)},GzB=function(){dr.apply(this,arguments)},d8R=function(){dr.apply(this,arguments)},e8y=function(){dr.apply(this,arguments)},CWR=function(){dr.apply(this,arguments)},AOE=function(){dr.apply(this,arguments)},tZE=function(){dr.apply(this,arguments)},uAq=function(){dr.apply(this,arguments)},wpC=function(){dr.apply(this,arguments)},R80=function(){dr.apply(this,arguments)},IjR=function(){dr.apply(this,arguments)},
D8s=function(){dr.apply(this,arguments)},Z8C=function(){dr.apply(this,arguments)},kzR=function(){dr.apply(this,arguments)},qSy=function(){dr.apply(this,arguments)},N8t=function(){dr.apply(this,arguments)},p_l=function(){dr.apply(this,arguments)},o4d=function(){dr.apply(this,arguments)},SZy=function(){dr.apply(this,arguments)},OHy=function(){G1.apply(this,arguments)},PiC=function(){dr.apply(this,arguments)},WP0=function(){dr.apply(this,arguments)},X_d=function(){dr.apply(this,arguments)},fxB=function(){dr.apply(this,
arguments)},lxY=function(){dr.apply(this,arguments)},bHR=function(){dr.apply(this,arguments)},j2t=function(){dr.apply(this,arguments)},s2y=function(){dr.apply(this,arguments)},hJq=function(){dr.apply(this,arguments)},xqR=function(){dr.apply(this,arguments)},ynl=function(){dr.apply(this,arguments)},VLE=function(){dr.apply(this,arguments)},LPt=function(){dr.apply(this,arguments)},T8B=function(){dr.apply(this,arguments)},v4G=function(){dr.apply(this,arguments)},B8V=function(){dr.apply(this,arguments)},
zJf=function(){dr.apply(this,arguments)},E4f=function(){dr.apply(this,arguments)},$qQ=function(){dr.apply(this,arguments)},Jnd=function(){dr.apply(this,arguments)},mqs=function(){dr.apply(this,arguments)},UqR=function(){dr.apply(this,arguments)},HHf=function(){dr.apply(this,arguments)},iHR=function(){dr.apply(this,arguments)},axY=function(){dr.apply(this,arguments)},Q2R=function(){dr.apply(this,arguments)},g4Y=function(){dr.apply(this,arguments)},cns=function(){dr.apply(this,arguments)},FPt=function(){dr.apply(this,
arguments)},n4q=function(N){N=N.key||N.id;
if(!N)throw Error("Entity key is missing");return N},rny=function(){if(e6)return e6();
var N={};e6=g.NU("PersistentEntityStoreDb",{TW:(N.EntityStore={Kl:1},N.EntityAssociationStore={Kl:2},N),shared:!1,upgrade:function(p,S){S(1)&&g.rk(g.ax(p,"EntityStore",{keyPath:"key"}),"entityType","entityType");S(2)&&(p=g.ax(p,"EntityAssociationStore",{keyPath:["parentEntityKey","childEntityKey"]}),g.rk(p,"byParentEntityKey","parentEntityKey"),g.rk(p,"byChildEntityKey","childEntityKey"))},
version:3});return e6()},MLf=function(N){return g.AD(rny(),N)},KPy=function(N){return g.AD((0,g.LfG)(),N)},Cj=function(N){this.token=N},Ai=function(N,p){p=p===void 0?{}:p;
g.wp.call(this,g.TdY[N],Object.assign({},{name:"PESEncoderError",type:N},p));this.type=N;this.level="WARNING";Object.setPrototypeOf(this,Ai.prototype)},YZC=function(N){return new Ai("WRONG_DATA_TYPE",{q0:N})},GmY=function(N){return N instanceof Error?new Ai("UNKNOWN_ENCODE_ERROR",{bL:N.message}):new Ai("UNKNOWN_ENCODE_ERROR")},dqq=function(N){return N instanceof Error?new Ai("UNKNOWN_DECODE_ERROR",{bL:N.message}):new Ai("UNKNOWN_DECODE_ERROR")},eJB=function(N,p){N=N instanceof Ai?N:p(N);
g.nK(N);throw N;},Cif=function(){},AnY=function(N,p,S){try{return N.X(p,S)}catch(O){eJB(O,GmY)}},tLG=function(N){N=(new TextEncoder).encode(N).subarray(0,16);
var p=new Uint8Array(16);p.set(N);return p},ti=function(N){this.T=N},w_E=function(N){var p=uIB[N];
if(p)return p;g.rO(new g.wp("Entity model not found.",{entityType:N}))},RJ0=function(N,p){this.T=N;
this.B=p;this.X={}},Dq0=function(N,p){a:{N=Ixs(N.B,p.version);
try{var S=N.B(p.data,p.key);break a}catch(O){eJB(O,dqq)}S=void 0}return S},u6=function(N,p,S){return N.T.objectStore("EntityStore").get(p).then(function(O){if(O){if(S&&O.entityType!==S)throw Error("Incorrect entity type");
return Dq0(N,O)}})},wr=function(N,p,S){return S?(S=S.map(function(O){return u6(N,O,p)}),g.$H.all(S)):N.T.objectStore("EntityStore").index("entityType").getAll(IDBKeyRange.only(p)).then(function(O){return O.map(function(P){return Dq0(N,P)})})},I4=function(N,p,S){var O=n4q(p),P=Ixs(N.B,1),W=Object.assign({},p);
return N.T.objectStore("EntityStore").get(O).then(function(X){if(X){if(X.entityType!==S)throw Error("Incorrect entity type");W.entityMetadata||(X=Dq0(N,X),W.entityMetadata=X.entityMetadata)}}).then(function(){var X={key:O,
entityType:S,data:AnY(P,W,O),version:1};return g.$H.all([g.cm(N.T.objectStore("EntityStore"),X),ZHf(N,W,S)])}).then(function(){R4(N,O,S);
return O})},kmY=function(N,p,S){p=p.map(function(O){return I4(N,O,S)});
return g.$H.all(p)},D5=function(N,p,S){if(S==null?0:S.I9){var O=new Set;
return qZq(N,p,O).then(function(){for(var W=[],X=g.z(O),l=X.next();!l.done;l=X.next())W.push(D5(N,l.value));return g.$H.all(W).then(function(){})})}var P=g.f4(p).entityType;
return g.$H.all([N.T.objectStore("EntityStore").delete(p),NfR(N,p)]).then(function(){R4(N,p,P)})},pHl=function(N,p){return g.GB(N.T.objectStore("EntityStore").index("entityType"),{query:IDBKeyRange.only(p)},function(S){return g.$H.all([S.delete(),
NfR(N,S.cursor.primaryKey)]).then(function(){R4(N,S.cursor.primaryKey,p);return g.KR(S)})})},ogs=function(N,p,S,O){var P=Ixs(N.B,1);
return u6(N,p,O).then(function(W){if(W){W=g.iC(W,S);var X={key:p,entityType:O,data:AnY(P,W,p),version:1};return g.$H.all([g.cm(N.T.objectStore("EntityStore"),X),ZHf(N,W,O)])}}).then(function(){R4(N,p,O);
return p})},R4=function(N,p,S){var O=N.X[S];
O||(O=new Set,N.X[S]=O);O.add(p)},ShQ=function(N,p,S){var O=n4q(p);
S=w_E(S);if(!S)return g.$H.resolve([]);S=new S(p);N=N.T.objectStore("EntityAssociationStore");p=[];S=g.z(S.B());for(var P=S.next();!P.done;P=S.next())p.push(g.cm(N,{parentEntityKey:O,childEntityKey:P.value}));return g.$H.all(p).then(function(W){return W.map(function(X){return X[1]})})},NfR=function(N,p){return N.T.objectStore("EntityAssociationStore").index("byParentEntityKey").delete(IDBKeyRange.only(p))},ZHf=function(N,p,S){var O=n4q(p);
return NfR(N,O).then(function(){return ShQ(N,p,S)})},qZq=function(N,p,S){if(S.has(p))return g.$H.resolve(void 0);
S.add(p);return O5q(N,p).then(function(O){return N.T.objectStore("EntityAssociationStore").index("byParentEntityKey").delete(IDBKeyRange.only(p)).then(function(){return O})}).then(function(O){var P=g.$H.resolve(void 0);
O=g.z(O);for(var W=O.next(),X={};!W.done;X={i5:void 0},W=O.next())X.i5=W.value,P=P.then(function(l){return function(){return qZq(N,l.i5,S)}}(X));
return P}).then(function(){})},O5q=function(N,p){var S=N.T.objectStore("EntityAssociationStore");
return S.index("byParentEntityKey").getAll(IDBKeyRange.only(p)).then(function(O){var P=[];O=g.z(O);for(var W=O.next();!W.done;W=O.next())W=W.value,P.push(S.index("byChildEntityKey").getAll(W.childEntityKey));return g.$H.all(P)}).then(function(O){var P=[];
O=g.z(O);for(var W=O.next();!W.done;W=O.next())W=W.value,W.length===1&&P.push(W[0].childEntityKey);return P})},Z5=function(){},PRf=function(){this.T={};
this.T[0]=new Z5;if(!g.BM("aes_pes_encoder_killswitch")){var N=this.T;try{var p=g.RR();var S=tLG(p);var O=new ti(new g.mY(S),new g.J9(S))}catch(P){throw N=P instanceof Error?new Ai("KEY_CREATION_FAILED",{bL:P.message}):new Ai("KEY_CREATION_FAILED"),g.nK(N),N;}N[1]=O}},Ixs=function(N,p){p=p===void 0?0:p;
N=N.T[p];if(!N)throw p=new Ai("INVALID_ENCODER_VERSION",{q0:p}),g.nK(p),p;return N},kX=function(N,p){g.e.call(this);
this.token=N;this.T=p;this.observers=[];N=new g.M6.BroadcastChannel("PERSISTENT_ENTITY_STORE_SYNC:"+g.RR());N.onmessage=this.B.bind(this);this.channel=N},q3=function(N,p,S){var O,P,W,X;
return g.r(function(l){if(l.B==1)return g.F(l,MLf(N.token),2);if(l.B!=3)return O=l.T,g.F(l,g.gk(O,["EntityStore","EntityAssociationStore"],p,function(b){P=new RJ0(b,N.T);return S(P)}),3);
W=l.T;P&&(X=P.X,Object.keys(X).length>0&&(N.channel.postMessage(X),Wzf(N,X)));return l.return(W)})},NB=function(N,p,S){return q3(N,{mode:"readwrite",
Hj:!0},function(O){return I4(O,p,S)})},XHy=function(N,p){return q3(N,{mode:"readwrite",
Hj:!0},function(S){return kmY(S,p,"offlineOrchestrationActionWrapperEntity")})},fXs=function(N,p){return q3(N,{mode:"readwrite",
Hj:!0},function(S){return D5(S,p)})},lXl=function(N){return q3(N,{mode:"readwrite",
Hj:!0},function(p){return pHl(p,"videoPlaybackPositionEntity")})},pg=function(N,p,S){return q3(N,{mode:"readonly",
Hj:!0},function(O){return u6(O,p,S)})},og=function(N,p,S){return q3(N,{mode:"readonly",
Hj:!0},function(O){return wr(O,p,S)})},Wzf=function(N,p){N=g.z(N.observers);
for(var S=N.next();!S.done;S=N.next())S=S.value,S(p)},b5q=function(){var N,p,S;
return g.r(function(O){if(O.B==1)return g.vg(O,2),g.F(O,g.kH(),4);if(O.B!=2){N=O.T;if(!N||!g.IR()||typeof g.M6.BroadcastChannel==="undefined")return O.return();p=new PRf;return O.return(new kX(N,p))}S=g.zd(O);S instanceof Error&&g.nK(S);return O.return()})},SE=function(){jSt||(jSt=b5q());
return jSt},sSy=function(N){var p;
N=(p=N.options)==null?void 0:p.persistenceOption;return N==="ENTITY_PERSISTENCE_OPTION_PERSIST"||N==="ENTITY_PERSISTENCE_OPTION_INMEMORY_AND_PERSIST"},hTd=function(N){var p;
return g.r(function(S){return S.B==1?g.F(S,SE(),2):(p=S.T)?g.F(S,q3(p,"readwrite",function(O){for(var P={},W=g.z(N),X=W.next(),l={};!X.done;l={Sx:void 0,Em:void 0},X=W.next())l.Sx=X.value,l.Sx.entityKey&&sSy(l.Sx)&&(l.Em=g.aY(l.Sx.payload),X=void 0,l.Sx.type==="ENTITY_MUTATION_TYPE_REPLACE"&&(X=function(b){return function(){return I4(O,b.Sx.payload[b.Em],b.Em)}}(l)),l.Sx.type==="ENTITY_MUTATION_TYPE_DELETE"&&(X=function(b){return function(){return D5(O,b.Sx.entityKey)}}(l)),l.Sx.type==="ENTITY_MUTATION_TYPE_UPDATE"&&
(X=function(b){return function(){return ogs(O,b.Sx.entityKey,b.Sx.payload[b.Em],b.Em)}}(l)),X&&(P[l.Sx.entityKey]=P[l.Sx.entityKey]?P[l.Sx.entityKey].then(X):X()));
return g.$H.all(Object.values(P))}),0):S.return()})},xCG=function(N){var p;
return g.r(function(S){if(S.B==1){p=N.mutations;if(!p||p.length<=0)return S.return();if(g.fb){var O={type:"ENTITY_LOADED"};p!==void 0&&(O.payload=p);g.fb.dispatch(O)}return g.F(S,hTd(p),2)}p.length=0;g.Ls(S)})},yEs=function(N){return N!==void 0},Vp0=function(N){var p=g.mS();
p=Object.assign({},p);N=Object.assign({},N);for(var S in p)N[S]?(p[S]!==4&&(p[S]=N[S]),delete N[S]):p[S]!==2&&(p[S]=4);Object.assign(p,N);g.RbX(p);JSON.stringify(p);return p},LzV=function(N){var p,S;
return g.r(function(O){if(O.B==1)return g.F(O,g.kH(),2);if(O.B!=3)return(p=O.T)?g.F(O,g.ix(p),3):O.return();S=O.T;return O.return(g.gk(S,["index","media","captions"],{mode:"readwrite",Hj:!0},function(P){var W=IDBKeyRange.bound(N+"|",N+"~");P=[P.objectStore("index").delete(W),P.objectStore("media").delete(W),P.objectStore("captions").delete(W)];return g.$H.all(P).then(function(){})}))})},Tf0=function(){var N,p;
return g.r(function(S){if(S.B==1)return g.F(S,g.kH(),2);if(S.B!=3){N=S.T;if(!N)throw g.zB("rvdfd");return g.F(S,g.ix(N),3)}p=S.T;return S.return(g.gk(p,["index","media"],{mode:"readwrite",Hj:!0},function(O){var P={};return g.Mg(O.objectStore("index"),{},function(W){var X=W.cursor.key.match(/^([\w\-_]+)\|(a|v)$/),l=g.$H.resolve(void 0);if(X){var b=X[1];X=X[2];P[b]=P[b]||{};var h;P[b][X]=g.q4e((h=W.getValue())==null?void 0:h.fmts)}else l=W.delete().then(function(){});
return g.$H.all([g.KR(W),l]).then(function(x){return g.z(x).next().value})}).then(function(){for(var W={},X=g.z(Object.keys(P)),l=X.next();!l.done;l=X.next()){l=l.value;
var b=P[l].v;W[l]=P[l].a&&b?1:2}var h=Vp0(W);return g.n6G(O.objectStore("media"),{},function(x){var y=x.cursor.key.match(g.Sx6);y&&W[y[1]]||O.objectStore("media").delete(x.cursor.key);return g.m7H(x)}).then(function(){return h})})}))})},vgy=function(N,p){var S,O;
return g.r(function(P){if(P.B==1)return g.F(P,g.kH(),2);if(P.B!=3){S=P.T;if(!S)throw g.zB("wct");return g.F(P,g.ix(S),3)}O=P.T;return g.F(P,g.gk(O,["captions"],{mode:"readwrite",Hj:!0},function(W){var X=[];W=W.objectStore("captions");for(var l=0;l<p.length;l++){var b=g.cm(W,p[l],N+"|"+p[l].metadata.vss_id);X.push(b)}return g.$H.all(X)}),0)})},Bfs=function(N){var p,S,O;
return g.r(function(P){if(P.B==1)return p=IDBKeyRange.bound(N+"|",N+"~"),g.F(P,g.kH(),2);if(P.B!=3){S=P.T;if(!S)throw g.zB("gactfv");return g.F(P,g.ix(S),3)}O=P.T;return P.return(O.getAll("captions",p))})},zTY=function(N){return g.r(function(p){g.H7(N,0);
return p.return(LzV(N))})},Egf=function(N){return{context:g.BV(),
videoIds:N}},$CR=function(N){return{context:g.BV(),
playlistIds:N}},JEf=function(N){return{context:g.BV(),
offlinePlaylistSyncChecks:N}},mCV=function(){this.T=new Map},H5G=function(){UCq||(UCq=new mCV);
return UCq},i5B=function(N,p){return{eventType:{flowEventNamespace:"FLOW_EVENT_NAMESPACE_OFFLINE_ORCHESTRATION",
flowEventType:N},metadata:p,statusCode:void 0,csn:void 0,can:void 0}},aX0=function(N,p,S){if(!S){var O=O===void 0?!1:O;
S=N.T.get("FLOW_TYPE_OFFLINE_ORCHESTRATION");if(!S||O)S=g.E8(16),N.T.set("FLOW_TYPE_OFFLINE_ORCHESTRATION",S)}N={flowNonce:S,flowType:"FLOW_TYPE_OFFLINE_ORCHESTRATION",flowEventType:p.eventType};p.metadata&&(N.flowMetadata=p.metadata);p.statusCode!==void 0&&(N.flowEventStatus=p.statusCode);p.csn&&(N.csn=p.csn);p.can&&(N.can=p.can);g.le("flowEvent",N,void 0)},QSG=function(N){var p,S,O,P,W,X,l,b,h,x,y,V,L,T,E,m,H,Q,n,K,d,D,u,oH,bX,I,A,k,v,w,Zb,Tf,bG,iX,o0,xs,k5,U,a,c;
return g.r(function(M){if(M.B==1)return g.F(M,q3(N,{mode:"readonly",Hj:!0},function(G){return wr(G,"playbackData").then(function(N6){var Wg=N6.map(function(Td){return Td.transfer}).filter(function(Td){return!!Td}),O_=N6.map(function(Td){return Td.offlineVideoPolicy}).filter(function(Td){return!!Td}),Y=N6.filter(function(Td){return!!Td.key}).map(function(Td){return g.l0(g.f4(Td.key).entityId,"downloadStatusEntity")});
Wg=wr(G,"transfer",Wg);O_=wr(G,"offlineVideoPolicy",O_);Y=wr(G,"downloadStatusEntity",Y);var jA=Wg.then(function(Td){Td=Td.reduce(function(XG,re){(re==null?0:re.offlineVideoStreams)&&XG.push.apply(XG,g.J(re.offlineVideoStreams));return XG},[]).filter(function(XG){return!!XG});
return wr(G,"offlineVideoStreams",Td)});
return g.$H.all([Wg,O_,jA,Y]).then(function(Td){var XG=g.z(Td);Td=XG.next().value;var re=XG.next().value;var XB=XG.next().value;XG=XG.next().value;return[N6,Td,re,XB,XG]})})}),2);
if(M.B!=3)return p=M.T,g.F(M,q3(N,{mode:"readonly",Hj:!0},function(G){return wr(G,"mainDownloadsListEntity").then(function(N6){var Wg,O_;return(O_=(Wg=N6[0])==null?void 0:Wg.downloads)!=null?O_:[]})}),3);
S=M.T;O=g.z(p);P=O.next().value;W=O.next().value;X=O.next().value;l=O.next().value;b=O.next().value;h=P;x=W;y=X;V=l;L=b;T={};E={};m={};H={};Q={};n=[];K=g.z(x);for(d=K.next();!d.done;d=K.next())(D=d.value)&&(T[D.key]=D);u=g.z(y);for(oH=u.next();!oH.done;oH=u.next())(bX=oH.value)&&(E[bX.key]=bX);I=g.z(L);for(A=I.next();!A.done;A=I.next())(k=A.value)&&(m[k.key]=k);v=g.z(V);for(w=v.next();!w.done;w=v.next())(Zb=w.value)&&(H[Zb.key]=Zb);Tf=g.z(S);for(bG=Tf.next();!bG.done;bG=Tf.next())iX=bG.value,o0=void 0,
Q[(o0=iX.videoItem)!=null?o0:""]=!0,iX.videoItem&&(k5=xs=void 0,U=(k5=(xs=g.f4(iX.videoItem))==null?void 0:xs.entityId)!=null?k5:"",n.push({externalVideoId:U}));a=h.filter(function(G){if(!G||!G.key||!G.offlineVideoPolicy)return!1;G=g.f4(G.key).entityId;G=g.l0(G,"downloadStatusEntity");var N6;return!(G&&((N6=m[G])==null?void 0:N6.downloadState)==="DOWNLOAD_STATE_USER_DELETED")});
c=a.map(function(G){var N6=T[G.transfer],Wg=[];if(N6==null?0:N6.offlineVideoStreams)for(var O_=g.z(N6.offlineVideoStreams),Y=O_.next();!Y.done;Y=O_.next())(Y=H[Y.value])&&Wg.push(Y);O_=E[G.offlineVideoPolicy];Y=Q;var jA=G==null?void 0:G.playerResponseTimestamp,Td=g.f4(O_.key).entityId;G=g.l0(Td,"mainVideoEntity");if(O_.action==="OFFLINE_VIDEO_POLICY_ACTION_DISABLE"){var XG="OFFLINE_VIDEO_STATE_DISABLED";O_.expirationTimestamp&&Number(O_.expirationTimestamp)<Date.now()/1E3&&(XG="OFFLINE_VIDEO_STATE_EXPIRED")}else if(O_.action===
"OFFLINE_VIDEO_POLICY_ACTION_DOWNLOAD_FAILED")XG="OFFLINE_VIDEO_STATE_OFFLINE_FAILED";else{switch(N6==null?void 0:N6.transferState){case "TRANSFER_STATE_TRANSFER_IN_QUEUE":XG="OFFLINE_VIDEO_STATE_PENDING";break;case "TRANSFER_STATE_TRANSFERRING":XG="OFFLINE_VIDEO_STATE_TRANSFERRING";break;case "TRANSFER_STATE_PAUSED_BY_USER":XG="OFFLINE_VIDEO_STATE_PAUSED_TRANSFER";break;case "TRANSFER_STATE_FAILED":XG="OFFLINE_VIDEO_STATE_OFFLINE_FAILED";break;case "TRANSFER_STATE_COMPLETE":XG="OFFLINE_VIDEO_STATE_PLAYABLE";
break;case "TRANSFER_STATE_WAITING_FOR_PLAYER_RESPONSE_REFRESH":XG="OFFLINE_VIDEO_STATE_STREAMS_OUT_OF_DATE";break;default:XG="OFFLINE_VIDEO_STATE_UNKNOWN"}if(XG==="OFFLINE_VIDEO_STATE_OFFLINE_FAILED")switch(N6==null?void 0:N6.failureReason){case "TRANSFER_FAILURE_REASON_EXTERNAL_FILESYSTEM_WRITE":case "TRANSFER_FAILURE_REASON_FILESYSTEM_WRITE":XG="OFFLINE_VIDEO_STATE_OUT_OF_STORAGE_ERROR";break;case "TRANSFER_FAILURE_REASON_STREAM_MISSING":XG="OFFLINE_VIDEO_STATE_STREAMS_MISSING";break;case "TRANSFER_FAILURE_REASON_NETWORK":case "TRANSFER_FAILURE_REASON_NETWORK_LOST":XG=
"OFFLINE_VIDEO_STATE_NETWORK_ERROR"}}Td={id:Td,videoState:XG};if(N6==null?0:N6.cotn)Td.cotn=N6.cotn;if(N6==null?0:N6.maximumDownloadQuality)Td.selectedVideoQuality=N6==null?void 0:N6.maximumDownloadQuality;if(N6==null?0:N6.lastProgressTimeMs)Td.lastProgressTimeMs=N6.lastProgressTimeMs;jA&&(Td.playerResponseSavedTimeMs=String(Number(jA)*1E3));N6=String;jA=0;Wg=g.z(Wg);for(XG=Wg.next();!XG.done;XG=Wg.next())if(XG=XG.value,XG.streamsProgress){XG=g.z(XG.streamsProgress);for(var re=XG.next();!re.done;re=
XG.next()){var XB=void 0;jA+=Number((XB=re.value.numBytesDownloaded)!=null?XB:0)}}Td.downloadedBytes=N6(jA);Td.selectedOfflineMode=Y[G]?"OFFLINE_MODE_TYPE_AUTO_OFFLINE":"OFFLINE_NOW";O_.action==="OFFLINE_VIDEO_POLICY_ACTION_DISABLE"&&(Td.offlinePlaybackDisabledReason=O_.offlinePlaybackDisabledReason);return Td});
return M.return({offlineVideos:c,additionalOfflineClientState:{mainAppAdditionalOfflineClientState:{smartDownloadVideos:n}}})})},ggC=function(){this.locks=navigator.locks},cEl=function(){try{var N=g.Y5("ytglobal.locks_");
if(N)return N;var p;if(p=navigator){var S=navigator;p="locks"in S&&!!S.locks}if(p)return g.M6.localStorage&&g.M6.localStorage.getItem("noop"),N=new ggC,g.Ks("ytglobal.locks_",N),N}catch(O){}},OW=function(){},Fzl=function(){},ngB=function(N){if(N.includes(":"))throw Error("Invalid user cache name: "+N);
return N+":"+g.RR("CacheStorage get")},rEd=function(){return g.r(function(N){if(PG!==void 0)return N.return(PG);
PG=new Promise(function(p){var S;return g.r(function(O){switch(O.B){case 1:return g.vg(O,2),g.F(O,WG.open("test-only"),4);case 4:return g.F(O,WG.delete("test-only"),5);case 5:g.Bg(O,3);break;case 2:if(S=g.zd(O),S instanceof Error&&S.name==="SecurityError")return p(!1),O.return();case 3:p("caches"in window),g.Ls(O)}})});
return N.return(PG)})},Kz0=function(){return g.r(function(N){if(N.B==1)return g.F(N,rEd(),2);
if(!N.T)return N.return(void 0);Mp0||(Mp0=new Fzl);return N.return(Mp0)})},Xv=function(N,p,S){g.rO(new g.wp("Woffle: "+N,S?{cotn:S}:""));
p instanceof Error&&g.rO(p)},YhV=function(N){var p;
return g.r(function(S){if(S.B==1)return g.F(S,QSG(N),2);p=S.T;g.le("offlineStateSnapshot",p);g.Ls(S)})},fg=function(N){g.e.call(this);
var p=this;this.api=N;this.Rc={SiB:function(){return p.T},
Yid:function(){return p.B}};
typeof g.M6.BroadcastChannel!=="undefined"&&(this.T=new g.M6.BroadcastChannel("PLAYER_OFFLINE_ERROR_SYNC:"+g.RR()),this.T.onmessage=this.X.bind(this),this.B=new g.M6.BroadcastChannel("PLAYER_OFFLINE_PAUSE_SYNC:"+g.RR()),this.B.onmessage=this.G.bind(this))},lZ=function(N,p){N.api.YO("onOfflineOperationFailure",p);
var S;(S=N.T)==null||S.postMessage(p)},GPE=function(N,p,S,O){var P=this;
this.Y=N;this.W=p;this.visibility=S;this.U=O;this.K=this.j=this.N=this.X=this.T=!1;this.G=new g.k6(function(){P.UD()});
this.Rc={Wt:function(){return P.B},
UD:function(){P.UD()},
W6y:function(){return P.G}};
this.visibility.subscribe("visibilitystatechange",function(){P.cG()})},dC0=function(N){if(!N.X&&!N.T){var p=cEl();
if(p){N.X=!0;var S=g.RR("OfflineLockManager");p.request("woffle_orchestration_leader:"+S,{},function(){var O,P,W,X;return g.r(function(l){switch(l.B){case 1:return g.vg(l,2),N.B=new g.mj,N.T=!0,N.X=!1,g.F(l,N.Y(),4);case 4:return g.F(l,N.B.promise,5);case 5:g.Bg(l,0);break;case 2:O=g.zd(l),((W=(P=N).U)==null?0:W.call(P,"wo_relinquish_leadership_on_lock_request_error"))||N.UD(),O instanceof Error&&(X=O,X.args=[{name:"WoLockManagerError",u3:O.name}],g.nK(X)),g.Ls(l)}})})}}},eTB=function(N){N.T&&(N.K=
!0,bZ(N))},CRR=function(N,p){N.T&&(N.N=p,bZ(N))},AEV=function(N,p){N.T&&(N.j=p,bZ(N))},bZ=function(N){N.j&&N.N&&N.K&&N.visibility.isBackground()?g.q7(N.G,6E4):N.G.stop()},jE=function(N){var p;
N.offlineDeleteReason=(p=N.offlineDeleteReason)!=null?p:"OFFLINE_DELETE_REASON_UNKNOWN";var S;N.offlineModeType=(S=N.offlineModeType)!=null?S:"OFFLINE_NOW";g.le("offlineDeleteEvent",N)},sW=function(N,p){var S=p.videoId;
var O=p.YS;p=p.offlineModeType;N.encryptedVideoId=S;N.cotn=O==null?void 0:O.cotn;N.offlineabilityFormatType=O==null?void 0:O.maximumDownloadQuality;var P;N.isRefresh=(P=O==null?void 0:O.isRefresh)!=null?P:!1;var W;N.softErrorCount=(W=O==null?void 0:O.transferRetryCount)!=null?W:0;N.offlineModeType=p!=null?p:"OFFLINE_NOW";(N.transferStatusType==="TRANSFER_STATUS_TYPE_UNKNOWN"&&N.statusType==="UNKNOWN_STATUS_TYPE"||!N.transferStatusType&&!N.statusType)&&g.rO(Error("Woffle unknown transfer status"));
g.le("offlineTransferStatusChanged",N)},tpf=function(N,p,S,O){O={transferStatusType:"TRANSFER_STATUS_TYPE_PROCESSING",
statusType:"OFFLINING_STARTED",transferFirstStarted:!!O};p&&S&&(p=Math.floor(p/1024).toFixed(),S=Math.floor(S/1024).toFixed(),O.alreadyDownloadedKbytes=p,O.totalFetchedKbytes=p,O.totalContentKbytes=S);sW(O,N)},uCd=function(N){sW({transferStatusType:"TRANSFER_STATUS_TYPE_DEQUEUED_BY_USER_PAUSE",
statusType:"SUSPENDED"},N)},wH0=function(N){switch(N){case "TRANSFER_FAILURE_REASON_FILESYSTEM_WRITE":case "TRANSFER_FAILURE_REASON_EXTERNAL_FILESYSTEM_WRITE":return"OFFLINE_DATABASE_ERROR";
case "TRANSFER_FAILURE_REASON_PLAYABILITY":return"NOT_PLAYABLE";case "TRANSFER_FAILURE_REASON_TOO_MANY_RETRIES":return"TOO_MANY_RETRIES";case "TRANSFER_FAILURE_REASON_INTERNAL":return"OFFLINE_DOWNLOAD_CONTROLLER_ERROR";case "TRANSFER_FAILURE_REASON_STREAM_MISSING":return"STREAM_VERIFICATION_FAILED";case "TRANSFER_FAILURE_REASON_SERVER":case "TRANSFER_FAILURE_REASON_SERVER_PROPERTY_MISSING":return"OFFLINE_REQUEST_FAILURE";case "TRANSFER_FAILURE_REASON_NETWORK":return"OFFLINE_NETWORK_ERROR";default:return"UNKNOWN_FAILURE_REASON"}},
hT=function(N){var p,S,O;
return((O=(p=N.actionMetadata)==null?void 0:(S=p.retryScheduleIntervalsInSeconds)==null?void 0:S.length)!=null?O:0)>0},x2=function(N){return N.actionType==="OFFLINE_ORCHESTRATION_ACTION_TYPE_ADD"&&!!N.entityKey},yD=function(N){return N.actionType==="OFFLINE_ORCHESTRATION_ACTION_TYPE_REFRESH"&&!!N.entityKey},VD=function(N){return N.actionType==="OFFLINE_ORCHESTRATION_ACTION_TYPE_DELETE"&&!!N.entityKey},RTB=function(N){return N.actionType==="OFFLINE_ORCHESTRATION_ACTION_TYPE_UPDATE"&&!!N.entityKey},
Lg=function(N,p,S,O,P){P=P===void 0?!1:P;
var W,X,l,b,h,x;return g.r(function(y){if(y.B==1)return W=g.l0(N,p),X=g.l0(N,"downloadStatusEntity"),g.F(y,q3(S,{mode:"readonly",Hj:!0},function(V){return g.$H.all([u6(V,W,p),u6(V,X,"downloadStatusEntity")])}),2);
l=y.T;b=l.length?l[0]:void 0;if(!b)return y.XB(0);h=IXC;if(x=l.length>1?l[1]:void 0){if(x.downloadState==="DOWNLOAD_STATE_USER_DELETED"&&!P)return y.return();x.downloadState=O}else x={key:X,downloadState:O};g.dO(b,h,x);return g.F(y,q3(S,{mode:"readwrite",Hj:!0},function(V){return g.$H.all([I4(V,b,p),I4(V,x,"downloadStatusEntity")])}),0)})},TV=function(N,p){return N.actionType===p.actionType&&N.entityKey===p.entityKey},vG=function(N,p){if(N&&N.transferState!=="TRANSFER_STATE_COMPLETE"&&N.transferState!==
"TRANSFER_STATE_FAILED"){var S=g.f4(N.key).entityId;
sW({transferStatusType:"TRANSFER_STATUS_TYPE_TERMINATED_BY_USER",statusType:"CANCELLED"},{videoId:S,YS:N,offlineModeType:p})}},BG=function(N){if(!N||!N.thumbnails)return[];
var p=[];N=g.z(N.thumbnails);for(var S=N.next();!S.done;S=N.next())S=S.value,S.url&&p.push(S.url);return p},DCB=function(N,p,S){S=S===void 0?[]:S;
var O,P,W,X,l,b,h,x,y,V,L,T,E;return g.r(function(m){if(m.B==1)return S.length?g.F(m,og(N,p),2):m.return([]);O=m.T;P=new Set;W=g.z(O);for(X=W.next();!X.done;X=W.next())if(l=X.value,b=l.id||l.key)h=g.f4(b).entityId,P.add(h);x=[];y=g.z(S);for(V=y.next();!V.done;V=y.next())L=V.value,T=L.offlineVideoData,E=void 0,((E=T)==null?0:E.videoId)&&!P.has(T.videoId)&&x.push(L);return m.return(x)})},Z50=function(N,p,S){return new g.dW(N,{cotn:p,
raw_player_response:S,download_media:!0,start:Infinity,disable_watch_next:!0})},kPl=function(){return{priority:1,
retryScheduleIntervalsInSeconds:[1,2,4]}},zV=function(N,p,S,O,P,W,X,l,b,h,x){this.entityType=N;
this.actionId=p;this.action=S;this.parentActionId=O;this.rootActionId=P===void 0?p:P;this.childActionIds=W;this.prereqActionId=X;this.postreqActionIds=l;this.hasChildActionFailed=h;this.retryScheduleIndex=0;this.T=x||Date.now();this.retryScheduleIndex=b||0},EW=function(N){if(!N.key)throw Error("Entity key is required.");
if(!N.actionProto)throw Error("OfflineOrchestrationAction is required.");var p=g.f4(N.key),S=g.f4(N.actionProto.entityKey);return new zV(S.entityType,p.entityId,N.actionProto,N.parentActionId,N.rootActionId,N.childActionIds,N.prereqActionId,N.postreqActionIds,N.retryScheduleIndex,N.hasChildActionFailed,Number(N.enqueueTimeSec)*1E3)},$2=function(N){return{key:g.l0(N.actionId,"offlineOrchestrationActionWrapperEntity"),
actionProto:N.action,parentActionId:N.parentActionId,rootActionId:N.rootActionId,childActionIds:N.childActionIds,prereqActionId:N.prereqActionId,postreqActionIds:N.postreqActionIds,retryScheduleIndex:N.retryScheduleIndex,hasChildActionFailed:N.hasChildActionFailed,enqueueTimeSec:(N.T/1E3).toFixed()}},qhd=function(){var N;
return g.r(function(p){return p.B==1?g.F(p,Kz0(),2):(N=p.T)?p.return(N.delete("yt-player-local-img")):p.return(!0)})},JT=function(N){var p,S;
return g.r(function(O){if(O.B==1)return g.F(O,Kz0(),2);if(O.B!=3){p=O.T;if(!p)throw Error("Cache API not supported");return N.length?g.F(O,p.open("yt-player-local-img"),3):O.return()}S=O.T;return g.F(O,Promise.all(N.map(function(P){return S.delete(P)})),0)})},mU=function(N){var p,S;
return g.r(function(O){if(O.B==1)return g.F(O,Kz0(),2);if(O.B!=3){p=O.T;if(!p)throw Error("Cache API not supported");return N.length?g.F(O,p.open("yt-player-local-img"),3):O.return()}S=O.T;return g.F(O,S.addAll(N),0)})},UW=function(N,p,S,O,P){var W,X,l,b,h,x,y,V,L,T,E,m,H,Q,n,K,d,D,u,oH,bX,I,A,k,v,w,Zb,Tf,bG,iX,o0;
return g.r(function(xs){switch(xs.B){case 1:return W=g.l0(N,"mainVideoEntity"),X=g.l0(N,"ytMainChannelEntity"),l=g.l0(N,"transfer"),b=g.l0(N,"videoDownloadContextEntity"),g.F(xs,q3(p,{mode:"readonly",Hj:!0},function(k5){return g.$H.all([u6(k5,W,"mainVideoEntity"),u6(k5,X,"ytMainChannelEntity"),u6(k5,l,"transfer"),u6(k5,b,"videoDownloadContextEntity"),wr(k5,"ytMainChannelEntity"),wr(k5,"offlineOrchestrationActionWrapperEntity")])}),2);
case 2:h=xs.T;x=g.z(h);y=x.next().value;V=x.next().value;L=x.next().value;T=x.next().value;E=x.next().value;m=x.next().value;H=y;Q=V;n=L;K=T;d=E;D=m;if(!H&&!Q){xs.XB(3);break}u=H?BG(H.thumbnail):[];if(!Q){oH=[];xs.XB(4);break}return g.F(xs,NxG(Q,d),5);case 5:oH=xs.T;case 4:return bX=oH,g.F(xs,JT(u.concat(bX)),3);case 3:I=[];A=g.l0(N,"downloadStatusEntity");k=g.z(D);for(v=k.next();!v.done;v=k.next())w=v.value,Zb=g.f4(w.key).entityId,Tf=EW(w),bG=g.f4(Tf.action.entityKey).entityId,Zb!==N&&bG!==N||TV(S,
w.actionProto)||I.push(w.key);return g.F(xs,q3(p,{mode:"readwrite",Hj:!0},function(k5){var U=I.map(function(a){return D5(k5,a)});
U.push(D5(k5,W,{I9:!0}));U.push(D5(k5,A,{I9:!0}));return g.$H.all(U)}),7);
case 7:o0=(iX=K)==null?void 0:iX.offlineModeType,P&&(jE(P),P.offlineModeType&&(o0=P.offlineModeType)),vG(n,o0),lZ(O,{entityKey:W,failureReason:"OFFLINE_OPERATION_FAILURE_REASON_VIDEO_DELETED"}),g.Ls(xs)}})},SzE=function(N,p,S,O){var P,W,X,l,b,h,x,y,V,L,T,E,m,H,Q,n,K,d,D,u,oH,bX,I,A,k,v,w,Zb,Tf,bG,iX,o0,xs,k5,U,a,c,M,G,N6,Wg,O_,Y,jA,Td,XG,re,XB,Gf,h1;
return g.r(function(we){switch(we.B){case 1:return P=g.l0(N,"mainPlaylistEntity"),W=g.l0(N,"ytMainChannelEntity"),g.F(we,q3(p,{mode:"readonly",Hj:!0},function(M_){return g.$H.all([u6(M_,P,"mainPlaylistEntity"),u6(M_,W,"ytMainChannelEntity"),wr(M_,"mainPlaylistEntity"),wr(M_,"mainDownloadsListEntity"),wr(M_,"ytMainChannelEntity"),wr(M_,"offlineOrchestrationActionWrapperEntity")])}),2);
case 2:X=we.T;l=g.z(X);b=l.next().value;h=l.next().value;x=l.next().value;y=l.next().value;V=l.next().value;L=l.next().value;T=b;E=h;m=x;H=y;Q=V;n=L;if(!T&&!E){we.XB(3);break}K=T?pcl(T):[];if(!E){d=[];we.XB(4);break}return g.F(we,NxG(E,Q),5);case 5:d=we.T;case 4:return D=d,g.F(we,JT(K.concat(D)),3);case 3:u=[];oH=new Map;if(!T){we.XB(7);break}return g.F(we,oQs(T,m,H),8);case 8:u=we.T;bX=g.z(u);for(I=bX.next();!I.done;I=bX.next())A=I.value,oH.set(A,{videoId:A,playlistId:N,offlineDeleteReason:"OFFLINE_DELETE_REASON_PARENT_LIST_DELETE"});
return g.F(we,q3(p,{mode:"readonly",Hj:!0},function(M_){return g.$H.all([wr(M_,"transfer"),wr(M_,"videoDownloadContextEntity")])}),9);
case 9:k=we.T;v=g.z(k);w=v.next().value;Zb=v.next().value;Tf=w;bG=Zb;iX=g.z(Tf);for(o0=iX.next();!o0.done;o0=iX.next())xs=o0.value,k5=g.f4(xs.key).entityId,(U=oH.get(k5))&&xs&&(U.cotn=xs.cotn);a=g.z(bG);for(c=a.next();!c.done;c=a.next())M=c.value,G=g.f4(M.key).entityId,(N6=oH.get(G))&&M&&(N6.offlineModeType=M.offlineModeType);case 7:Wg=[];O_=g.z(n);for(Y=O_.next();!Y.done;Y=O_.next())jA=Y.value,Td=g.f4(jA.key).entityId,XG=EW(jA),Td!==N&&XG.rootActionId!==N||TV(S,jA.actionProto)||Wg.push(jA.key);re=
g.l0(N,"mainPlaylistEntity");return g.F(we,q3(p,{mode:"readwrite",Hj:!0},function(M_){var bH=Wg.map(function(Mp){return D5(M_,Mp)});
bH.push(D5(M_,re,{I9:!0}));return g.$H.all(bH)}),10);
case 10:if(!T){we.XB(0);break}u.reverse();if(!u){we.XB(0);break}XB=g.z(u);Gf=XB.next();case 13:if(Gf.done){we.XB(0);break}h1=Gf.value;return g.F(we,UW(h1,p,S,O,oH.get(h1)),14);case 14:Gf=XB.next(),we.XB(13)}})},PEq=function(N,p,S,O){var P,W,X,l,b,h,x,y,V;
return g.r(function(L){if(L.B==1)return P=g.l0("DOWNLOADS_LIST_ENTITY_ID_MANUAL_DOWNLOADS","mainDownloadsListEntity"),W=new Map,g.F(L,q3(N,{mode:"readwrite",Hj:!0},function(T){var E=wr(T,"transfer"),m=wr(T,"offlineOrchestrationActionWrapperEntity"),H=wr(T,"videoDownloadContextEntity"),Q=u6(T,P,"mainDownloadsListEntity");return g.$H.all([E,m,H,Q]).then(function(n){n=g.z(n);var K=n.next().value;var d=n.next().value;var D=n.next().value;var u=n.next().value;n=O_l.map(function(bX){return pHl(T,bX)});
d=g.z(d);for(var oH=d.next();!oH.done;oH=d.next())oH=oH.value,TV(p,oH.actionProto)||n.push(D5(T,oH.key,{I9:!0}));u&&(u.downloads=[],n.push(I4(T,u,"mainDownloadsListEntity")));if(D)for(D=g.z(D),u=D.next();!u.done;u=D.next())u=u.value,d=g.f4(u.key).entityId,d=g.l0(d,"transfer"),W.set(d,u.offlineModeType);return g.$H.all(n).then(function(){return K})})}),2);
X=L.T;l=g.z(X);for(b=l.next();!b.done;b=l.next())h=b.value,vG(h,W.get(h.key)),x=g.f4(h.key).entityId,y={videoId:x,offlineDeleteReason:O,cotn:h.cotn,offlineModeType:W.get(h.key)},jE(y),V=g.l0(x,"mainVideoEntity"),lZ(S,{entityKey:V,failureReason:"OFFLINE_OPERATION_FAILURE_REASON_VIDEO_DELETED"});return g.F(L,qhd(),0)})},pcl=function(N,p){var S=[];
if(N.thumbnailStyleData){N=g.z(N.thumbnailStyleData);for(var O=N.next();!O.done;O=N.next()){var P=void 0,W=void 0,X=void 0;S=S.concat(BG((P=O.value)==null?void 0:(W=P.value)==null?void 0:(X=W.collageThumbnail)==null?void 0:X.coverThumbnail))}}p=BG(p);return S.concat(p)},oQs=function(N,p,S){var O,P,W,X,l,b,h,x,y,V,L,T,E,m,H,Q,n,K,d,D,u,oH,bX;
return g.r(function(I){O=[];P=new Set;if(S.length)for(W=g.z(S),X=W.next();!X.done;X=W.next())if(l=X.value,b=void 0,(b=l.downloads)==null?0:b.length)for(h=g.z(l.downloads),x=h.next();!x.done;x=h.next())y=x.value,y.videoItem&&(V=g.f4(y.videoItem).entityId,P.add(V));if(N.videos){L=g.z(N.videos);for(T=L.next();!T.done;T=L.next())E=T.value,m=JSON.parse(g.f4(E).entityId),m.videoId&&!P.has(m.videoId)&&O.push(m.videoId);H=g.z(p);for(Q=H.next();!Q.done;Q=H.next())if(n=Q.value,n.key!==N.key&&(K=n.videos))for(d=
g.z(K),D=d.next();!D.done;D=d.next())u=D.value,oH=JSON.parse(g.f4(u).entityId),oH.videoId&&(bX=O.indexOf(oH.videoId),bX!==-1&&O.splice(bX,1))}return I.return(O)})},NxG=function(N,p){var S,O,P,W,X,l,b,h;
return g.r(function(x){S=BG(N.avatar);O=g.z(p);for(P=O.next();!P.done;P=O.next())if(W=P.value,W.id!==N.id)for(X=g.z(BG(W.avatar)),l=X.next();!l.done;l=X.next())b=l.value,h=S.indexOf(b),h!==-1&&S.splice(h,1);return x.return(S)})},W5C=function(N){var p;
return g.r(function(S){p=g.t(N.frameworkUpdates,HG);return N.frameworkUpdates&&p?g.F(S,xCG(p),0):S.return()})},fVE=function(N){var p;
if((p=N.onResponseReceivedActions)!=null&&p.length){var S;N=(S=g.t(g.t(N.onResponseReceivedActions[0],XcE),g.TBG))==null?void 0:S.actions;if(N!=null&&N.length)return N}},lVy=function(N){var p,S,O;
return g.r(function(P){if(P.B==1)return N?g.F(P,pg(N,g.YW,"mainDownloadsListEntity"),2):P.return([]);p=P.T;return((S=p)==null?0:(O=S.downloads)==null?0:O.length)?P.return(p.downloads.map(function(W){var X;return(X=W.videoItem)!=null?X:""})):P.return([])})},j90=function(N,p){var S;
return g.r(function(O){return O.B==1?g.F(O,b_0(N,p),2):(S=O.T)?g.F(O,q3(N,{mode:"readwrite",Hj:!0},function(P){var W=[I4(P,S.mainDownloadsLibraryEntity,"mainDownloadsLibraryEntity")];S.mainDownloadsListEntity&&W.push(I4(P,S.mainDownloadsListEntity,"mainDownloadsListEntity"));return g.$H.all(W)}),0):O.XB(0)})},b_0=function(N,p){var S,O,P,W,X,l,b,h,x,y,V,L,T,E,m,H,Q,n;
return g.r(function(K){if(K.B==1)return S=g.l0("main_downloads_library_id","mainDownloadsLibraryEntity"),O=g.l0("DOWNLOADS_LIST_ENTITY_ID_MANUAL_DOWNLOADS","mainDownloadsListEntity"),g.F(K,q3(N,{mode:"readonly",Hj:!0},function(d){return g.$H.all([u6(d,S,"mainDownloadsLibraryEntity"),u6(d,O,"mainDownloadsListEntity")])}),2);
P=K.T;W=g.z(P);X=W.next().value;l=W.next().value;b=X;h=l;b||(b={id:S});x=g.z(p);for(y=x.next();!y.done;y=x.next())if(V=y.value,V===g.YW){if(b.smartDownloadsList)return K.return();b.smartDownloadsList=V}else if(L=g.f4(V).entityType,T={},L==="mainPlaylistEntity"?T.playlistItem=V:L==="mainVideoEntity"&&(T.videoItem=V),!g.rD(T)){E=void 0;if((E=h)==null?0:E.downloads){m=!1;H=g.z(h.downloads);for(Q=H.next();!Q.done;Q=H.next())if(n=Q.value,n.playlistItem===V||n.videoItem===V){m=!0;break}m||h.downloads.push(T)}else h=
{id:O,downloads:[T]};b.downloadsList=O}return K.return({mainDownloadsLibraryEntity:b,mainDownloadsListEntity:h})})},s90=function(N,p){var S,O,P,W,X,l,b,h,x,y,V,L,T,E,m;
return g.r(function(H){if(H.B==1)return S=g.l0("main_downloads_library_id","mainDownloadsLibraryEntity"),O=g.l0("DOWNLOADS_LIST_ENTITY_ID_MANUAL_DOWNLOADS","mainDownloadsListEntity"),g.F(H,q3(N,{mode:"readonly",Hj:!0},function(Q){return g.$H.all([u6(Q,S,"mainDownloadsLibraryEntity"),u6(Q,O,"mainDownloadsListEntity"),u6(Q,g.YW,"mainDownloadsListEntity")])}),2);
P=H.T;W=g.z(P);X=W.next().value;l=W.next().value;b=W.next().value;h=X;x=l;y=b;if(!h)return H.XB(0);if(p===g.YW&&((V=y)==null?0:V.downloads))y.downloads=[];else if((L=x)==null?0:L.downloads)for(T=g.f4(p).entityType,E=0;E<x.downloads.length;E++)if(m=x.downloads[E],T==="mainVideoEntity"&&m.videoItem===p){x.downloads.splice(E,1);break}else if(T==="mainPlaylistEntity"&&m.playlistItem===p){x.downloads.splice(E,1);break}return g.F(H,q3(N,{mode:"readwrite",Hj:!0},function(Q){var n=[I4(Q,h,"mainDownloadsLibraryEntity")];
x&&n.push(I4(Q,x,"mainDownloadsListEntity"));y&&n.push(I4(Q,y,"mainDownloadsListEntity"));return g.$H.all(n)}),0)})},iZ=function(N,p){var S,O,P,W,X,l,b,h,x,y,V;
return g.r(function(L){if(L.B==1)return S=g.l0(p,"transfer"),O=g.l0(p,"videoDownloadContextEntity"),g.F(L,q3(N,{mode:"readonly",Hj:!0},function(T){return g.$H.all([u6(T,S,"transfer"),u6(T,O,"videoDownloadContextEntity")])}),2);
P=L.T;W=g.z(P);X=W.next().value;l=W.next().value;b=X;h=l;V={videoId:p,cotn:(x=b)==null?void 0:x.cotn,offlineModeType:(y=h)==null?void 0:y.offlineModeType};return L.return(V)})},ag=function(N,p,S,O,P){var W,X,l,b,h,x,y,V,L,T,E,m,H,Q,n,K,d,D,u,oH;
return g.r(function(bX){switch(bX.B){case 1:return W=g.l0(N,"musicTrack"),X=g.l0(N,"transfer"),g.F(bX,q3(p,{mode:"readonly",Hj:!0},function(I){return g.$H.all([u6(I,W,"musicTrack"),u6(I,X,"transfer"),wr(I,"musicTrack"),wr(I,"offlineOrchestrationActionWrapperEntity")])}),2);
case 2:l=bX.T;b=g.z(l);h=b.next().value;x=b.next().value;y=b.next().value;V=b.next().value;L=h;T=x;E=y;m=V;if(!L){bX.XB(3);break}return g.F(bX,hXy(L,E),4);case 4:return H=bX.T,g.F(bX,JT(H),3);case 3:Q=[];n=g.z(m);for(K=n.next();!K.done;K=n.next())d=K.value,D=g.f4(d.key).entityId,u=EW(d),oH=g.f4(u.action.entityKey).entityId,D!==N&&oH!==N||TV(S,d.actionProto)||Q.push(d.key);return g.F(bX,q3(p,{mode:"readwrite",Hj:!0},function(I){var A=Q.map(function(k){return D5(I,k)});
A.push(D5(I,W,{I9:!0}));return g.$H.all(A)}),6);
case 6:vG(T),P&&jE(P),lZ(O,{entityKey:W,failureReason:"OFFLINE_OPERATION_FAILURE_REASON_VIDEO_DELETED"}),g.Ls(bX)}})},QD=function(N,p,S,O,P){var W,X,l,b,h,x,y,V,L,T,E,m,H,Q,n,K,d,D,u,oH,bX,I,A,k,v,w,Zb,Tf,bG,iX,o0,xs,k5,U,a,c;
return g.r(function(M){switch(M.B){case 1:return W=g.l0(N,p),X=g.l0("music_downloads_library_id","musicDownloadsLibraryEntity"),g.F(M,q3(S,{mode:"readonly",Hj:!0},function(G){return g.$H.all([u6(G,W,p),u6(G,X,"musicDownloadsLibraryEntity"),wr(G,p),wr(G,"offlineOrchestrationActionWrapperEntity")])}),2);
case 2:l=M.T;b=g.z(l);h=b.next().value;x=b.next().value;y=b.next().value;V=b.next().value;L=h;T=x;E=y;m=V;if(!L){M.XB(3);break}return g.F(M,hXy(L,E),4);case 4:return H=M.T,g.F(M,JT(H),3);case 3:Q=[];n=new Map;if(!L){M.XB(6);break}return g.F(M,xOR(L,E,T),7);case 7:Q=M.T;K=g.z(Q);for(d=K.next();!d.done;d=K.next())D=d.value,u=g.f4(D).entityId,n.set(u,{videoId:u,playlistId:N,offlineDeleteReason:"OFFLINE_DELETE_REASON_PARENT_LIST_DELETE"});return g.F(M,og(S,"transfer"),8);case 8:for(oH=M.T,bX=g.z(oH),
I=bX.next();!I.done;I=bX.next())A=I.value,k=g.f4(A.key).entityId,(v=n.get(k))&&A&&(v.cotn=A.cotn);case 6:w=[];Zb=g.z(m);for(Tf=Zb.next();!Tf.done;Tf=Zb.next())bG=Tf.value,iX=g.f4(bG.key).entityId,o0=EW(bG),iX!==N&&o0.rootActionId!==N||TV(O,bG.actionProto)||w.push(bG.key);xs=g.l0(N,p);return g.F(M,q3(S,{mode:"readwrite",Hj:!0},function(G){var N6=w.map(function(Wg){return D5(G,Wg)});
N6.push(D5(G,xs,{I9:!0}));return g.$H.all(N6)}),9);
case 9:if(!L){M.XB(0);break}Q.reverse();if(!Q.length){M.XB(0);break}k5=g.z(Q);U=k5.next();case 12:if(U.done){M.XB(0);break}a=U.value;c=g.f4(a).entityId;if(!c){M.XB(13);break}return g.F(M,ag(c,S,O,P,n.get(c)),13);case 13:U=k5.next(),M.XB(12)}})},gH=function(N,p,S){var O,P,W,X,l,b,h;
return g.r(function(x){if(x.B==1)return g.F(x,q3(N,{mode:"readwrite",Hj:!0},function(y){var V=wr(y,"transfer"),L=wr(y,"offlineOrchestrationActionWrapperEntity");return g.$H.all([V,L]).then(function(T){T=g.z(T);var E=T.next().value;var m=T.next().value;T=yIl.map(function(K){return pHl(y,K)});
m=g.z(m);for(var H=m.next();!H.done;H=m.next()){H=H.value;var Q=g.f4(H.actionProto.entityKey).entityType==="musicTrack",n=H.actionProto.actionType==="OFFLINE_ORCHESTRATION_ACTION_TYPE_ADD";TV(p,H.actionProto)||Q&&(!Q||n)||T.push(D5(y,H.key,{I9:!0}))}return g.$H.all(T).then(function(){return E})})}),2);
O=x.T;P=g.z(O);for(W=P.next();!W.done;W=P.next())X=W.value,vG(X),l=g.f4(X.key).entityId,b={videoId:l,offlineDeleteReason:void 0,cotn:X.cotn},jE(b),h=g.l0(l,"musicTrack"),lZ(S,{entityKey:h,failureReason:"OFFLINE_OPERATION_FAILURE_REASON_VIDEO_DELETED"});return g.F(x,qhd(),0)})},VXs=function(N){for(var p,S=g.z(N.additionalMetadatas),O=S.next();!O.done;O=S.next())O=O.value,O.offlineMusicVideoData&&(p=O.offlineMusicVideoData);
var P,W,X,l,b;return{id:g.l0(N.videoId,"musicTrack"),videoId:N.videoId,title:N.title,thumbnailDetails:N.thumbnail,lengthMs:String(Number(N.lengthSeconds)*1E3),albumTitle:(P=p)==null?void 0:P.releaseTitle,musicVideoType:(W=p)==null?void 0:W.musicVideoType,contentRating:{explicitType:(X=p)==null?void 0:X.explicitType},artistNames:((l=p)==null?void 0:l.byline)||((b=p)==null?void 0:b.channelName),downloadMetadata:g.l0(N.videoId,"musicTrackDownloadMetadataEntity")}},xOR=function(N,p,S){var O,P,W,X,l,b,
h,x,y,V,L,T,E,m,H,Q,n,K;
return g.r(function(d){O=[];P=new Set;if((W=S)==null?0:(X=W.downloadedTracks)==null?0:X.length)for(l=g.z(S.downloadedTracks),b=l.next();!b.done;b=l.next())h=b.value,P.add(h);if(N.tracks){x=g.z(N.tracks);for(y=x.next();!y.done;y=x.next())V=y.value,P.has(V)||O.push(V);L=g.z(p);for(T=L.next();!T.done;T=L.next())if(E=T.value,E.id!==N.id&&(m=E.tracks))for(H=g.z(m),Q=H.next();!Q.done;Q=H.next())n=Q.value,K=O.indexOf(n),K!==-1&&O.splice(K,1)}return d.return(O)})},hXy=function(N,p){var S,O,P,W,X,l,b,h;
return g.r(function(x){S=BG(N.thumbnailDetails);O=g.z(p);for(P=O.next();!P.done;P=O.next())if(W=P.value,W.id!==N.id)for(X=g.z(BG(W.thumbnailDetails)),l=X.next();!l.done;l=X.next())b=l.value,h=S.indexOf(b),h!==-1&&S.splice(h,1);return x.return(S)})},L5d=function(N,p){var S,O,P,W,X,l,b,h,x;
return g.r(function(y){if(y.B==1)return S=g.l0("music_downloads_library_id","musicDownloadsLibraryEntity"),g.F(y,pg(N,S,"musicDownloadsLibraryEntity"),2);(O=y.T)||(O={id:S});P=g.f4(p).entityType;P==="musicTrack"?(W=O.downloadedTracks)!=null&&W.includes(p)||(O.downloadedTracks=((X=O.downloadedTracks)!=null?X:[]).concat(p)):P==="musicPlaylist"?(l=O.downloadedPlaylists)!=null&&l.includes(p)||(O.downloadedPlaylists=((b=O.downloadedPlaylists)!=null?b:[]).concat(p)):P!=="musicAlbumRelease"||(h=O.downloadedAlbumReleases)!=
null&&h.includes(p)||(O.downloadedAlbumReleases=((x=O.downloadedAlbumReleases)!=null?x:[]).concat(p));return g.F(y,NB(N,O,"musicDownloadsLibraryEntity"),0)})},Txq=function(N,p){var S,O,P,W,X,l,b;
return g.r(function(h){if(h.B==1)return S=g.l0("music_downloads_library_id","musicDownloadsLibraryEntity"),g.F(h,pg(N,S,"musicDownloadsLibraryEntity"),2);O=h.T;if(!O)return h.XB(0);P=g.f4(p).entityType;P==="musicTrack"?W=O.downloadedTracks:P==="musicPlaylist"&&(W=O.downloadedPlaylists);if((X=W)==null?0:X.length)for(l=0;l<W.length;l++)if(b=W[l],b===p){W.splice(l,1);break}return g.F(h,NB(N,O,"musicDownloadsLibraryEntity"),0)})},vQ0=function(N){var p=N.videos;
N=[];var S=[];if(p){p=g.z(p);for(var O=p.next();!O.done;O=p.next()){var P=O.value.offlineVideoData.videoId;O=g.l0(P,"musicTrack");P=g.l0(P,"musicTrackDownloadMetadataEntity");N.push(O);S.push(P)}}return{uJ:N,TC:S}},cG=function(N,p,S){p={track:VXs(p)};
S&&(p.playlistId=S);if(N=g.t(N.actionMetadata,BxQ))p.maximumDownloadQuality=N.maximumDownloadQuality;return{musicTrackEntityActionMetadata:p}},EQE=function(N){var p,S,O,P,W,X,l,b;
return g.r(function(h){switch(h.B){case 1:return p=g.Lf(),S=Egf(N),O=g.$_(zXB),g.vg(h,2),W={UQ:!0},g.F(h,g.Wf(p,S,O,void 0,W),4);case 4:P=h.T;g.Bg(h,3);break;case 2:X=g.zd(h);if(X instanceof g.xV)throw l="GetOffline network manager error: "+X.message,Xv(l,X),Error(l);Xv("GetOffline fetch request error",X);throw Error("GetOffline fetch request error");case 3:b=Fv(P);if(!P)throw Xv("Network request failed"),Error("Network request failed");if(b!==void 0)ng(b);else if(!P.videos||!P.videos.length)throw Xv("No data"),
Error("No data");return h.return(P.videos.map(function(x){return x.offlineVideoData}))}})},$Ot=function(N){var p,S,O,P,W,X,l,b;
return g.r(function(h){switch(h.B){case 1:return p=g.Lf(),S=$CR(N),O=g.$_(zXB),g.vg(h,2),W={UQ:!0},g.F(h,g.Wf(p,S,O,void 0,W),4);case 4:P=h.T;g.Bg(h,3);break;case 2:X=g.zd(h);if(X instanceof g.xV)throw l="GetOffline network manager error for playlist: "+X.message,Xv(l,X),Error(l);Xv("GetOffline fetch request error for playlist",X);throw Error("GetOffline fetch request error for playlist");case 3:b=Fv(P);if(!P)throw Xv("Network request failed for playlist"),Error("Network request failed for playlist");
if(b!==void 0)ng(b,"playlist");else if(!P.playlists||!P.playlists.length)throw Xv("No data for playlist"),Error("No data for playlist");return h.return(P.playlists.map(function(x){return x.offlinePlaylistData}))}})},mOq=function(N,p,S,O){var P,W,X,l,b,h,x,y,V,L,T,E,m,H,Q,n,K,d,D,u,oH,bX,I,A,k,v,w,Zb,Tf,bG;
return g.r(function(iX){switch(iX.B){case 1:return g.F(iX,SE(),2);case 2:P=iX.T;if(!P)return iX.return([]);W=[];if((X=O)==null?0:X.length){W=O;iX.XB(3);break}return g.F(iX,og(P,"mainPlaylistEntity"),4);case 4:W=iX.T;case 3:if(!W.length)return iX.return([]);l=[];b=Date.now()/1E3;h=g.z(W);x=h.next();case 5:if(x.done)return l.length?g.F(iX,JIf(l),10):iX.return([]);y=x.value;if(!y.downloadState){V=void 0;iX.XB(8);break}return g.F(iX,pg(P,y.downloadState,"mainPlaylistDownloadStateEntity"),9);case 9:V=
iX.T;case 8:L=V;T=void 0;m=(E=(T=y)==null?void 0:T.entityMetadata)&&E.nextAutoRefreshIntervalSeconds?Number(E.nextAutoRefreshIntervalSeconds):NaN;H=Number.isNaN(m)?N:m;n=Q=void 0;K=((Q=L)==null?0:Q.lastSyncedTimestampMillis)?Number((n=L)==null?void 0:n.lastSyncedTimestampMillis)/1E3:0;D=d=void 0;u=((d=L)==null?0:d.addedTimestampMillis)?Number((D=L)==null?void 0:D.addedTimestampMillis)/1E3:0;if(S||!E||K+H<=b){oH=[];bX=void 0;if((bX=y.videos)==null?0:bX.length)for(I=g.z(y.videos),A=I.next();!A.done;A=
I.next())k=A.value,v=JSON.parse(g.f4(k).entityId),v.videoId&&oH.push(v.videoId);w="0";E&&(Zb=void 0,w=String(Number((Zb=E.offlineLastModifiedTimestampSeconds)!=null?Zb:0).toFixed()));Tf={playlistId:y.playlistId,videoIds:oH,offlineLastModifiedTimestamp:w,autoSync:p,offlineDateAddedTimestamp:String(u.toFixed())};l.push(Tf)}x=h.next();iX.XB(5);break;case 10:return bG=iX.T,iX.return(bG)}})},UOR=function(){var N,p,S,O,P;
return g.r(function(W){if(W.B==1)return g.F(W,SE(),2);if(W.B!=3)return(N=W.T)?g.F(W,og(N,"refresh"),3):W.return(!1);p=W.T;if((S=p[0])==null||!S.refreshTime)return W.return(!1);O=Number(p[0].refreshTime);P=Date.now()/1E3;return W.return(isFinite(O)&&P>=O)})},i_f=function(N,p){var S,O,P;
return g.r(function(W){switch(W.B){case 1:return g.vg(W,2),g.F(W,H_Q(N,p),4);case 4:return O=W.T,g.F(W,W5C(O),5);case 5:S=fVE(O);g.Bg(W,3);break;case 2:P=g.zd(W),Xv("getAndProcessSmartDownloadsResponse request or processing error",P);case 3:return W.return(S)}})},aVE=function(N,p,S,O){var P,W,X,l,b,h,x,y,V,L,T,E,m,H,Q,n,K,d,D,u,oH,bX,I,A,k,v,w,Zb,Tf,bG;
return g.r(function(iX){switch(iX.B){case 1:return g.F(iX,SE(),2);case 2:P=iX.T;if(!P)return iX.return([]);W=[];if((X=O)==null?0:X.length){W=O;iX.XB(3);break}return g.F(iX,og(P,"musicPlaylist"),4);case 4:W=iX.T;case 3:if(!W.length)return iX.return([]);l=[];b=Date.now()/1E3;h=g.z(W);x=h.next();case 5:if(x.done)return l.length?g.F(iX,JIf(l),10):iX.return([]);y=x.value;V=void 0;T=(L=(V=y)==null?void 0:V.entityMetadata)&&L.nextAutoRefreshIntervalSeconds?Number(L.nextAutoRefreshIntervalSeconds):NaN;E=
Number.isNaN(T)?N:T;H=m=0;Q="DOWNLOAD_SYNC_STATE_UNKNOWN";if(!y.downloadMetadata){iX.XB(8);break}return g.F(iX,pg(P,y.downloadMetadata,"musicPlaylistDownloadMetadataEntity"),9);case 9:n=iX.T,d=K=void 0,m=Number((d=(K=n)==null?void 0:K.addedTimestampMillis)!=null?d:"0")/1E3,u=D=void 0,H=Number((u=(D=n)==null?void 0:D.lastModifiedTimestampMillis)!=null?u:"0")/1E3,bX=oH=void 0,Q=(bX=(oH=n)==null?void 0:oH.syncState)!=null?bX:"DOWNLOAD_SYNC_STATE_UNKNOWN";case 8:I=void 0;if(S||Q!=="DOWNLOAD_SYNC_STATE_UP_TO_DATE"||
!L||Number((I=L.lastSyncedTimestampSeconds)!=null?I:0)+E<=b){A=[];k=void 0;if((k=y.tracks)==null?0:k.length)for(v=g.z(y.tracks),w=v.next();!w.done;w=v.next())Zb=w.value,A.push(g.f4(Zb).entityId);Tf={playlistId:y.playlistId,videoIds:A,offlineLastModifiedTimestamp:String(H.toFixed()),autoSync:p,offlineDateAddedTimestamp:String(m.toFixed())};l.push(Tf)}x=h.next();iX.XB(5);break;case 10:return bG=iX.T,iX.return(bG)}})},H_Q=function(N,p){var S,O,P,W,X,l,b,h,x,y;
return g.r(function(V){switch(V.B){case 1:return S=g.Lf(),g.F(V,SE(),2);case 2:O=V.T;if(!O){V.XB(3);break}return g.F(V,QSG(O),4);case 4:P=V.T;case 3:var L=P;W={context:g.BV(),browseId:"FEdownloads",browseRequestSupportedMetadata:{downloadsBrowseParams:{offlineFeatureSettingState:{isSdEnabled:N},offlineClientState:L,clientStateRequestData:{preferredFormatType:p}}}};X=g.$_(Q9f);g.vg(V,5);b={UQ:!0};return g.F(V,g.Wf(S,W,X,void 0,b),7);case 7:l=V.T;g.Bg(V,6);break;case 5:h=g.zd(V);if(h instanceof g.xV)throw x=
"DPS network manager error for smart downloads: "+h.message,Xv(x,h),Error(x);Xv("DPS fetch request error for smart downloads",h);throw Error("DPS fetch request error for smart downloads");case 6:y=Fv(l);if(l)y!==void 0&&ng(y,"smart downloads");else throw Xv("Network request failed for smart downloads"),Error("Network request failed for smart downloads");return V.return(l)}})},cIY=function(N,p){var S,O,P,W,X,l,b,h;
return g.r(function(x){switch(x.B){case 1:return S=g.Lf(),O={context:g.BV(),videoPlaybackPositionEntities:N,lastSyncTimestampUsec:p},P=g.$_(gQy),g.vg(x,2),X={UQ:!0},g.F(x,g.Wf(S,O,P,void 0,X),4);case 4:W=x.T;g.Bg(x,3);break;case 2:l=g.zd(x);if(l instanceof g.xV)throw b="VPPS network manager error: "+l.message,Xv(b,l),Error(b);Xv("VPPS fetch request error",l);throw Error("VPPS fetch request error");case 3:h=Fv(W);if(W)h!==void 0&&ng(h,"position sync");else throw Xv("Network request failed for position sync"),
Error("Network request failed for position sync");return x.return(W)}})},nQy=function(N,p,S){var O,P,W,X,l,b,h,x;
return g.r(function(y){switch(y.B){case 1:O=g.Lf();var V=S.refreshData,L=S.isEnqueuedForExpiredStreamUrlRefetch,T=S.UN,E=S.offlineSourceData,m=S.mediaCapabilities,H={entityKey:N};V&&(H.refreshData=V);L&&(H.isExpiredStreamUrlRefetch=L);T&&(H.downloadParameters=T);E&&(H.offlineSourceData=E);V={context:g.TZ(p),signatureTimestamp:20069,videos:[H]};m&&(V.mediaCapabilities=m);P=V;W=g.$_(F5R);g.vg(y,2);l={UQ:!0};return g.F(y,g.Wf(O,P,W,void 0,l),4);case 4:X=y.T;g.Bg(y,3);break;case 2:b=g.zd(y);if(b instanceof
g.xV)throw h="GetPDE network manager error: "+b.message,Xv(h,b),Error(h);Xv("GetPDE fetch request error",b);throw Error("GetPDE fetch request error");case 3:x=Fv(X);if(X)x!==void 0&&ng(x,"PDE");else throw Xv("Network request failed for PDE"),Error("Network request failed for PDE");return y.return(X)}})},Fv=function(N){var p;
return(p=N.errorMetadata)==null?void 0:p.status},ng=function(N,p){p=p?" for "+p:"";
if(N===0)throw N="Empty response body"+p,Xv(N),Error(N);N="Response with error"+p;Xv(N);throw Error(N);},JIf=function(N){var p,S,O,P,W,X,l,b;
return g.r(function(h){switch(h.B){case 1:return p=g.Lf(),S=JEf(N),O=g.$_(rIC),g.vg(h,2),W={UQ:!0},g.F(h,g.Wf(p,S,O,void 0,W),4);case 4:P=h.T;g.Bg(h,3);break;case 2:X=g.zd(h);if(X instanceof g.xV)throw l="offlinePlaylistSyncCheck network manager error: "+X.message,Xv(l,X),Error(l);Xv("offlinePlaylistSyncCheck fetch request error",X);throw Error("offlinePlaylistSyncCheck fetch request error");case 3:b=Fv(P);if(!P)throw Xv("Network request failed for playlist sync"),Error("Network request failed for playlist sync");
if(b!==void 0)ng(b,"playlist sync");else if(!P.offlinePlaylistSyncCheckDatas||!P.offlinePlaylistSyncCheckDatas.length)throw Xv("No data for playlist sync"),Error("No data for playlist sync");return h.return(P.offlinePlaylistSyncCheckDatas.map(function(x){return x.offlinePlaylistSyncCheckData}))}})},rH=function(N){this.T=N},MXd=function(N,p){var S,O,P,W,X,l;
return g.r(function(b){switch(b.B){case 1:S=new Map,O=g.z(p),P=O.next();case 2:if(P.done){b.XB(4);break}W=P.value;X=S;l=X.set;return g.F(b,N.B(W),5);case 5:l.call(X,W,b.T);P=O.next();b.XB(2);break;case 4:return b.return(S)}})},MB=function(N,p,S,O,P,W){p=g.l0(p,S);
O=Object.assign({},W,{priority:O,retryScheduleIntervalsInSeconds:P});return{actionType:N,entityKey:p,actionMetadata:O}},Kg=function(N,p,S,O,P,W){this.status=N;
this.T=p;this.G=S;this.B=O;this.X=P;this.downloadState=W},K5Q=function(N,p,S){this.T=N;
this.aj=p;this.X=S},dOY=function(N,p){var S,O,P,W,X,l,b,h,x;
return g.r(function(y){switch(y.B){case 1:return S=p.entityKey,P=(O=g.t(p.actionMetadata,Y2))==null?void 0:O.isEnqueuedForExpiredStreamUrlRefetch,g.vg(y,2),W=void 0,g.F(y,YzV(N,p),4);case 4:W=y.T;g.vg(y,5);var V=(V=g.t(p.actionMetadata,Y2))?{maximumDownloadQuality:V.maximumDownloadQuality}:void 0;return g.F(y,nQy(S,N.aj,{isEnqueuedForExpiredStreamUrlRefetch:P,UN:V,offlineSourceData:W}),7);case 7:X=y.T;g.Bg(y,6,2);break;case 5:return g.zd(y,2),l=hT(p)?"OFFLINE_ORCHESTRATION_FAILURE_REASON_RECOVERABLE_NETWORK_ERROR":
"OFFLINE_ORCHESTRATION_FAILURE_REASON_UNRECOVERABLE_NETWORK_ERROR",Xv("PDE handleAdd error"),y.return(GV(p,!1,void 0,"OFFLINE_OPERATION_FAILURE_REASON_NETWORK_REQUEST_FAILED",l,"DOWNLOAD_STATE_FAILED"));case 6:return g.F(y,GjC(N,X,p),8);case 8:return y.return(GV(p,!0,X.orchestrationActions));case 2:return b=g.zd(y),h="OFFLINE_OPERATION_FAILURE_REASON_UNKNOWN",x="OFFLINE_ORCHESTRATION_FAILURE_REASON_DATABASE_OPERATION_FAILED",b instanceof g.V9&&b.type==="QUOTA_EXCEEDED"&&(h="OFFLINE_OPERATION_FAILURE_REASON_DATABASE_REQUEST_FAILED",
x="OFFLINE_ORCHESTRATION_FAILURE_REASON_NO_STORAGE"),Xv("PDE handleAdd error"),y.return(GV(p,!1,void 0,h,x,"DOWNLOAD_STATE_FAILED"))}})},AIE=function(N,p){var S,O,P,W,X,l,b,h,x,y,V,L,T,E,m,H,Q,n,K,d,D,u,oH,bX;
return g.r(function(I){switch(I.B){case 1:return S=p.entityKey,O=g.f4(S).entityId,g.F(I,q3(N.T,{mode:"readonly",Hj:!0},function(A){var k=u6(A,S,"playbackData"),v=u6(A,g.l0(O,"offlineVideoPolicy"),"offlineVideoPolicy");A=u6(A,g.l0(O,"transfer"),"transfer");return g.$H.all([k,v,A])}),2);
case 2:P=I.T;W=g.z(P);X=W.next().value;l=W.next().value;b=W.next().value;h=X;x=l;y=b;if(!h||!x)return I.return(GV(p,!0));V=[];E=((T=h)==null?0:T.playerResponseJson)?JSON.parse(h.playerResponseJson):null;if(!(y&&E&&N.aj.U("html5_refresh_deprecated_downloads"))){I.XB(3);break}L=eXt(N,E,y);return g.F(I,CEE(N,y),4);case 4:V=I.T;case 3:m={lastPlayerResponseTimestampSeconds:h.playerResponseTimestamp,offlineToken:x.offlineToken,formatIds:V};H={};if((Q=y)==null?0:Q.maximumDownloadQuality)H.maximumDownloadQuality=
y.maximumDownloadQuality;g.vg(I,5);n=void 0;return g.F(I,YzV(N,p),7);case 7:return n=I.T,g.vg(I,8),g.F(I,nQy(S,N.aj,{refreshData:m,UN:H,offlineSourceData:n,mediaCapabilities:L}),10);case 10:K=I.T;g.Bg(I,9,5);break;case 8:return g.zd(I,5),d=hT(p)?"OFFLINE_ORCHESTRATION_FAILURE_REASON_RECOVERABLE_NETWORK_ERROR":"OFFLINE_ORCHESTRATION_FAILURE_REASON_UNRECOVERABLE_NETWORK_ERROR",Xv("PDE handleRefresh error"),I.return(GV(p,!1,void 0,"OFFLINE_OPERATION_FAILURE_REASON_NETWORK_REQUEST_FAILED",d,"DOWNLOAD_STATE_FAILED"));
case 9:return g.F(I,GjC(N,K,p),11);case 11:return I.return(GV(p,!0,K.orchestrationActions));case 5:return D=g.zd(I),u="PDE handleRefresh error",D instanceof Error&&(u="PDE handleRefresh error: "+D.message),oH="OFFLINE_OPERATION_FAILURE_REASON_UNKNOWN",bX="OFFLINE_ORCHESTRATION_FAILURE_REASON_DATABASE_OPERATION_FAILED",D instanceof g.V9&&D.type==="QUOTA_EXCEEDED"&&(oH="OFFLINE_OPERATION_FAILURE_REASON_DATABASE_REQUEST_FAILED",bX="OFFLINE_ORCHESTRATION_FAILURE_REASON_NO_STORAGE"),Xv(u),I.return(GV(p,
!1,void 0,oH,bX,"DOWNLOAD_STATE_FAILED"))}})},YzV=function(N,p){var S,O,P,W;
return g.r(function(X){if(X.B==1)return S=g.f4(p.entityKey).entityId,O=g.l0(S,"videoDownloadContextEntity"),g.F(X,pg(N.T,O,"videoDownloadContextEntity"),2);P=X.T;return(W=P)!=null&&W.offlineModeType?X.return({offlineModeType:P.offlineModeType}):X.return(void 0)})},GjC=function(N,p,S){var O,P,W,X,l;
return g.r(function(b){if(b.B==1){if(!p.frameworkUpdates||!g.t(p.frameworkUpdates,HG))return b.return();if(!(g.t(p.frameworkUpdates,HG).mutations&&g.t(p.frameworkUpdates,HG).mutations.length>0&&g.t(p.frameworkUpdates,HG).mutations[0].type==="ENTITY_MUTATION_TYPE_DELETE"))return b.XB(2);O=g.f4(g.t(p.frameworkUpdates,HG).mutations[0].entityKey).entityId;return g.F(b,iZ(N.T,O),3)}if(b.B!=2){P=b.T;W=g.t(S.actionMetadata,Y2);if(l=(X=W)==null?void 0:X.playlistId)P.playlistId=l;P.offlineDeleteReason="OFFLINE_DELETE_REASON_UNKNOWN";
return g.wN(N.aj)?g.F(b,UW(O,N.T,S,N.X,P),2):g.eM(N.aj)?g.F(b,ag(O,N.T,S,N.X),2):b.XB(2)}return g.F(b,xCG(g.t(p.frameworkUpdates,HG)),0)})},GV=function(N,p,S,O,P,W){return new Kg(p?"OFFLINE_ORCHESTRATION_ACTION_RESULT_SUCCESS":"OFFLINE_ORCHESTRATION_ACTION_RESULT_FAILURE",hT(N),S,O,P,W)},eXt=function(N,p,S){p=Z50(N.aj,S.cotn,p);
S=g.hq(p);return g.DhX(p,S,N.aj)},CEE=function(N,p){var S,O,P,W,X,l,b,h,x,y,V;
return g.r(function(L){if(L.B==1)return S=[],g.F(L,q3(N.T,{mode:"readonly",Hj:!0},function(T){var E=[],m=p.offlineVideoStreams;if(m){m=g.z(m);for(var H=m.next();!H.done;H=m.next())E.push(u6(T,H.value,"offlineVideoStreams"))}return g.$H.all(E)}),2);
if(O=L.T)for(P=g.z(O),W=P.next();!W.done;W=P.next())if(X=W.value,l=void 0,(l=X)==null?0:l.streamsProgress)for(b=X.streamsProgress,h=0;h<b.length;h++)x=b[h],y=JSON.parse(x.formatStreamBytes),V={itag:y.itag,lmt:y.lastModified,xtags:y.xtags},S.push(V);return L.return(S)})},tXQ=function(N,p){this.T=N;
this.aj=p},uXf=function(N,p){var S,O,P,W,X,l,b,h,x,y,V,L;
return g.r(function(T){switch(T.B){case 1:return S=hT(p),g.F(T,og(N.T,"videoPlaybackPositionEntity"),2);case 2:O=T.T;if(O.length===0)return T.return(new Kg("OFFLINE_ORCHESTRATION_ACTION_RESULT_SUCCESS",S));g.vg(T,3);return g.F(T,Cj.getInstance(),5);case 5:P=T.T;if(!P)throw Error("prefStorage is undefined");return g.F(T,P.get("psi"),6);case 6:return W=T.T,b=(l=(X=W)==null?void 0:X.aY)!=null?l:"0",g.F(T,cIY(O,b),7);case 7:return h=T.T,x={isPaused:h.watchHistoryPaused,aY:h.syncTimestampUsec},g.F(T,P.set("psi",
x),8);case 8:if(x.isPaused){T.XB(9);break}y=g.t(h.frameworkUpdates,HG);if(!h.frameworkUpdates||!y){T.XB(9);break}return g.F(T,xCG(y),9);case 9:g.Bg(T,4);break;case 3:return V=g.zd(T),L="PPE handleRefresh error: "+(V instanceof Error?V.message:"unknown error"),Xv(L),T.return(new Kg("OFFLINE_ORCHESTRATION_ACTION_RESULT_FAILURE",S,void 0,"OFFLINE_OPERATION_FAILURE_REASON_DATABASE_REQUEST_FAILED","OFFLINE_ORCHESTRATION_FAILURE_REASON_DATABASE_OPERATION_FAILED"));case 4:return T.return(new Kg("OFFLINE_ORCHESTRATION_ACTION_RESULT_SUCCESS",
S))}})},RXl=function(N,p){var S,O,P,W,X,l,b,h;
return g.r(function(x){switch(x.B){case 1:return S=hT(p),O=g.f4(p.entityKey).entityId,g.vg(x,2),g.F(x,Cj.getInstance(),4);case 4:P=x.T;if(!P)throw Error("prefStorage is undefined");return g.F(x,P.get("psi"),5);case 5:W=x.T;X=g.t(p.actionMetadata,wc0);if(((l=W)==null?void 0:l.isPaused)!==!1||(b=X)==null||!b.lastPlaybackPositionSeconds){x.XB(6);break}h={key:g.l0(O,"videoPlaybackPositionEntity"),videoId:O,lastPlaybackPositionSeconds:X.lastPlaybackPositionSeconds};return g.F(x,NB(N.T,h,"videoPlaybackPositionEntity"),
6);case 6:g.Bg(x,3);break;case 2:return g.zd(x),x.return(new Kg("OFFLINE_ORCHESTRATION_ACTION_RESULT_FAILURE",S,void 0,"OFFLINE_OPERATION_FAILURE_REASON_DATABASE_REQUEST_FAILED","OFFLINE_ORCHESTRATION_FAILURE_REASON_DATABASE_OPERATION_FAILED"));case 3:return x.return(new Kg("OFFLINE_ORCHESTRATION_ACTION_RESULT_SUCCESS",S))}})},IVy=function(N,p){var S,O,P;
return g.r(function(W){switch(W.B){case 1:S=hT(p);g.vg(W,2);O=g.f4(p.entityKey).entityId;if(O==="!*$_ALL_ENTITIES_!*$")return g.F(W,lXl(N.T),5);P=g.l0(O,"videoPlaybackPositionEntity");return g.F(W,fXs(N.T,P),5);case 5:g.Bg(W,3);break;case 2:return g.zd(W),W.return(new Kg("OFFLINE_ORCHESTRATION_ACTION_RESULT_FAILURE",S,void 0,"OFFLINE_OPERATION_FAILURE_REASON_UNKNOWN","OFFLINE_ORCHESTRATION_FAILURE_REASON_DATABASE_OPERATION_FAILED"));case 3:return W.return(new Kg("OFFLINE_ORCHESTRATION_ACTION_RESULT_SUCCESS",
S))}})},DOV=function(N,p){this.api=N;
this.T=p;this.logger=new g.sA("woffle");this.B=!1;this.Rc={Ud:this.Ud};this.logger.debug("Initialized OfflineMediaManager")},Z_0=function(N){return g.r(function(p){return p.return(zTY(N))})},kjE=function(N){var p;
return g.r(function(S){if(S.B==1)return g.F(S,g.N$_(N),2);p=S.T;return S.return(p.filter(function(O){return!!O.url}).map(function(O){return O.url}))})},dH=function(N,p){var S=g.Uo(p);
if(S===1||S===0)return Promise.resolve();(S=qzB(N,p))&&S.stopVideo();N.X=0;return Z_0(p)},eE=function(N,p,S,O){S=S===void 0?!1:S;
O=O===void 0?!0:O;var P=typeof p==="string"?p:p.videoDetails.videoId;g.Uo(P)===2&&((p=qzB(N,P))?p.stopVideo():N.logger.info(function(){return"Corresponding player for "+P+" not found. Pausing anyway"}),g.H7(P,2),N.X=2,S?Nsf(N.T):O&&pJf(N.T))},qzB=function(N,p){var S;
return((S=N.player)==null?void 0:S.getVideoData().videoId)===p?N.player:null},o6y=function(N,p,S){p.getPlayerResponse();
g.H7(p.videoId,2);N.X=2;N.B=!1;var O;(O=N.player)==null||O.dispose();N.player=N.api.Tb(9,p);p={};g.lY(N.player,(p.localmediachange=N.J2,p.signatureexpired=N.zr,p.statechange=N.UpP,p),N);var P=N.Ud(S);g.CvX(N.player,g.oW(P,P,!0,"m"),!1);N.logger.debug(function(){return"Starting headless playback with quality: "+P});
g.UY(N.player,!1)},SIt=function(N,p){this.T=N;
this.aj=p},PLl=function(N,p){var S,O;
return g.r(function(P){switch(P.B){case 1:return S=hT(p),g.F(P,pg(N.T,p.entityKey,"transfer"),2);case 2:if(O=P.T)return P.return(new Kg("OFFLINE_ORCHESTRATION_ACTION_RESULT_SUCCESS",S));g.vg(P,3);return g.F(P,O$V(N,p),5);case 5:g.Bg(P,4);break;case 3:return g.zd(P),P.return(new Kg("OFFLINE_ORCHESTRATION_ACTION_RESULT_FAILURE",S,void 0,"OFFLINE_OPERATION_FAILURE_REASON_DATABASE_REQUEST_FAILED","OFFLINE_ORCHESTRATION_FAILURE_REASON_DATABASE_OPERATION_FAILED"));case 4:return P.return(new Kg("OFFLINE_ORCHESTRATION_ACTION_RESULT_SUCCESS",
S))}})},WWl=function(N,p){var S,O;
return g.r(function(P){switch(P.B){case 1:return S=hT(p),g.F(P,pg(N.T,p.entityKey,"transfer"),2);case 2:O=P.T;if(!O||O.transferState!=="TRANSFER_STATE_COMPLETE")return P.return(new Kg("OFFLINE_ORCHESTRATION_ACTION_RESULT_SUCCESS",S));g.vg(P,3);return g.F(P,O$V(N,p,!0),5);case 5:g.Bg(P,4);break;case 3:return g.zd(P),P.return(new Kg("OFFLINE_ORCHESTRATION_ACTION_RESULT_FAILURE",S,void 0,"OFFLINE_OPERATION_FAILURE_REASON_DATABASE_REQUEST_FAILED","OFFLINE_ORCHESTRATION_FAILURE_REASON_DATABASE_OPERATION_FAILED"));
case 4:return P.return(new Kg("OFFLINE_ORCHESTRATION_ACTION_RESULT_SUCCESS",S))}})},XJR=function(N,p){var S,O,P,W,X,l,b,h,x,y;
return g.r(function(V){switch(V.B){case 1:return S=hT(p),O=g.f4(p.entityKey).entityId,g.F(V,q3(N.T,{mode:"readonly",Hj:!0},function(L){var T=u6(L,p.entityKey,"transfer");L=u6(L,g.l0(O,"videoDownloadContextEntity"),"videoDownloadContextEntity");return g.$H.all([T,L])}),2);
case 2:P=V.T;W=g.z(P);X=W.next().value;l=W.next().value;b=X;h=l;if(!b||b.transferState!=="TRANSFER_STATE_WAITING_FOR_PLAYER_RESPONSE_REFRESH")return V.return(new Kg("OFFLINE_ORCHESTRATION_ACTION_RESULT_SUCCESS",S));g.vg(V,3);b.transferState="TRANSFER_STATE_TRANSFER_IN_QUEUE";return g.F(V,NB(N.T,b,"transfer"),5);case 5:x=g.f4(b.key).entityId;sW({transferStatusType:"TRANSFER_STATUS_TYPE_REENQUEUED_BY_PLAYER_RESPONSE_REFRESH"},{videoId:x,YS:b,offlineModeType:(y=h)==null?void 0:y.offlineModeType});g.Bg(V,
4);break;case 3:return g.zd(V),V.return(new Kg("OFFLINE_ORCHESTRATION_ACTION_RESULT_FAILURE",S,void 0,"OFFLINE_OPERATION_FAILURE_REASON_DATABASE_REQUEST_FAILED","OFFLINE_ORCHESTRATION_FAILURE_REASON_DATABASE_OPERATION_FAILED"));case 4:return V.return(new Kg("OFFLINE_ORCHESTRATION_ACTION_RESULT_SUCCESS",S))}})},O$V=function(N,p,S){S=S===void 0?!1:S;
var O,P,W,X,l,b,h,x,y,V,L,T,E,m,H;return g.r(function(Q){switch(Q.B){case 1:return O=g.t(p.actionMetadata,fUf),P=g.f4(p.entityKey).entityId,W=g.l0(P,"downloadStatusEntity"),g.F(Q,q3(N.T,{mode:"readonly",Hj:!0},function(n){var K=u6(n,W,"downloadStatusEntity");n=u6(n,g.l0(P,"videoDownloadContextEntity"),"videoDownloadContextEntity");return g.$H.all([K,n])}),2);
case 2:return X=Q.T,l=g.z(X),b=l.next().value,h=l.next().value,x=b,y=h,V="TRANSFER_STATE_TRANSFER_IN_QUEUE",((L=x)==null?void 0:L.downloadState)==="DOWNLOAD_STATE_USER_DELETED"&&(V="TRANSFER_STATE_PAUSED_BY_USER"),m={key:p.entityKey,transferState:V,cotn:g.E8(16),enqueuedTimestampMs:Date.now().toString(),maximumDownloadQuality:(T=O)==null?void 0:T.maximumDownloadQuality,preferredAudioTrack:(E=O)==null?void 0:E.preferredAudioTrack,transferRetryCount:0,isRefresh:S,hasLoggedFirstStarted:!1},g.F(Q,q3(N.T,
{mode:"readwrite",Hj:!0},function(n){var K=[];S&&K.push(D5(n,g.l0(P,"offlineVideoStreams")));K.push(I4(n,m,"transfer"));return g.$H.all(K)}),3);
case 3:if(!S){Q.XB(4);break}return g.F(Q,Z_0(P),4);case 4:sW({transferStatusType:"TRANSFER_STATUS_TYPE_ENQUEUED",statusType:"ADDED_TO_QUEUE"},{videoId:P,YS:m,offlineModeType:(H=y)==null?void 0:H.offlineModeType}),g.Ls(Q)}})},b$0=function(N,p,S,O){if(!N.action.entityKey)throw Error("entityKey is missing.");
var P=g.f4(N.action.entityKey);P={entityType:P.IE,entityId:P.entityId,offlineOrchestrationActionType:N.action.actionType,orchestrationAction:{orchestrationActionId:N.actionId}};p&&(P.offlineOrchestrationActionResult=p.status,P.isRetryable=S?!1:p.T,p.X&&(P.offlineOrchestrationFailureReason=lUl(p.X,P.isRetryable)));var W,X;if((W=N.action.actionMetadata)==null?0:(X=W.offlineLoggingData)==null?0:X.offlineModeType)P.offlineModeType=N.action.actionMetadata.offlineLoggingData.offlineModeType;O&&(P.additionalOrchestrationActions=
O.map(function(l){return{orchestrationActionId:l.actionId}}));
return P},lUl=function(N,p){return N!=="OFFLINE_ORCHESTRATION_FAILURE_REASON_RECOVERABLE_NETWORK_ERROR"||p?N==="OFFLINE_ORCHESTRATION_FAILURE_REASON_UNRECOVERABLE_NETWORK_ERROR"&&p?"OFFLINE_ORCHESTRATION_FAILURE_REASON_RECOVERABLE_NETWORK_ERROR":N:"OFFLINE_ORCHESTRATION_FAILURE_REASON_UNRECOVERABLE_NETWORK_ERROR"},jpR=function(N,p){var S={offlineOrchestrationContext:b$0(N)};
p=i5B(p,S);aX0(H5G(),p,N.rootActionId)},spQ=function(N,p,S,O){O=O===void 0?[]:O;
p={offlineOrchestrationContext:b$0(N,p,S,O)};p=i5B(3,p);aX0(H5G(),p,N.rootActionId)},hnQ=function(){this.actions=[]},x7q=function(N,p){p=g.z(p);
for(var S=p.next();!S.done;S=p.next())S=S.value,jpR(S,1),N.actions.push(S);N.actions.sort(N.T)},yYC=function(N,p){if(p)for(var S=0;S<N.actions.length;S++)if(p==="!*$_ALL_ENTITIES_!*$"&&N.actions[S].actionId!==p||p!=="!*$_ALL_ENTITIES_!*$"&&N.actions[S].rootActionId===p&&N.actions[S].actionId!==p)N.actions.splice(S,1),S--},VCs=function(N,p){N=g.z(N.actions);
for(var S=N.next();!S.done;S=N.next())if(S.value.actionId===p)return!0;return!1},Cg=function(N,p,S,O,P){g.e.call(this);
var W=this;this.B=N;this.py=p;this.u_=S;this.j=O;this.aj=P;this.T=new hnQ;this.N=new g.kJ;this.X=new g.k6(function(){W.retry()});
this.Y=NaN;this.K=!1;this.Rc={Vov:function(){return W.T},
Ta:function(){return W.N},
TmH:function(){return W.X},
retry:function(){return W.retry()}};
g.C(this,this.X);this.W=this.B.observe(this.zk.bind(this))},v6d=function(N,p,S,O,P){var W;
return g.r(function(X){if(X.B==1)return W=new Cg(N,p,S,O,P),g.F(X,LWs(W),2);Tsq(W);return X.return(W)})},Tsq=function(N){var p=N.T.actions[0];
return N.G?((p==null?void 0:p.action.actionType)==="OFFLINE_ORCHESTRATION_ACTION_TYPE_DELETE"&&N.G[0].action.actionType!=="OFFLINE_ORCHESTRATION_ACTION_TYPE_DELETE"&&(N.K=!0),Promise.resolve()):Bsq(N)},Bsq=function(N){var p,S,O,P,W,X,l,b,h,x,y,V,L,T,E,m,H;
return g.r(function(Q){switch(Q.B){case 1:if(N.G)throw Error("Already processing an action");if(N.wH())return Q.return();p=N.T.actions.shift();CRR(N.u_,!p);if(p===void 0)return Q.return();p.action.actionType==="OFFLINE_ORCHESTRATION_ACTION_TYPE_REFRESH"&&p.actionId==="DOWNLOADS_LIST_ENTITY_ID_SMART_DOWNLOADS"&&yYC(N.T,p.actionId);S="";p.action.actionType==="OFFLINE_ORCHESTRATION_ACTION_TYPE_DELETE"&&p.rootActionId===p.actionId&&(S=p.actionId);O=[p];N.G=O;if(P=N.py[p.entityType]){Q.XB(2);break}N.G=
void 0;return g.F(Q,Bsq(N),3);case 3:return Q.return();case 2:W=g.z(O);for(X=W.next();!X.done;X=W.next())l=X.value,jpR(l,2);g.vg(Q,4,5);return g.F(Q,MXd(P,O.map(function(n){return n.action})),7);
case 7:b=Q.T,h=g.z(O),x=h.next();case 8:if(x.done){Q.XB(10);break}y=x.value;V=b.get(y.action);return g.F(Q,znq(N,y,V),9);case 9:x=h.next();Q.XB(8);break;case 10:yYC(N.T,S);case 5:g.E_(Q);N.G=void 0;g.$5(Q,6);break;case 4:return L=g.zd(Q),Xv("Orchestration error",L),g.vg(Q,12),g.F(Q,E6R(N,O),14);case 14:g.Bg(Q,5);break;case 12:T=g.zd(Q);Xv("Orchestration retry error",T);E=g.z(O);for(m=E.next();!m.done;m=E.next())H=m.value,H.retryScheduleIndex<3&&x7q(N.T,[H]);Q.XB(5);break;case 6:return g.F(Q,Bsq(N),
0)}})},znq=function(N,p,S){var O,P,W,X,l,b,h,x,y,V,L,T;
return g.r(function(E){switch(E.B){case 1:O=p.retryScheduleIndex+2===3;if(S.status==="OFFLINE_ORCHESTRATION_ACTION_RESULT_SUCCESS"){E.XB(2);break}if(S.status!=="OFFLINE_ORCHESTRATION_ACTION_RESULT_FAILURE"){E.XB(0);break}spQ(p,S,O);if(S.T&&p.retryScheduleIndex+1<3)return g.F(E,E6R(N,[p]),0);W=((P=S)==null?0:P.B)?S.B:"OFFLINE_OPERATION_FAILURE_REASON_UNKNOWN";X={entityKey:p.action.entityKey,failureReason:W};l=void 0;g.wN(N.aj)?l="mainVideoDownloadStateEntity":g.eM(N.aj)&&(l="musicTrackDownloadMetadataEntity");
if(!l||!S.downloadState){E.XB(7);break}b=g.f4(p.action.entityKey).entityId;return g.F(E,Lg(b,l,N.B,S.downloadState),7);case 7:lZ(N.j,X);if(S.downloadState==="DOWNLOAD_STATE_FAILED"&&N.aj.U("html5_auto_retry_failed_pde_actions")){E.XB(0);break}Xv("Orchestration result is not retryable, deleting action");return g.F(E,fXs(N.B,$2(p).key),0);case 2:h=void 0;try{h=(x=S.G)==null?void 0:x.map(function(m){return N.createAction(m,p)})}catch(m){return spQ(p,S,O),y={entityKey:p.action.entityKey,
failureReason:"OFFLINE_OPERATION_FAILURE_REASON_UNSUPPORTED_ENTITY_FAILED"},lZ(N.j,y),Xv("Orchestration subactions creation error",m),E.return()}spQ(p,S,O,h);if(!h){E.XB(12);break}V=h.map(function(m){return $2(m)});
L=0;case 13:if(!(L<h.length)||N.K){E.XB(15);break}return g.F(E,q3(N.B,{mode:"readwrite",Hj:!0},function(m){var H=[];H.push(kmY(m,V.slice(L,L+10),"offlineOrchestrationActionWrapperEntity"));return g.$H.all(H)}),16);
case 16:L+=10;E.XB(13);break;case 15:if(N.K)return N.K=!1,E.return();case 12:return T=$2(p),g.F(E,fXs(N.B,T.key),17);case 17:jpR(p,4),g.Ls(E)}})},U7d=function(N,p){var S,O,P,W,X,l,b,h,x,y,V,L;
return g.r(function(T){S=[];O=Infinity;P=4E3;W=g.z(p);for(X=W.next();!X.done;X=W.next())l=X.value,b=Number(l.enqueueTimeSec),h=$7V(b),x=l.retryScheduleIndex,y=x!=null&&x>0,h>0&&y?(O=Math.min(O,b),P=Math.min(h,P)):S.push(l);isFinite(O)&&(!N.X.isActive()||O<N.Y)&&(N.Y=O,N.X.start(P));N.N.K7()||(V=S.length,S=S.filter(function(E){var m;E=((m=E.actionProto)==null?void 0:m.actionType)||"OFFLINE_ORCHESTRATION_ACTION_TYPE_UNKNOWN";return!JYf.includes(E)}),L=S.length<V,!N.X.isActive()&&L&&N.X.start(1));
S.length>0&&m70(N,S);return g.F(T,Tsq(N),0)})},i$d=function(N){var p,S,O,P,W,X,l;
return g.r(function(b){if(b.B==1)return g.F(b,H$B(N),2);p=b.T;S=[];O=g.z(p);for(P=O.next();!P.done;P=O.next())W=P.value,X=g.f4(W.key),l=X.entityId,VCs(N.T,l)||S.push(W);return g.F(b,U7d(N,S),0)})},$7V=function(N){N=N*1E3-Date.now();
return N>4E3?4E3:N},E6R=function(N,p){var S,O,P;
return g.r(function(W){S=g.z(p);for(O=S.next();!O.done;O=S.next()){P=O.value;var X=void 0,l=void 0,b=((l=P.action)==null?void 0:(X=l.actionMetadata)==null?void 0:X.retryScheduleIntervalsInSeconds)||[1,2,4];X=1;P.retryScheduleIndex<b.length&&(X=b[P.retryScheduleIndex]);P.T=X*1E3+Date.now();P.retryScheduleIndex++}return g.F(W,aUE(N,p),0)})},LWs=function(N){var p;
return g.r(function(S){if(S.B==1)return g.F(S,og(N.B,"offlineOrchestrationActionWrapperEntity"),2);p=S.T;return g.F(S,U7d(N,p),0)})},m70=function(N,p){p.length!==0&&p.forEach(function(S){S=EW(S);
S.retryScheduleIndex<3&&x7q(N.T,[S])})},H$B=function(N,p){var S;
return g.r(function(O){if(O.B==1)return g.F(O,og(N.B,"offlineOrchestrationActionWrapperEntity",p),2);S=O.T;return O.return(S.filter(yEs))})},aUE=function(N,p){if(p.length===0)return Promise.resolve([]);
p=p.map(function(S){return $2(S)});
return XHy(N.B,p)},QpQ=function(N){this.Dm=N;
this.T=void 0},cYV=function(N,p){var S,O,P,W;
return g.r(function(X){S=p.videoId;O=!0;if(p.captionTracks.length)P=qjB(p),N.T=new g.Am(N.Dm,p,P);else if(p.Se)W=g.vO5(p),N.T=new g.uv(N.Dm,p.Se,S,W,p.BV,p.eventId),O=p.BV;else return X.return();return X.return(new Promise(function(l){var b;(b=N.T)==null||b.Cu(function(){return g.r(function(h){if(h.B==1)return g.F(h,g6Q(N,S,O),2);l();g.Ls(h)})})}))})},g6Q=function(N,p,S){S=S===void 0?!0:S;
var O,P,W,X,l,b,h,x;return g.r(function(y){switch(y.B){case 1:if(!N.T)return y.return();O=[];P=g.iv(N.T.T,S);W=[];for(X={LH:0};X.LH<P.length;X={LH:X.LH},X.LH++)l=P[X.LH],b=N.T.o1(l,"json3"),h=g.a_(b,{withCredentials:!0,format:"RAW"},3,500).then(function(V){return function(L){L={metadata:g.so(P[V.LH]),trackData:L.xhr.responseText};W.push(L)}}(X)).IU(function(V){Xv("Caption fetch error",V)}),O.push(h);
return g.F(y,Nu0(O),2);case 2:return g.vg(y,3),g.F(y,vgy(p,W),5);case 5:g.Bg(y,0);break;case 3:x=g.zd(y),Xv("Caption DB transaction error",x),g.Ls(y)}})},FWt=function(N){var p;
return g.r(function(S){if(S.B==1)return g.F(S,Bfs(N),2);p=S.T;return S.return(!!p&&p.length>0)})},AT=function(N){g.e.call(this);
this.T=N;this.B=this.T.observe(this.X.bind(this))},n6B=function(N,p){var S,O,P,W,X,l,b;
return g.r(function(h){switch(h.B){case 1:if(p.length===0)return h.return([]);S=p.map(function(x){return g.l0(x,"transfer")});
return g.F(h,og(N.T,"transfer",S),2);case 2:O=h.T;P=O.filter(yEs).map(function(x){return g.f4(x.key).entityId});
W=p.filter(function(x){return P.indexOf(x)===-1});
if(W.length===0)return h.return([]);X=g.z(W);l=X.next();case 3:if(l.done){h.XB(5);break}b=l.value;return g.F(h,Z_0(b),4);case 4:l=X.next();h.XB(3);break;case 5:return h.return(W)}})},KWQ=function(N,p,S,O,P,W){var X,l,b;
return g.r(function(h){X="STREAM_TYPE_UNKNOWN";S.video&&S.audio?(X="STREAM_TYPE_AUDIO_AND_VIDEO",Xv("unexpected stream type")):S.video&&!S.audio?X="STREAM_TYPE_VIDEO":!S.video&&S.audio&&(X="STREAM_TYPE_AUDIO");l=g.l0(p,"offlineVideoStreams");b={numBytesDownloaded:P.toFixed(),numTotalBytes:W.toFixed(),streamType:X,streamState:"DOWNLOAD_STREAM_STATE_IN_PROGRESS",formatStreamBytes:JSON.stringify(O),itag:X==="STREAM_TYPE_AUDIO_AND_VIDEO"?Number(S.itag):void 0};return g.F(h,q3(N,{mode:"readwrite",Hj:!0},
function(x){var y=u6(x,l,"offlineVideoStreams"),V=u6(x,g.l0(p,"transfer"),"transfer");return g.$H.all([y,V]).then(function(L){L=g.z(L);var T=L.next().value;L=L.next().value;if(!L)return D5(x,l).then(function(){});
var E=rYl(T);T=MCf(T,O,b,l);var m=I4(x,T,"offlineVideoStreams");rYl(T)>E&&(L.lastProgressTimeMs=Date.now().toString());E=[m];L.offlineVideoStreams||(L.offlineVideoStreams=[]);L.offlineVideoStreams.indexOf(l)===-1&&(L.offlineVideoStreams.push(l),E.push(I4(x,L,"transfer")));return g.$H.all(E)})}),0)})},YIC=function(N,p){var S,O,P,W,X;
return g.r(function(l){if(l.B==1)return S=g.l0(p,"offlineVideoStreams"),g.F(l,pg(N,S,"offlineVideoStreams"),2);O=l.T;if(!O||!O.streamsProgress)return l.return();P=g.z(O.streamsProgress);for(W=P.next();!W.done;W=P.next())X=W.value,X.streamState="DOWNLOAD_STREAM_STATE_COMPLETE",X.numTotalBytes!==X.numBytesDownloaded&&(X.numBytesDownloaded=X.numTotalBytes);return g.F(l,NB(N,O,"offlineVideoStreams"),0)})},MCf=function(N,p,S,O){if(N&&N.streamsProgress){O=N;
a:{p=p.itag+";"+p.xtags;for(var P=N.streamsProgress,W=0;W<P.length;W++){var X=JSON.parse(P[W].formatStreamBytes);if(X.itag+";"+X.xtags===p){P[W]=S;S=P;break a}}P.push(S);S=P}O.streamsProgress=S}else N={key:O,streamsProgress:[S]};return N},rYl=function(N){if(N==null?0:N.streamsProgress){var p=0;
N=N.streamsProgress;for(var S=0;S<N.length;S++){var O=N[S];isNaN(Number(O.numBytesDownloaded))?Xv("stream progress bytes number invalid"):p+=Number(O.numBytesDownloaded)}return p}return 0},GsQ=function(N,p,S,O){g.e.call(this);
var P=this;this.B=N;this.api=p;this.jS=S;this.zk=O;this.N=new g.kJ;this.G=new g.k6(function(){P.T&&P.T.transferState==="TRANSFER_STATE_TRANSFERRING"&&P.N.K7()&&((P.T.transferRetryCount||0)<3?eE(P.j,P.K,!1,!1):dH(P.j,P.K.videoDetails.videoId),P.xH("TRANSFER_FAILURE_REASON_TIMEOUT_NO_PROGRESS"))});
this.u_=this.xO=0;this.W=this.Y=!1;this.Np=g.yo(this.api.J().experiments,"html5_transfer_processing_logs_interval");this.rH=new g.Ke(this);this.Rc={lhH:function(){return P.G},
CwS:function(){return P.zk},
Ta:function(){return P.N}};
this.py=this.B.observe(this.aL.bind(this));this.j=new DOV(p,this);this.vP=new QpQ(p);this.eS=new AT(this.B);this.i_=this.N.listen("publicytnetworkstatus-online",this.ll.bind(this));this.Qd=this.N.listen("publicytnetworkstatus-offline",this.ZGP.bind(this));this.W=this.api.J().U("html5_less_transfer_processing_logs");g.C(this,this.rH);this.rH.C(p,"offlinetransferpause",this.nKp);g.wN(this.api.J())?this.X="mainVideoDownloadStateEntity":g.eM(this.api.J())&&(this.X="musicTrackDownloadMetadataEntity")},
d7G=function(N){return g.r(function(p){if(p.B==1)p=g.F(p,Tf0(),2);
else{var S=N.eS;var O=g.mS();O=Object.keys(O);S=n6B(S,O);p=g.F(p,S,0)}return p})},uZ=function(N,p){p=p===void 0?!1:p;
var S;return g.r(function(O){if(O.B==1){if(N.T)throw Error("Already downloading a video");N.u_=0;N.Y=!1;return g.F(O,enR(N),2)}return O.B!=4?(S=O.T,AEV(N.jS,!S),S&&N.N.K7()?p?g.F(O,new Promise(function(P){g.y0(P,1E3)}),4):O.XB(4):(!S&&N.T&&tT(N),O.XB(0))):g.F(O,CLV(N,S),0)})},AYG=function(N){return g.r(function(p){if(p.B==1)return N.K?g.F(p,dH(N.j,N.K.videoDetails.videoId),3):p.XB(0);
tT(N);g.Ls(p)})},tCB=function(N,p){var S,O,P;
return g.r(function(W){switch(W.B){case 1:return g.vg(W,2),(S=!!p.captionTracks.length||!!p.Se)?g.F(W,FWt(p.videoId),4):W.return();case 4:return(O=W.T)?W.return():g.F(W,cYV(N.vP,p),5);case 5:g.Bg(W,0);break;case 2:P=g.zd(W),Xv("Caption downloading error",P,p.cotn),g.Ls(W)}})},CLV=function(N,p){var S,O,P,W,X,l;
return g.r(function(b){switch(b.B){case 1:if(N.Y)return b.return();N.Y=!0;N.T=p;S=g.f4(N.T.key);O=S.entityId;P=void 0;if(N.T.transferState==="TRANSFER_STATE_TRANSFERRING")return g.F(b,wH(N,O),7);if(N.T.transferState!=="TRANSFER_STATE_TRANSFER_IN_QUEUE"||N.T.transferRetryCount||N.T.hasLoggedFirstStarted){b.XB(3);break}return g.F(b,wH(N,O),5);case 5:return P=b.T,N.T.hasLoggedFirstStarted=!0,g.F(b,usd(N),6);case 6:tpf({videoId:O,YS:N.T,offlineModeType:P},void 0,void 0,!0);b.XB(3);break;case 7:P=b.T,
sW({transferStatusType:"TRANSFER_STATUS_TYPE_RESUME_PROCESSING",statusType:"OFFLINING_RETRIED"},{videoId:O,YS:N.T,offlineModeType:P});case 3:return g.F(b,wJG(N),8);case 8:return W=null,g.vg(b,9),g.F(b,RnR(N,p),11);case 11:W=b.T;N.K=W;g.Bg(b,10);break;case 9:return X=g.zd(b),Xv("error getting player response",X,p.cotn),g.F(b,N.xH("TRANSFER_FAILURE_REASON_SERVER_PROPERTY_MISSING"),12);case 12:return b.return();case 10:return l=Z50(N.api.J(),p.cotn,W),g.F(b,tCB(N,l),13);case 13:return g.F(b,kjE(l.videoId),
14);case 14:l.Wy=b.T,o6y(N.j,l,p.maximumDownloadQuality),N.G.start(108E5),g.Ls(b)}})},enR=function(N){var p,S;
return g.r(function(O){if(O.B==1)return g.F(O,og(N.B,"transfer"),2);p=O.T;S=p.filter(IUy).sort(D7V);return S.length===0?O.return():O.return(S[0])})},wJG=function(N){var p,S,O;
return g.r(function(P){if(P.B==1){if(!N.T)return Rg(N,"onTransferStart"),P.return();N.G.start(108E5);return g.F(P,Ig(N,"TRANSFER_STATE_TRANSFERRING"),2)}p=N.T;return(O=((S=p)==null?0:S.key)?g.f4(p.key).entityId:"")&&N.X?g.F(P,Lg(O,N.X,N.B,"DOWNLOAD_STATE_DOWNLOAD_IN_PROGRESS"),0):P.XB(0)})},Nsf=function(N){var p,S,O,P;
g.r(function(W){switch(W.B){case 1:if(!N.T){Rg(N,"onTransferPausedByUser");W.XB(2);break}p=N.T;N.G.stop();return g.F(W,Ig(N,"TRANSFER_STATE_PAUSED_BY_USER"),3);case 3:O=((S=p)==null?0:S.key)?g.f4(p.key).entityId:"";if(!O||!N.X){W.XB(4);break}return g.F(W,Lg(O,N.X,N.B,"DOWNLOAD_STATE_PAUSED"),4);case 4:return g.F(W,wH(N,O),6);case 6:P=W.T,uCd({videoId:O,YS:p,offlineModeType:P});case 2:tT(N),uZ(N),g.Ls(W)}})},pJf=function(N){var p,S,O;
g.r(function(P){if(P.B==1){if(!N.T)return Rg(N,"onTransferPausedByNetwork"),P.return();N.G.stop();return g.F(P,Ig(N,"TRANSFER_STATE_TRANSFER_IN_QUEUE"),2)}if(P.B!=3)return p=N.T,(O=((S=p)==null?0:S.key)?g.f4(p.key).entityId:"")&&N.X?g.F(P,Lg(O,N.X,N.B,"DOWNLOAD_STATE_PAUSED"),3):P.XB(3);tT(N);g.Ls(P)})},Z$R=function(N){var p,S,O,P,W;
g.r(function(X){switch(X.B){case 1:if(!N.T)return Rg(N,"onTransferComplete"),X.return();p=N.T;N.G.stop();if(!p||!N.K){X.XB(2);break}S=Z50(N.api.J(),p.cotn,N.K);return g.F(X,tCB(N,S),2);case 2:return g.F(X,Ig(N,"TRANSFER_STATE_COMPLETE","DOWNLOAD_STREAM_STATE_COMPLETE"),4);case 4:P=((O=p)==null?0:O.key)?g.f4(p.key).entityId:"";if(!P||!N.X){X.XB(5);break}return g.F(X,Lg(P,N.X,N.B,"DOWNLOAD_STATE_COMPLETE"),5);case 5:return g.F(X,YIC(N.B,P),7);case 7:return g.F(X,wH(N,P),8);case 8:W=X.T,sW({transferStatusType:"TRANSFER_STATUS_TYPE_COMPLETED",
statusType:"SUCCESS"},{videoId:P,YS:p,offlineModeType:W}),tT(N),uZ(N),g.Ls(X)}})},ksV=function(N,p,S){var O,P;
g.r(function(W){switch(W.B){case 1:if(!N.T)return Rg(N,"onTransferProgress: "+p),W.return();if(N.T.transferState==="TRANSFER_STATE_TRANSFERRING"){W.XB(2);break}return g.F(W,wJG(N),2);case 2:O=Date.now();if(!(O-N.xO>1E3)){W.XB(4);break}N.xO=O;return g.F(W,KWQ(N.B,S.videoId,S.B,S.fk,S.bytesDownloaded,S.T),5);case 5:if(N.W&&!(N.W&&O-N.u_>N.Np)){W.XB(4);break}N.u_=O;return g.F(W,wH(N,p),7);case 7:P=W.T,tpf({videoId:p,YS:N.T,offlineModeType:P},S.bytesDownloaded,S.T);case 4:N.G.start(108E5),g.Ls(W)}})},
qIy=function(N){var p=(N.T.transferRetryCount||0)<3;
p&&(N=N.T,N.transferRetryCount=(N.transferRetryCount||0)+1);return p},NFQ=function(N,p){p=p===void 0?"TRANSFER_FAILURE_REASON_UNKNOWN":p;
var S,O,P,W;return g.r(function(X){if(X.B==1)return N.T||Rg(N,"setTransferToFailed: "+p),S="OFFLINE_OPERATION_FAILURE_REASON_UNKNOWN",p==="TRANSFER_FAILURE_REASON_NETWORK"?S="OFFLINE_OPERATION_FAILURE_REASON_NETWORK_REQUEST_FAILED":p==="TRANSFER_FAILURE_REASON_FILESYSTEM_WRITE"&&(S="OFFLINE_OPERATION_FAILURE_REASON_DATABASE_REQUEST_FAILED"),g.F(X,Ig(N,"TRANSFER_STATE_FAILED","DOWNLOAD_STREAM_STATE_ERROR_STREAMS_MISSING",p),2);if(X.B!=3)return lZ(N.zk,{entityKey:(O=N.T)==null?void 0:O.key,failureReason:S}),
P=N.T?g.f4(N.T.key).entityId:"",g.F(X,wH(N,P),3);W=X.T;var l={videoId:P,YS:N.T,offlineModeType:W},b=p,h={transferStatusType:"TRANSFER_STATUS_TYPE_TERMINATED_WITH_FAILURE",statusType:"FAILED"};b&&(h.transferFailureReason=b,h.failureReason=wH0(b));sW(h,l);g.Ls(X)})},Ig=function(N,p,S,O){var P;
return g.r(function(W){if(W.B==1){if(!N.T)return Rg(N,"saveTransferState: "+p),W.return();N.T.transferState=p;N.T.failureReason=O;g.vg(W,2);return g.F(W,usd(N,function(X){return S?wr(X,"offlineVideoStreams",N.T.offlineVideoStreams).then(function(l){for(var b=g.z(l),h=b.next();!h.done;h=b.next())if((h=h.value)&&h.streamsProgress){h=g.z(h.streamsProgress);for(var x=h.next();!x.done;x=h.next())x.value.streamState=S}return kmY(X,l.filter(function(y){return!!y}),"offlineVideoStreams")}):g.$H.resolve(void 0)}),
4)}if(W.B!=2)return g.Bg(W,0);
P=g.zd(W);return P instanceof g.V9&&P.type==="QUOTA_EXCEEDED"?g.F(W,N.xH("TRANSFER_FAILURE_REASON_FILESYSTEM_WRITE"),0):W.XB(0)})},usd=function(N,p){var S;
return g.r(function(O){if(!N.T)return O.return();S=N.T;return g.F(O,q3(N.B,{mode:"readwrite",Hj:!0},function(P){var W=[I4(P,S,"transfer")];p&&W.push(p(P));return g.$H.all(W)}),0)})},tT=function(N){N.T=void 0;
N.K=void 0;N.G.stop()},RnR=function(N,p){var S,O,P,W,X;
return g.r(function(l){if(l.B==1)return S=g.f4(p.key),O=S.entityId,P=g.l0(O,"playbackData"),g.F(l,pg(N.B,P,"playbackData"),2);W=l.T;if((X=W)==null?0:X.playerResponseJson)return l.return(JSON.parse(W.playerResponseJson));throw Error("No PlayerResponse found");})},Rg=function(N,p){N.api.Tk("woffle",{mcte:p});
Xv("missing current transfer entity.")},wH=function(N,p){var S,O,P;
return g.r(function(W){if(W.B==1)return g.F(W,pg(N.B,g.l0(p,"videoDownloadContextEntity"),"videoDownloadContextEntity"),2);S=W.T;return W.return((P=(O=S)==null?void 0:O.offlineModeType)!=null?P:void 0)})},IUy=function(N){return pFR[N.transferState]!==void 0},D7V=function(N,p){var S=pFR[N.transferState],O=pFR[p.transferState];
return S!==O?S-O:Number(N.enqueuedTimestampMs)-Number(p.enqueuedTimestampMs)},Dr=function(N,p){var S=this;
this.aj=N;this.api=p;this.N=new g.kJ;this.K=new g.mj;this.Rc={Wt:function(){return S.X.Rc.Wt()},
Ta:function(){return S.N},
Jkj:function(){return S.X},
Zf:function(){return S.Zf()},
k5:function(){return S.k5()},
s6:function(){return S.s6()},
wP:function(){return S.wP()},
iV:function(){return S.iV()},
Bs:function(O){return S.Bs(O)}};
this.X=new GPE(function(){return oeq(S)},function(){S.s6()},this.api.L3(),this.api.U.bind(this.api));
this.T=new fg(this.api);dC0(this.X)},oeq=function(N){return g.r(function(p){N.api.YO("onOrchestrationBecameLeader");
return g.F(p,N.k5(),0)})},OEl=function(N){var p,S;
return g.r(function(O){if(O.B==1)return g.F(O,SE(),2);if(O.B!=3){p=O.T;if(!p)return Xv("PES is undefined"),O.return();N.B=new GsQ(p,N.api,N.X,N.T);S=N.Dz(p);return g.F(O,v6d(p,S,N.X,N.T,N.aj),3)}N.j=O.T;return g.F(O,SOs(N),0)})},SOs=function(N){var p;
return g.r(function(S){switch(S.B){case 1:if(!N.B)return Xv("transferManager is undefined"),S.return();if(N.B.T){S.XB(2);break}return g.F(S,uZ(N.B),2);case 2:if(!N.aj.U("woffle_enable_main_downloads_library")){S.XB(4);break}return g.F(S,N.GM(),4);case 4:if(!N.aj.U("html5_offline_playback_position_sync")){S.XB(6);break}return g.F(S,N.UY(),7);case 7:return g.F(S,N.Bs(864E5),6);case 6:return g.F(S,N.refreshAllStaleEntities(43200,!0),9);case 9:return g.F(S,N.GZ(),10);case 10:if(!N.aj.U("html5_retry_downloads_for_expiration")){S.XB(11);
break}return g.F(S,N.iV(),11);case 11:return N.Y=g.V0(function(){N.refreshAllStaleEntities(43200,!0);N.GZ()},9E5),g.kq(g.Ng(),function(){return N.wP()}),g.F(S,SE(),13);
case 13:return p=S.T,g.F(S,YhV(p),14);case 14:eTB(N.X),g.Ls(S)}})},PSs=function(){var N,p,S,O,P,W;
return g.r(function(X){switch(X.B){case 1:return g.F(X,SE(),2);case 2:N=X.T;if(!N)return X.return([]);p=Date.now()/1E3;return g.F(X,og(N,"offlineVideoPolicy"),3);case 3:S=X.T,O=g.z(S),P=O.next();case 4:if(P.done){X.XB(6);break}W=P.value;if(!(W.expirationTimestamp&&Number(W.expirationTimestamp)<p)){X.XB(5);break}W.action="OFFLINE_VIDEO_POLICY_ACTION_DISABLE";W.offlinePlaybackDisabledReason="OFFLINE_PLAYBACK_DISABLED_REASON_CLIENT_OFFLINE_CONTENT_EXPIRED";return g.F(X,NB(N,W,"offlineVideoPolicy"),5);
case 5:P=O.next();X.XB(4);break;case 6:return X.return(S.map(function(l){return l.key}))}})},Zr=function(N,p,S,O,P){var W,X,l;
return g.r(function(b){if(b.B==1)return g.F(b,SE(),2);W=b.T;if(!W)return b.return([]);X=p.map(function(h){var x=g.l0(h,S);x={actionType:O,entityKey:x,actionMetadata:Object.assign({},kPl(),P)};O!=="OFFLINE_ORCHESTRATION_ACTION_TYPE_REFRESH"&&(x.actionMetadata.priority=0);h=new zV(S,h,x);return $2(h)});
l=XHy(W,X);dC0(N.X);return b.return(l)})},WTB=function(N,p,S,O){var P,W,X,l,b,h,x,y;
return g.r(function(V){switch(V.B){case 1:P=[],W=g.z(p),X=W.next();case 2:if(X.done){V.XB(4);break}l=X.value;if(l.upToDate||S&&!l.shouldAutoSyncMetadata||!l.playlistId){V.XB(3);break}b={};switch(O){case "mainPlaylistEntity":h={nextAutoRefreshIntervalSeconds:l.checkInSeconds,autoSync:S};b={mainPlaylistEntityActionMetadata:h};break;case "musicPlaylist":x={autoSync:S},b={musicPlaylistEntityActionMetadata:x}}return g.F(V,Zr(N,[l.playlistId],O,"OFFLINE_ORCHESTRATION_ACTION_TYPE_REFRESH",b),6);case 6:(y=
V.T)&&P.push.apply(P,g.J(y));case 3:X=W.next();V.XB(2);break;case 4:return V.return(P)}})},XFq=function(N,p){var S;
return g.r(function(O){return p.length?(S=kPl(),g.dO(S,Y2,{isEnqueuedForExpiredStreamUrlRefetch:!0}),N.api.Tk("qrd",{v:p.length}),O.return(Zr(N,p,"playbackData","OFFLINE_ORCHESTRATION_ACTION_TYPE_ADD",S))):O.return([])})},fsy=function(N,p,S){this.T=N;
this.aj=p;this.X=S},jFE=function(N,p){var S,O,P,W,X,l,b,h,x,y,V,L,T,E,m,H,Q;
return g.r(function(n){switch(n.B){case 1:return S=hT(p),O=g.f4(p.entityKey),P=O.entityId,W=[],g.vg(n,2),g.F(n,lsq(N,P),4);case 4:W=n.T;if(!(N.aj.U("woffle_enable_main_downloads_library")&&((X=W)==null?0:X.length))){n.XB(5);break}return g.F(n,j90(N.T,[p.entityKey]),5);case 5:g.Bg(n,3);break;case 2:return l=g.zd(n),b="OFFLINE_OPERATION_FAILURE_REASON_UNKNOWN",h="OFFLINE_ORCHESTRATION_FAILURE_REASON_DATABASE_OPERATION_FAILED",l instanceof g.V9&&l.type==="QUOTA_EXCEEDED"?(b="OFFLINE_OPERATION_FAILURE_REASON_DATABASE_REQUEST_FAILED",
h="OFFLINE_ORCHESTRATION_FAILURE_REASON_NO_STORAGE"):Xv("Playlist add error"),n.return(new Kg("OFFLINE_ORCHESTRATION_ACTION_RESULT_FAILURE",S,void 0,b,h));case 3:x=[];if(!N.aj.U("html5_offline_prevent_redownload_downloaded_video")){n.XB(7);break}return g.F(n,DCB(N.T,"mainVideoEntity",W),8);case 8:W=n.T;case 7:if((y=W)==null?0:y.length)for(V=g.z(W),L=V.next();!L.done;L=V.next())if(T=L.value,E=T.offlineVideoData,m=void 0,(m=E)==null?0:m.videoId)H=void 0,Q=Number(((H=p.actionMetadata)==null?void 0:H.priority)||
0)+1,x.push(MB("OFFLINE_ORCHESTRATION_ACTION_TYPE_ADD",E.videoId,"mainVideoEntity",Q,k2,bEC(p,E,P)));return n.return(new Kg("OFFLINE_ORCHESTRATION_ACTION_RESULT_SUCCESS",S,x))}})},h2d=function(N,p){var S,O,P,W,X,l,b,h,x,y,V,L,T,E,m,H,Q,n,K,d,D,u,oH,bX,I,A,k,v,w,Zb,Tf,bG,iX,o0,xs,k5,U,a,c,M,G,N6,Wg,O_,Y,jA,Td,XG,re,XB,Gf,h1,we,M_,bH,Mp,Km,et,Ei,A1,wh,CB,xB,r4,Fp,hV,Mw,n8,nZ,Ws,$Y,Os,$6,dE;
return g.r(function(xj){switch(xj.B){case 1:return S=hT(p),O=p.entityKey,P=g.f4(O).entityId,W=[],X=!1,P==="!*$_ALL_ENTITIES_!*$"?(X=!0,g.F(xj,og(N.T,"mainPlaylistEntity"),5)):g.F(xj,pg(N.T,O,"mainPlaylistEntity"),4);case 4:(l=xj.T)&&W.push(l);xj.XB(3);break;case 5:W=xj.T;case 3:if((b=W)==null||!b.length)return xj.return(new Kg("OFFLINE_ORCHESTRATION_ACTION_RESULT_SUCCESS",S));h=g.t(p.actionMetadata,sFE);y=(x=h)==null?void 0:x.nextAutoRefreshIntervalSeconds;L=(V=h)==null?void 0:V.autoSync;T=[];m=E=
!0;H=!1;if(!X&&L===!1){xj.XB(6);break}g.vg(xj,7);return g.F(xj,mOq(0,!!L,!0,W),9);case 9:T=xj.T;g.Bg(xj,8);break;case 7:Q=g.zd(xj);if(!(Q instanceof Error&&Q.message==="No data")){Q instanceof Error&&Q.message==="Empty response body"&&Xv(Q.message);xj.XB(8);break}return P==="!*$_ALL_ENTITIES_!*$"?g.F(xj,PEq(N.T,p,N.X,"OFFLINE_DELETE_REASON_UNAVAILABLE"),8):g.F(xj,SzE(P,N.T,p,N.X),8);case 8:if(!T.length||!X&&T[0].playlistId!==P)return xj.return(new Kg("OFFLINE_ORCHESTRATION_ACTION_RESULT_SUCCESS",
S));case 6:if(X){n=[];K=g.z(T);for(d=K.next();!d.done;d=K.next())D=d.value,D.upToDate||L&&!D.shouldAutoSyncMetadata||!D.playlistId||(u={nextAutoRefreshIntervalSeconds:D.checkInSeconds,autoSync:L},n.push(MB("OFFLINE_ORCHESTRATION_ACTION_TYPE_REFRESH",D.playlistId,"mainPlaylistEntity",0,k2,{mainPlaylistEntityActionMetadata:u})));return xj.return(new Kg("OFFLINE_ORCHESTRATION_ACTION_RESULT_SUCCESS",S,n))}T.length&&(oH=T[0],H=!!oH.upToDate,L&&(E=(bX=oH.shouldAutoSyncMetadata)!=null?bX:!0,m=(I=oH.shouldAutoSyncVideos)!=
null?I:!0,oH.checkInSeconds&&(y=oH.checkInSeconds)));if(H||!E)return xj.return(new Kg("OFFLINE_ORCHESTRATION_ACTION_RESULT_SUCCESS",S));A=[];k=W[0];if(!k.downloadState){v=void 0;xj.XB(15);break}return g.F(xj,pg(N.T,k.downloadState,"mainPlaylistDownloadStateEntity"),16);case 16:v=xj.T;case 15:return w=v,Tf=((Zb=w)==null?0:Zb.addedTimestampMillis)?String(w.addedTimestampMillis):void 0,g.vg(xj,17),g.F(xj,lsq(N,P,Tf,y),19);case 19:A=xj.T;g.Bg(xj,18);break;case 17:bG=g.zd(xj);if(!(bG instanceof Error&&
bG.message==="No data for playlist")){if(bG instanceof Error&&bG.message==="Empty response body for playlist")Xv(bG.message);else return iX="OFFLINE_OPERATION_FAILURE_REASON_UNKNOWN",o0="OFFLINE_ORCHESTRATION_FAILURE_REASON_DATABASE_OPERATION_FAILED",bG instanceof g.V9&&bG.type==="QUOTA_EXCEEDED"&&(iX="OFFLINE_OPERATION_FAILURE_REASON_DATABASE_REQUEST_FAILED",o0="OFFLINE_ORCHESTRATION_FAILURE_REASON_NO_STORAGE"),xj.return(new Kg("OFFLINE_ORCHESTRATION_ACTION_RESULT_FAILURE",S,void 0,iX,o0));xj.XB(18);
break}return g.F(xj,SzE(P,N.T,p,N.X),18);case 18:if(!m)return xj.return(new Kg("OFFLINE_ORCHESTRATION_ACTION_RESULT_SUCCESS",S));xs=[];k5=new Map;if((U=A)==null?0:U.length)for(a=g.z(A),c=a.next();!c.done;c=a.next())M=c.value,G=M.offlineVideoData,N6=void 0,((N6=G)==null?0:N6.videoId)&&k5.set(G.videoId,G);Wg=new Map;O_=[];if((Y=k)==null?0:(jA=Y.videos)==null?0:jA.length)for(Td=g.z(k.videos),XG=Td.next();!XG.done;XG=Td.next())if(re=XG.value,XB=JSON.parse(g.f4(re).entityId),Gf=XB.videoId)k5.has(Gf)?(Wg.set(Gf,
k5.get(Gf)),k5.delete(Gf)):O_.push(Gf);we=Number(((h1=p.actionMetadata)==null?void 0:h1.priority)||0)+1;M_=g.z(k5.entries());for(bH=M_.next();!bH.done;bH=M_.next())Mp=bH.value,Km=g.z(Mp),et=Km.next().value,Ei=Km.next().value,A1=et,wh=Ei,xs.push(MB("OFFLINE_ORCHESTRATION_ACTION_TYPE_ADD",A1,"mainVideoEntity",we,k2,bEC(p,wh,P)));CB=g.z(Wg.entries());for(xB=CB.next();!xB.done;xB=CB.next())r4=xB.value,Fp=g.z(r4),hV=Fp.next().value,Mw=Fp.next().value,n8=hV,nZ=Mw,xs.push(MB("OFFLINE_ORCHESTRATION_ACTION_TYPE_REFRESH",
n8,"mainVideoEntity",we,k2,bEC(p,nZ,P)));Ws=g.z(O_);for($Y=Ws.next();!$Y.done;$Y=Ws.next())Os=$Y.value,$6={playlistId:P},dE={offlineLoggingData:{offlineDeleteReason:"OFFLINE_DELETE_REASON_PARENT_LIST_REFRESH"},mainVideoEntityActionMetadata:$6},xs.push(MB("OFFLINE_ORCHESTRATION_ACTION_TYPE_DELETE",Os,"mainVideoEntity",0,k2,dE));return xj.return(new Kg("OFFLINE_ORCHESTRATION_ACTION_RESULT_SUCCESS",S,xs))}})},xvQ=function(N,p){var S,O,P,W;
return g.r(function(X){switch(X.B){case 1:return S=hT(p),g.vg(X,2),O=g.f4(p.entityKey).entityId,O==="!*$_ALL_ENTITIES_!*$"?g.F(X,PEq(N.T,p,N.X,(P=p.actionMetadata)==null?void 0:(W=P.offlineLoggingData)==null?void 0:W.offlineDeleteReason),5):g.F(X,SzE(O,N.T,p,N.X),6);case 6:if(!N.aj.U("woffle_enable_main_downloads_library")){X.XB(5);break}return g.F(X,s90(N.T,p.entityKey),5);case 5:g.Bg(X,3);break;case 2:return g.zd(X),X.return(new Kg("OFFLINE_ORCHESTRATION_ACTION_RESULT_FAILURE",S,void 0,"OFFLINE_OPERATION_FAILURE_REASON_DATABASE_REQUEST_FAILED",
"OFFLINE_ORCHESTRATION_FAILURE_REASON_DATABASE_OPERATION_FAILED"));case 3:return X.return(new Kg("OFFLINE_ORCHESTRATION_ACTION_RESULT_SUCCESS",S))}})},lsq=function(N,p,S,O){var P,W,X,l,b,h,x;
return g.r(function(y){switch(y.B){case 1:return g.F(y,$Ot([p]),2);case 2:return P=y.T,g.F(y,y4s(N,P[0],S,O),3);case 3:return W=y.T,X=W.mainPlaylistEntity,l=W.Lov,h=pcl(X,(b=l)==null?void 0:b.avatar),g.vg(y,4),g.F(y,mU(h),6);case 6:g.Bg(y,5);break;case 4:x=g.zd(y),x instanceof Error&&x.message==="Failed to fetch"&&Xv(x.message);case 5:return y.return(P[0].videos)}})},y4s=function(N,p,S,O){var P,W,X,l,b,h,x,y,V,L,T,E,m,H,Q,n,K;
return g.r(function(d){switch(d.B){case 1:P=Date.now().toString();S||(S=P);W=p.videos;X=p.playlistId;l=[];b=[];if(W)for(h=g.z(W),x=h.next();!x.done;x=h.next()){y=x.value;V=y.offlineVideoData;if(!V||!V.videoId)throw Xv("Invalid offlineVideoData for playlist"),Error("Invalid offlineVideoData for playlist");L=V.videoId;T={videoId:L,playlistId:X};E={id:g.l0(JSON.stringify(T),"mainPlaylistVideoEntity"),video:g.l0(L,"mainVideoEntity")};l.push(E);b.push(E.id)}H={key:g.l0(X,"mainPlaylistDownloadStateEntity"),
addedTimestampMillis:S,lastSyncedTimestampMillis:P};Q={key:g.l0(X,"mainPlaylistEntity"),playlistId:X,videos:b,title:p.title,thumbnailStyleData:VlQ(p),visibility:LTf(p),downloadState:H.key};p.channel&&(n=p.channel.offlineChannelData,m=TFl(g.l0(X,"ytMainChannelEntity"),n),Q.channelOwner=m.id);((K=Q)==null?0:K.entityMetadata)?(Q.entityMetadata.offlineLastModifiedTimestampSeconds=p.lastModifiedTimestamp,O&&(Q.entityMetadata.nextAutoRefreshIntervalSeconds=String(O))):Q&&(Q.entityMetadata={nextAutoRefreshIntervalSeconds:O?
String(O):void 0,offlineLastModifiedTimestampSeconds:p.lastModifiedTimestamp});g.vg(d,2);return g.F(d,q3(N.T,{mode:"readwrite",Hj:!0},function(D){var u=I4(D,Q,"mainPlaylistEntity"),oH=I4(D,H,"mainPlaylistDownloadStateEntity");u=[u,oH];oH=g.z(l);for(var bX=oH.next();!bX.done;bX=oH.next())u.push(I4(D,bX.value,"mainPlaylistVideoEntity"));m&&u.push(I4(D,m,"ytMainChannelEntity"));return g.$H.all(u)}),4);
case 4:g.Bg(d,3);break;case 2:throw g.zd(d),Xv("PES failure for playlist"),Error("PES failure for playlist");case 3:return d.return({mainPlaylistEntity:Q,Lov:m,FYj:l})}})},TFl=function(N,p){return{id:N,
channelId:p.channelId,title:p.title,avatar:p.thumbnail}},VlQ=function(N){var p=[],S=N.videos;
S&&S.length>0&&p.push({key:Number("PLAYLIST_THUMBNAIL_STYLE_FIRST_VIDEO"),value:{collageThumbnail:{coverThumbnail:S[0].offlineVideoData.thumbnail}}});if((N=N.additionalMetadadatas)&&N.length>0)for(N=g.z(N),S=N.next();!S.done;S=N.next()){var O=S.value.offlineBundleItemPlaylistData,P=void 0;S=(P=O)==null?void 0:P.style;P=void 0;O={collageThumbnail:{coverThumbnail:(P=O)==null?void 0:P.coverThumbnail}};switch(S){case "BUNDLE_ITEM_STYLE_UNSPECIFIED":p.push({key:Number("PLAYLIST_THUMBNAIL_STYLE_UNKNOWN"),
value:O});break;case "BUNDLE_ITEM_STYLE_TWO_BY_TWO":p.push({key:Number("PLAYLIST_THUMBNAIL_STYLE_TWO_BY_TWO"),value:O});break;case "BUNDLE_ITEM_STYLE_ONE_AND_TWO_AVATAR":p.push({key:Number("PLAYLIST_THUMBNAIL_STYLE_ONE_AND_TWO_AVATAR"),value:O});break;case "BUNDLE_ITEM_STYLE_ONE_AND_TWO":p.push({key:Number("PLAYLIST_THUMBNAIL_STYLE_ONE_AND_TWO"),value:O})}}return p},LTf=function(N){switch(N.privacy){case "PRIVATE":return"PLAYLIST_VISIBILITY_PRIVATE";
case "PUBLIC":return"PLAYLIST_VISIBILITY_PUBLIC";case "UNLISTED":return"PLAYLIST_VISIBILITY_UNLISTED";default:return"PLAYLIST_VISIBILITY_UNKNOWN"}},bEC=function(N,p,S){p={offlineVideoData:p,
playlistId:S};if(N=g.t(N.actionMetadata,sFE))p.maximumDownloadQuality=N.maximumDownloadQuality;return{mainVideoEntityActionMetadata:p}},veV=function(N,p,S){this.T=N;
this.aj=p;this.X=S},EeR=function(N,p){var S,O,P,W,X,l,b,h,x,y,V,L,T;
return g.r(function(E){switch(E.B){case 1:return S=hT(p),O=g.f4(p.entityKey),P=O.entityId,W=g.t(p.actionMetadata,qB),l=!((X=W)==null?0:X.playlistId),g.vg(E,2),g.F(E,BFq(N,P,void 0,(b=W)==null?void 0:b.offlineVideoData,l),4);case 4:g.Bg(E,3);break;case 2:return h=g.zd(E),x="OFFLINE_OPERATION_FAILURE_REASON_UNKNOWN",y="OFFLINE_ORCHESTRATION_FAILURE_REASON_DATABASE_OPERATION_FAILED",h instanceof g.V9&&h.type==="QUOTA_EXCEEDED"&&(x="OFFLINE_OPERATION_FAILURE_REASON_DATABASE_REQUEST_FAILED",y="OFFLINE_ORCHESTRATION_FAILURE_REASON_NO_STORAGE"),
E.return(new Kg("OFFLINE_ORCHESTRATION_ACTION_RESULT_FAILURE",S,void 0,x,y));case 3:V=1;V=Number(((L=p.actionMetadata)==null?void 0:L.priority)||0)+1;var m=(m=g.t(p.actionMetadata,qB))?{playbackDataActionMetadata:{maximumDownloadQuality:m.maximumDownloadQuality}}:void 0;T=MB("OFFLINE_ORCHESTRATION_ACTION_TYPE_ADD",P,"playbackData",V,z2E,m);return E.return(new Kg("OFFLINE_ORCHESTRATION_ACTION_RESULT_SUCCESS",S,[T]))}})},$vC=function(N,p){var S,O,P,W,X,l,b,h,x,y,V,L,T,E,m,H,Q;
return g.r(function(n){switch(n.B){case 1:return S=hT(p),O=g.f4(p.entityKey),P=O.entityId,g.F(n,pg(N.T,p.entityKey,"mainVideoEntity"),2);case 2:W=n.T;if(!W){X=void 0;n.XB(3);break}return g.F(n,pg(N.T,W.downloadState,"mainVideoDownloadStateEntity"),4);case 4:X=n.T;case 3:l=X;if(!W||!l)return n.return(new Kg("OFFLINE_ORCHESTRATION_ACTION_RESULT_SUCCESS",S));g.vg(n,5);return g.F(n,BFq(N,P,l.addedTimestampMillis,(h=g.t(p.actionMetadata,qB))==null?void 0:h.offlineVideoData),7);case 7:x=1;x=Number(((y=
p.actionMetadata)==null?void 0:y.priority)||0)+1;b=MB("OFFLINE_ORCHESTRATION_ACTION_TYPE_REFRESH",P,"playbackData",x,z2E);g.Bg(n,6);break;case 5:V=g.zd(n);if(!(V instanceof Error&&V.message==="No data")){if(V instanceof Error&&V.message==="Empty response body")Xv(V.message);else return L="OFFLINE_OPERATION_FAILURE_REASON_UNKNOWN",T="OFFLINE_ORCHESTRATION_FAILURE_REASON_DATABASE_OPERATION_FAILED",V instanceof g.V9&&V.type==="QUOTA_EXCEEDED"&&(L="OFFLINE_OPERATION_FAILURE_REASON_DATABASE_REQUEST_FAILED",
T="OFFLINE_ORCHESTRATION_FAILURE_REASON_NO_STORAGE"),n.return(new Kg("OFFLINE_ORCHESTRATION_ACTION_RESULT_FAILURE",S,void 0,L,T));n.XB(6);break}return g.F(n,iZ(N.T,P),9);case 9:E=n.T;m=g.t(p.actionMetadata,qB);if(Q=(H=m)==null?void 0:H.playlistId)E.playlistId=Q;E.offlineDeleteReason="OFFLINE_DELETE_REASON_UNAVAILABLE";return g.F(n,UW(P,N.T,p,N.X,E),6);case 6:return n.return(new Kg("OFFLINE_ORCHESTRATION_ACTION_RESULT_SUCCESS",S,b?[b]:void 0))}})},J4l=function(N,p){var S,O,P,W,X,l,b,h,x,y;
return g.r(function(V){switch(V.B){case 1:return S=hT(p),g.vg(V,2),O=g.f4(p.entityKey).entityId,O==="!*$_ALL_ENTITIES_!*$"?g.F(V,PEq(N.T,p,N.X,(x=p.actionMetadata)==null?void 0:(y=x.offlineLoggingData)==null?void 0:y.offlineDeleteReason),5):g.F(V,iZ(N.T,O),6);case 6:P=V.T;W=g.t(p.actionMetadata,qB);if(l=(X=W)==null?void 0:X.playlistId)P.playlistId=l;P.offlineDeleteReason=(b=p.actionMetadata)==null?void 0:(h=b.offlineLoggingData)==null?void 0:h.offlineDeleteReason;return g.F(V,UW(O,N.T,p,N.X,P),7);
case 7:if(!N.aj.U("woffle_enable_main_downloads_library")){V.XB(5);break}return g.F(V,s90(N.T,p.entityKey),5);case 5:g.Bg(V,3);break;case 2:return g.zd(V),V.return(new Kg("OFFLINE_ORCHESTRATION_ACTION_RESULT_FAILURE",S,void 0,"OFFLINE_OPERATION_FAILURE_REASON_DATABASE_REQUEST_FAILED","OFFLINE_ORCHESTRATION_FAILURE_REASON_DATABASE_OPERATION_FAILED"));case 3:return V.return(new Kg("OFFLINE_ORCHESTRATION_ACTION_RESULT_SUCCESS",S))}})},BFq=function(N,p,S,O,P){var W,X,l,b,h,x;
return g.r(function(y){switch(y.B){case 1:if(W=O){y.XB(2);break}return g.F(y,EQE([p]),3);case 3:X=y.T,W=X[0];case 2:return g.F(y,mvY(N,W,S,P),4);case 4:l=y.T;b=l.mainVideoEntity;h=l.channelEntity;g.vg(y,5);var V=BG(b.thumbnail),L=BG(h.avatar);return g.F(y,mU(V.concat(L)),7);case 7:g.Bg(y,0);break;case 5:x=g.zd(y),x instanceof Error&&x.message==="Failed to fetch"&&Xv(x.message),g.Ls(y)}})},mvY=function(N,p,S,O){var P,W,X,l,b,h,x,y,V,L,T,E,m;
return g.r(function(H){switch(H.B){case 1:S||(S=Date.now().toString());W=(P=p.channel)==null?void 0:P.offlineChannelData;X={id:g.l0(p.videoId,"ytMainChannelEntity"),channelId:W.channelId,title:W.title,avatar:W.thumbnail};l={key:g.l0(p.videoId,"mainVideoDownloadStateEntity"),playbackData:g.l0(p.videoId,"playbackData"),addedTimestampMillis:S,videoDownloadContextEntity:g.l0(p.videoId,"videoDownloadContextEntity")};b={key:g.l0(p.videoId,"videoPlaybackPositionEntity"),videoId:p.videoId,lastPlaybackPositionSeconds:"0"};
N.aj.U("html5_offline_playback_position_sync")&&(h={playbackPosition:b.key});x=g.l0(p.videoId,"mainVideoEntity");y={key:x,videoId:p.videoId,title:p.title,thumbnail:p.thumbnail,localizedStrings:{viewCount:p.shortViewCountText},userState:h,lengthSeconds:p.lengthSeconds?Number(p.lengthSeconds):void 0,publishedTimestampMillis:p.publishedTimestamp?(Number(p.publishedTimestamp)*1E3).toString():void 0,formattedDescription:p.description,owner:X.id,downloadState:l.key};if(!N.aj.U("woffle_enable_main_downloads_library")||
!O){H.XB(2);break}return g.F(H,b_0(N.T,[x]),3);case 3:if(T=H.T)V=T.mainDownloadsLibraryEntity,L=T.mainDownloadsListEntity;case 2:return m=IXC,E={key:g.l0(p.videoId,"downloadStatusEntity"),downloadState:"DOWNLOAD_STATE_PENDING_DOWNLOAD"},g.dO(l,m,E),g.F(H,q3(N.T,{mode:"readwrite",Hj:!0},function(Q){var n=I4(Q,X,"ytMainChannelEntity"),K=I4(Q,l,"mainVideoDownloadStateEntity"),d=I4(Q,y,"mainVideoEntity");n=[n,K,d];N.aj.U("html5_offline_playback_position_sync")&&(K=I4(Q,b,"videoPlaybackPositionEntity"),
n.push(K));V&&(K=I4(Q,V,"mainDownloadsLibraryEntity"),n.push(K));L&&(K=I4(Q,L,"mainDownloadsListEntity"),n.push(K));E&&(Q=I4(Q,E,"downloadStatusEntity"),n.push(Q));return g.$H.all(n)}),4);
case 4:return H.return({mainVideoEntity:y,channelEntity:X})}})},Uvs=function(N,p,S){this.T=N;
this.aj=p;this.X=S},iE0=function(N,p){var S,O,P,W,X,l,b,h,x,y,V,L,T,E,m,H,Q,n,K,d,D,u,oH,bX,I,A,k;
return g.r(function(v){switch(v.B){case 1:return S=hT(p),O=[],g.F(v,Cj.getInstance(),2);case 2:P=v.T;if(!P){v.XB(3);break}return g.F(v,P.get("sdois"),4);case 4:return W=v.T,g.F(v,(l=P)==null?void 0:l.get("lmqf"),5);case 5:X=v.T;case 3:g.vg(v,6);if(W===void 0)throw Error("prefStorage or opt-in state is undefined");b=[];if(W){v.XB(8);break}return g.F(v,lVy(N.T),9);case 9:b=v.T,b.reverse();case 8:if(!b.length){v.XB(10);break}h=g.z(b);x=h.next();case 11:if(x.done){v.XB(10);break}y=x.value;if(!y){v.XB(12);
break}V=g.f4(y).entityId;return g.F(v,iZ(N.T,V),14);case 14:return L=v.T,L.offlineDeleteReason="OFFLINE_DELETE_REASON_PARENT_LIST_DELETE",g.F(v,UW(V,N.T,{entityKey:y,actionType:p.actionType},N.X,L),12);case 12:x=h.next();v.XB(11);break;case 10:return g.F(v,H_Q(W,(T=X)!=null?T:"SD"),16);case 16:return E=v.T,g.F(v,W5C(E),17);case 17:m=fVE(E);if(!N.aj.U("woffle_enable_main_downloads_library")){v.XB(18);break}if(W){v.XB(19);break}return g.F(v,s90(N.T,g.YW),19);case 19:return g.F(v,j90(N.T,[g.YW]),18);
case 18:if((H=m)==null?0:H.length)for(Q=g.z(m),n=Q.next();!n.done;n=Q.next())if(d=K=n.value,D=d.actionType,u=d.entityKey,oH=d.actionMetadata,D&&u&&oH&&!g.t(oH,HEY)){D==="OFFLINE_ORCHESTRATION_ACTION_TYPE_DELETE"&&(oH.offlineLoggingData={offlineDeleteReason:"OFFLINE_DELETE_REASON_PARENT_LIST_DELETE"});if(bX=g.t(K.actionMetadata,qB))bX.playlistId="DOWNLOADS_LIST_ENTITY_ID_SMART_DOWNLOADS",K.actionMetadata=Object.assign({},K.actionMetadata,{mainVideoEntityActionMetadata:bX});O.push(K)}g.Bg(v,7);break;
case 6:return I=g.zd(v),A="OFFLINE_OPERATION_FAILURE_REASON_UNKNOWN",k="OFFLINE_ORCHESTRATION_FAILURE_REASON_DATABASE_OPERATION_FAILED",I instanceof g.V9&&I.type==="QUOTA_EXCEEDED"&&(A="OFFLINE_OPERATION_FAILURE_REASON_DATABASE_REQUEST_FAILED",k="OFFLINE_ORCHESTRATION_FAILURE_REASON_NO_STORAGE"),v.return(new Kg("OFFLINE_ORCHESTRATION_ACTION_RESULT_FAILURE",S,void 0,A,k));case 7:return v.return(new Kg("OFFLINE_ORCHESTRATION_ACTION_RESULT_SUCCESS",S,O))}})},ast=function(){Dr.apply(this,arguments);
this.W="mainVideoEntity"},QFy=function(N,p,S){p=p===void 0?43200:p;
S=S===void 0?!0:S;var O=O===void 0?!1:O;var P,W,X;return g.r(function(l){switch(l.B){case 1:if(!N.N.K7())return l.return([]);P=[];g.vg(l,2);return g.F(l,mOq(p,S,O),4);case 4:P=l.T;g.Bg(l,3);break;case 2:W=g.zd(l),W instanceof Error&&W.message==="No data"||W instanceof Error&&W.message==="Empty response body"&&Xv(W.message);case 3:return X=WTB(N,P,S,"mainPlaylistEntity"),l.return(X)}})},geB=function(N,p,S,O){O=O===void 0?!1:O;
var P,W,X,l,b,h,x,y,V,L,T,E,m,H,Q;return g.r(function(n){switch(n.B){case 1:return P=[],g.F(n,UOR(),2);case 2:return(W=n.T)||O?g.F(n,i_f(p,S),3):n.return([]);case 3:X=n.T;if((l=X)==null||!l.length)return n.return([]);b={offlineDeleteReason:"OFFLINE_DELETE_REASON_PARENT_LIST_REFRESH"};h=g.z(X);x=h.next();case 4:if(x.done){n.XB(6);break}V=y=x.value;L=V.actionType;T=V.entityKey;E=V.actionMetadata;if(!(L&&T&&E)||g.t(E,HEY)){n.XB(5);break}L==="OFFLINE_ORCHESTRATION_ACTION_TYPE_DELETE"&&(E.offlineLoggingData=
b);m=g.f4(T);H=m.entityId;return g.F(n,Zr(N,[H],"mainVideoEntity",L,E),8);case 8:Q=n.T,P=P.concat(Q);case 5:x=h.next();n.XB(4);break;case 6:return n.return(P)}})},c4Q=function(N,p){this.T=N;
this.X=p},ned=function(N,p){var S,O,P,W,X,l,b,h,x,y,V,L,T,E,m,H;
return g.r(function(Q){switch(Q.B){case 1:return S=hT(p),O=g.f4(p.entityKey),P=O.entityId,W=[],g.vg(Q,2),g.F(Q,FTq(N,P),4);case 4:W=Q.T;if((X=W)==null||!X.length){Q.XB(5);break}return g.F(Q,L5d(N.T,p.entityKey),5);case 5:g.Bg(Q,3);break;case 2:return l=g.zd(Q),b="OFFLINE_OPERATION_FAILURE_REASON_UNKNOWN",h="OFFLINE_ORCHESTRATION_FAILURE_REASON_DATABASE_OPERATION_FAILED",l instanceof g.V9&&l.type==="QUOTA_EXCEEDED"&&(b="OFFLINE_OPERATION_FAILURE_REASON_DATABASE_REQUEST_FAILED",h="OFFLINE_ORCHESTRATION_FAILURE_REASON_NO_STORAGE"),
Q.return(new Kg("OFFLINE_ORCHESTRATION_ACTION_RESULT_FAILURE",S,void 0,b,h));case 3:return x=[],g.F(Q,DCB(N.T,"musicTrack",W),7);case 7:W=Q.T;if(W.length)for(y=g.z(W),V=y.next();!V.done;V=y.next())if(L=V.value,T=L.offlineVideoData,E=void 0,(E=T)==null?0:E.videoId)m=void 0,H=Number(((m=p.actionMetadata)==null?void 0:m.priority)||0)+1,x.push(MB("OFFLINE_ORCHESTRATION_ACTION_TYPE_ADD",T.videoId,"musicTrack",H,NR,cG(p,T,P)));return Q.return(new Kg("OFFLINE_ORCHESTRATION_ACTION_RESULT_SUCCESS",S,x))}})},
r4s=function(N,p){var S,O,P,W,X,l,b,h,x,y,V,L,T,E,m,H,Q,n,K,d,D,u,oH,bX,I,A,k,v,w,Zb,Tf,bG,iX,o0,xs,k5,U,a,c,M,G,N6,Wg,O_,Y,jA,Td,XG,re,XB,Gf,h1,we,M_,bH,Mp,Km,et,Ei;
return g.r(function(A1){switch(A1.B){case 1:return S=hT(p),O=p.entityKey,P=g.f4(O).entityId,W=[],X=!1,P==="!*$_ALL_ENTITIES_!*$"?(X=!0,g.F(A1,og(N.T,"musicAlbumRelease"),5)):g.F(A1,pg(N.T,O,"musicAlbumRelease"),4);case 4:(l=A1.T)&&W.push(l);A1.XB(3);break;case 5:W=A1.T;case 3:if((b=W)==null||!b.length)return A1.return(new Kg("OFFLINE_ORCHESTRATION_ACTION_RESULT_SUCCESS",S));if(X){h=[];x=g.z(W);for(y=x.next();!y.done;y=x.next())V=y.value,L=g.f4(V.id).entityId,h.push(MB("OFFLINE_ORCHESTRATION_ACTION_TYPE_REFRESH",
L,"musicAlbumRelease",0,NR));return A1.return(new Kg("OFFLINE_ORCHESTRATION_ACTION_RESULT_SUCCESS",S,h))}T=[];E=W[0];m=void 0;if(!E.downloadMetadata){A1.XB(6);break}return g.F(A1,pg(N.T,E.downloadMetadata,"musicAlbumReleaseDownloadMetadataEntity"),7);case 7:H=A1.T,m=Number((n=(Q=H)==null?void 0:Q.addedTimestampMillis)!=null?n:"0")/1E3;case 6:return g.vg(A1,8),g.F(A1,FTq(N,P,(K=m)==null?void 0:K.toString()),10);case 10:T=A1.T;g.Bg(A1,9);break;case 8:d=g.zd(A1);if(!(d instanceof Error&&d.message===
"No data")){if(d instanceof Error&&d.message==="Empty response body")Xv(d.message);else return D="OFFLINE_OPERATION_FAILURE_REASON_UNKNOWN",u="OFFLINE_ORCHESTRATION_FAILURE_REASON_DATABASE_OPERATION_FAILED",d instanceof g.V9&&d.type==="QUOTA_EXCEEDED"&&(D="OFFLINE_OPERATION_FAILURE_REASON_DATABASE_REQUEST_FAILED",u="OFFLINE_ORCHESTRATION_FAILURE_REASON_NO_STORAGE"),A1.return(new Kg("OFFLINE_ORCHESTRATION_ACTION_RESULT_FAILURE",S,void 0,D,u));A1.XB(9);break}return g.F(A1,QD(P,"musicAlbumRelease",N.T,
p,N.X),9);case 9:oH=[];bX=new Map;if((I=T)==null?0:I.length)for(A=g.z(T),k=A.next();!k.done;k=A.next())v=k.value,w=v.offlineVideoData,Zb=void 0,((Zb=w)==null?0:Zb.videoId)&&bX.set(w.videoId,w);Tf=new Map;bG=[];if((iX=E)==null?0:(o0=iX.tracks)==null?0:o0.length)for(xs=g.z(E.tracks),k5=xs.next();!k5.done;k5=xs.next())if(U=k5.value,a=g.f4(U).entityId)bX.has(a)?(Tf.set(a,bX.get(a)),bX.delete(a)):bG.push(a);M=Number(((c=p.actionMetadata)==null?void 0:c.priority)||0)+1;G=g.z(bX.entries());for(N6=G.next();!N6.done;N6=
G.next())Wg=N6.value,O_=g.z(Wg),Y=O_.next().value,jA=O_.next().value,Td=Y,XG=jA,oH.push(MB("OFFLINE_ORCHESTRATION_ACTION_TYPE_ADD",Td,"musicTrack",M,NR,cG(p,XG)));re=g.z(Tf.entries());for(XB=re.next();!XB.done;XB=re.next())Gf=XB.value,h1=g.z(Gf),we=h1.next().value,M_=h1.next().value,bH=we,Mp=M_,oH.push(MB("OFFLINE_ORCHESTRATION_ACTION_TYPE_REFRESH",bH,"musicTrack",M,NR,cG(p,Mp)));Km=g.z(bG);for(et=Km.next();!et.done;et=Km.next())Ei=et.value,oH.push(MB("OFFLINE_ORCHESTRATION_ACTION_TYPE_DELETE",Ei,
"musicTrack",0,NR));return A1.return(new Kg("OFFLINE_ORCHESTRATION_ACTION_RESULT_SUCCESS",S,oH))}})},MlB=function(N,p){var S,O;
return g.r(function(P){switch(P.B){case 1:return S=hT(p),g.vg(P,2),O=g.f4(p.entityKey).entityId,O==="!*$_ALL_ENTITIES_!*$"?g.F(P,gH(N.T,p,N.X),5):g.F(P,QD(O,"musicAlbumRelease",N.T,p,N.X),6);case 6:return g.F(P,Txq(N.T,p.entityKey),5);case 5:g.Bg(P,3);break;case 2:return g.zd(P),P.return(new Kg("OFFLINE_ORCHESTRATION_ACTION_RESULT_FAILURE",S,void 0,"OFFLINE_OPERATION_FAILURE_REASON_DATABASE_REQUEST_FAILED","OFFLINE_ORCHESTRATION_FAILURE_REASON_DATABASE_OPERATION_FAILED"));case 3:return P.return(new Kg("OFFLINE_ORCHESTRATION_ACTION_RESULT_SUCCESS",
S))}})},FTq=function(N,p,S){var O,P,W;
return g.r(function(X){switch(X.B){case 1:return g.F(X,$Ot([p]),2);case 2:return O=X.T,g.F(X,KTV(N,O[0],S),3);case 3:return P=X.T,W=BG(P.thumbnailDetails),g.F(X,mU(W),4);case 4:return X.return(O[0].videos)}})},KTV=function(N,p,S){var O,P,W,X,l,b,h,x,y,V,L,T,E,m;
return g.r(function(H){if(H.B==1){O=p.additionalMetadadatas;P=void 0;if(O&&O.length>0)for(W=g.z(O),X=W.next();!X.done;X=W.next())if(l=X.value,l.offlineMusicPlaylistData){P=l.offlineMusicPlaylistData;break}b=p.playlistId;h=vQ0(p);x=h.uJ;y=h.TC;V=S?(Number(S)*1E3).toString():Date.now().toString();L=p.lastModifiedTimestamp?(Number(p.lastModifiedTimestamp)*1E3).toString():"0";T={id:g.l0(b,"musicAlbumReleaseDownloadMetadataEntity"),trackDownloadMetadatas:y,lastModifiedTimestampMillis:L,addedTimestampMillis:V,
syncState:"DOWNLOAD_SYNC_STATE_UP_TO_DATE"};E={id:g.l0(b,"musicAlbumRelease"),title:p.title,audioPlaylistId:b,trackCount:p.totalVideoCount,tracks:x,downloadMetadata:T.id};P&&(E.thumbnailDetails=(m=P.albumHqThumbnail)!=null?m:P.albumArtistThumbnail,E.artistDisplayName=P.albumArtistDisplayName,E.releaseDate=P.albumReleaseDate,E.contentRating={explicitType:P.albumReleaseExplicitType},E.releaseType=P.albumReleaseType);return g.F(H,q3(N.T,{mode:"readwrite",Hj:!0},function(Q){var n=I4(Q,E,"musicAlbumRelease");
Q=I4(Q,T,"musicAlbumReleaseDownloadMetadataEntity");return g.$H.all([n,Q])}),2)}return H.return(E)})},YOG=function(N,p){this.T=N;
this.X=p},dvV=function(N,p){var S,O,P,W,X,l,b,h,x,y,V,L,T,E,m,H;
return g.r(function(Q){switch(Q.B){case 1:return S=hT(p),O=g.f4(p.entityKey),P=O.entityId,W=[],g.vg(Q,2),g.F(Q,Ges(N,P),4);case 4:W=Q.T;if((X=W)==null||!X.length){Q.XB(5);break}return g.F(Q,L5d(N.T,p.entityKey),5);case 5:g.Bg(Q,3);break;case 2:return l=g.zd(Q),b="OFFLINE_OPERATION_FAILURE_REASON_UNKNOWN",h="OFFLINE_ORCHESTRATION_FAILURE_REASON_DATABASE_OPERATION_FAILED",l instanceof g.V9&&l.type==="QUOTA_EXCEEDED"&&(b="OFFLINE_OPERATION_FAILURE_REASON_DATABASE_REQUEST_FAILED",h="OFFLINE_ORCHESTRATION_FAILURE_REASON_NO_STORAGE"),
Q.return(new Kg("OFFLINE_ORCHESTRATION_ACTION_RESULT_FAILURE",S,void 0,b,h));case 3:return x=[],g.F(Q,DCB(N.T,"musicTrack",W),7);case 7:W=Q.T;if(W.length)for(y=g.z(W),V=y.next();!V.done;V=y.next())if(L=V.value,T=L.offlineVideoData,E=void 0,(E=T)==null?0:E.videoId)m=void 0,H=Number(((m=p.actionMetadata)==null?void 0:m.priority)||0)+1,x.push(MB("OFFLINE_ORCHESTRATION_ACTION_TYPE_ADD",T.videoId,"musicTrack",H,pY,cG(p,T,P)));return Q.return(new Kg("OFFLINE_ORCHESTRATION_ACTION_RESULT_SUCCESS",S,x))}})},
e2G=function(N,p){var S,O,P,W,X,l,b,h,x,y,V,L,T,E,m,H,Q,n,K,d,D,u,oH,bX,I,A,k,v,w,Zb,Tf,bG,iX,o0,xs,k5,U,a,c,M,G,N6,Wg,O_,Y,jA,Td,XG,re,XB,Gf,h1,we,M_,bH,Mp,Km,et,Ei,A1,wh,CB,xB,r4,Fp,hV,Mw,n8,nZ,Ws,$Y;
return g.r(function(Os){switch(Os.B){case 1:return S=hT(p),O=p.entityKey,P=g.f4(O).entityId,W=[],X=!1,P==="!*$_ALL_ENTITIES_!*$"?(X=!0,g.F(Os,og(N.T,"musicPlaylist"),5)):g.F(Os,pg(N.T,O,"musicPlaylist"),4);case 4:(l=Os.T)&&W.push(l);Os.XB(3);break;case 5:W=Os.T;case 3:if((b=W)==null||!b.length)return Os.return(new Kg("OFFLINE_ORCHESTRATION_ACTION_RESULT_SUCCESS",S));h=g.t(p.actionMetadata,BxQ);y=(x=h)==null?void 0:x.autoSync;V=[];T=L=!0;E=!1;m=void 0;if(!X&&y===!1){Os.XB(6);break}g.vg(Os,7);return g.F(Os,
aVE(0,!!y,!0,W),9);case 9:V=Os.T;g.Bg(Os,8);break;case 7:H=g.zd(Os);if(!(H instanceof Error&&H.message==="No data")){H instanceof Error&&H.message==="Empty response body"&&Xv(H.message);Os.XB(8);break}return P==="!*$_ALL_ENTITIES_!*$"?g.F(Os,gH(N.T,p,N.X),8):g.F(Os,QD(P,"musicPlaylist",N.T,p,N.X),8);case 8:if(!V.length||!X&&V[0].playlistId!==P)return Os.return(new Kg("OFFLINE_ORCHESTRATION_ACTION_RESULT_SUCCESS",S));case 6:if(X){Q=[];n=g.z(V);for(K=n.next();!K.done;K=n.next())d=K.value,d.upToDate||
y&&!d.shouldAutoSyncMetadata||!d.playlistId||(D={autoSync:y},Q.push(MB("OFFLINE_ORCHESTRATION_ACTION_TYPE_REFRESH",d.playlistId,"musicPlaylist",0,pY,{musicPlaylistEntityActionMetadata:D})));return Os.return(new Kg("OFFLINE_ORCHESTRATION_ACTION_RESULT_SUCCESS",S,Q))}V.length&&(u=V[0],E=!!u.upToDate,y&&(L=(oH=u.shouldAutoSyncMetadata)!=null?oH:!0,T=(bX=u.shouldAutoSyncVideos)!=null?bX:!0,u.checkInSeconds&&(m=u.checkInSeconds)));if(E||!L)return Os.return(new Kg("OFFLINE_ORCHESTRATION_ACTION_RESULT_SUCCESS",
S));I=[];A=W[0];k=void 0;if(!A.downloadMetadata){Os.XB(15);break}return g.F(Os,pg(N.T,A.downloadMetadata,"musicPlaylistDownloadMetadataEntity"),16);case 16:v=Os.T,k=Number((Zb=(w=v)==null?void 0:w.addedTimestampMillis)!=null?Zb:"0")/1E3;case 15:return g.vg(Os,17),g.F(Os,Ges(N,P,(Tf=k)==null?void 0:Tf.toString(),m),19);case 19:I=Os.T;g.Bg(Os,18);break;case 17:bG=g.zd(Os);if(!(bG instanceof Error&&bG.message==="No data")){if(bG instanceof Error&&bG.message==="Empty response body")Xv(bG.message);else return iX=
"OFFLINE_OPERATION_FAILURE_REASON_UNKNOWN",o0="OFFLINE_ORCHESTRATION_FAILURE_REASON_DATABASE_OPERATION_FAILED",bG instanceof g.V9&&bG.type==="QUOTA_EXCEEDED"&&(iX="OFFLINE_OPERATION_FAILURE_REASON_DATABASE_REQUEST_FAILED",o0="OFFLINE_ORCHESTRATION_FAILURE_REASON_NO_STORAGE"),Os.return(new Kg("OFFLINE_ORCHESTRATION_ACTION_RESULT_FAILURE",S,void 0,iX,o0));Os.XB(18);break}return g.F(Os,QD(P,"musicPlaylist",N.T,p,N.X),18);case 18:if(!T)return Os.return(new Kg("OFFLINE_ORCHESTRATION_ACTION_RESULT_SUCCESS",
S));xs=[];k5=new Map;if((U=I)==null?0:U.length)for(a=g.z(I),c=a.next();!c.done;c=a.next())M=c.value,G=M.offlineVideoData,N6=void 0,((N6=G)==null?0:N6.videoId)&&k5.set(G.videoId,G);Wg=new Map;O_=[];if((Y=A)==null?0:(jA=Y.tracks)==null?0:jA.length)for(Td=g.z(A.tracks),XG=Td.next();!XG.done;XG=Td.next())if(re=XG.value,XB=g.f4(re).entityId)k5.has(XB)?(Wg.set(XB,k5.get(XB)),k5.delete(XB)):O_.push(XB);h1=Number(((Gf=p.actionMetadata)==null?void 0:Gf.priority)||0)+1;we=g.z(k5.entries());for(M_=we.next();!M_.done;M_=
we.next())bH=M_.value,Mp=g.z(bH),Km=Mp.next().value,et=Mp.next().value,Ei=Km,A1=et,xs.push(MB("OFFLINE_ORCHESTRATION_ACTION_TYPE_ADD",Ei,"musicTrack",h1,pY,cG(p,A1)));wh=g.z(Wg.entries());for(CB=wh.next();!CB.done;CB=wh.next())xB=CB.value,r4=g.z(xB),Fp=r4.next().value,hV=r4.next().value,Mw=Fp,n8=hV,xs.push(MB("OFFLINE_ORCHESTRATION_ACTION_TYPE_REFRESH",Mw,"musicTrack",h1,pY,cG(p,n8)));nZ=g.z(O_);for(Ws=nZ.next();!Ws.done;Ws=nZ.next())$Y=Ws.value,xs.push(MB("OFFLINE_ORCHESTRATION_ACTION_TYPE_DELETE",
$Y,"musicTrack",0,pY));return Os.return(new Kg("OFFLINE_ORCHESTRATION_ACTION_RESULT_SUCCESS",S,xs))}})},CSY=function(N,p){var S,O;
return g.r(function(P){switch(P.B){case 1:return S=hT(p),g.vg(P,2),O=g.f4(p.entityKey).entityId,O==="!*$_ALL_ENTITIES_!*$"?g.F(P,gH(N.T,p,N.X),5):g.F(P,QD(O,"musicPlaylist",N.T,p,N.X),6);case 6:return g.F(P,Txq(N.T,p.entityKey),5);case 5:g.Bg(P,3);break;case 2:return g.zd(P),P.return(new Kg("OFFLINE_ORCHESTRATION_ACTION_RESULT_FAILURE",S,void 0,"OFFLINE_OPERATION_FAILURE_REASON_DATABASE_REQUEST_FAILED","OFFLINE_ORCHESTRATION_FAILURE_REASON_DATABASE_OPERATION_FAILED"));case 3:return P.return(new Kg("OFFLINE_ORCHESTRATION_ACTION_RESULT_SUCCESS",
S))}})},Ges=function(N,p,S,O){var P,W,X;
return g.r(function(l){switch(l.B){case 1:return g.F(l,$Ot([p]),2);case 2:return P=l.T,g.F(l,A4G(N,P[0],S,O),3);case 3:return W=l.T,X=BG(W.thumbnailDetails),g.F(l,mU(X),4);case 4:return l.return(P[0].videos)}})},A4G=function(N,p,S,O){var P,W,X,l,b,h,x,y,V;
return g.r(function(L){return L.B==1?(P=p.playlistId,W=vQ0(p),X=W.uJ,l=W.TC,b=S?(Number(S)*1E3).toString():Date.now().toString(),h=p.lastModifiedTimestamp?(Number(p.lastModifiedTimestamp)*1E3).toString():"0",x={id:g.l0(P,"musicPlaylistDownloadMetadataEntity"),trackDownloadMetadatas:l,lastModifiedTimestampMillis:h,addedTimestampMillis:b,syncState:"DOWNLOAD_SYNC_STATE_UP_TO_DATE"},y={id:g.l0(P,"musicPlaylist"),title:p.title,playlistId:P,thumbnailDetails:p.thumbnail,visibility:tlC(p),trackCount:p.totalVideoCount,
tracks:X,downloadMetadata:x.id},O&&(((V=y)==null?0:V.entityMetadata)?y.entityMetadata.nextAutoRefreshIntervalSeconds=String(O):y&&(y.entityMetadata={nextAutoRefreshIntervalSeconds:String(O)})),g.F(L,q3(N.T,{mode:"readwrite",Hj:!0},function(T){var E=I4(T,y,"musicPlaylist");T=I4(T,x,"musicPlaylistDownloadMetadataEntity");return g.$H.all([E,T])}),2)):L.return(y)})},tlC=function(N){switch(N.privacy){case "PRIVATE":return"PLAYLIST_ENTITY_VISIBILITY_PRIVATE";
case "PUBLIC":return"PLAYLIST_ENTITY_VISIBILITY_PUBLIC";case "UNLISTED":return"PLAYLIST_ENTITY_VISIBILITY_UNLISTED";default:return"PLAYLIST_ENTITY_VISIBILITY_UNKNOWN"}},uiY=function(N,p){this.T=N;
this.X=p},DvR=function(N,p){var S,O,P,W,X,l,b,h,x,y,V,L,T;
return g.r(function(E){switch(E.B){case 1:return S=hT(p),O=g.f4(p.entityKey),P=O.entityId,W=g.t(p.actionMetadata,wFt),g.vg(E,2),g.F(E,R2y(N,P,void 0,(X=W)==null?void 0:X.track,(l=W)==null?void 0:l.albumRelease),4);case 4:if((b=W)==null?0:b.playlistId){E.XB(5);break}return g.F(E,L5d(N.T,p.entityKey),5);case 5:g.Bg(E,3);break;case 2:return h=g.zd(E),x="OFFLINE_OPERATION_FAILURE_REASON_UNKNOWN",y="OFFLINE_ORCHESTRATION_FAILURE_REASON_DATABASE_OPERATION_FAILED",h instanceof g.V9&&h.type==="QUOTA_EXCEEDED"&&
(x="OFFLINE_OPERATION_FAILURE_REASON_DATABASE_REQUEST_FAILED",y="OFFLINE_ORCHESTRATION_FAILURE_REASON_NO_STORAGE"),E.return(new Kg("OFFLINE_ORCHESTRATION_ACTION_RESULT_FAILURE",S,void 0,x,y));case 3:L=Number(((V=p.actionMetadata)==null?void 0:V.priority)||0)+1;var m=(m=g.t(p.actionMetadata,wFt))?{playbackDataActionMetadata:{maximumDownloadQuality:m.maximumDownloadQuality}}:void 0;T=MB("OFFLINE_ORCHESTRATION_ACTION_TYPE_ADD",P,"playbackData",L,Isl,m);return E.return(new Kg("OFFLINE_ORCHESTRATION_ACTION_RESULT_SUCCESS",
S,[T]))}})},ZEC=function(N,p){var S,O,P,W,X,l,b,h,x,y,V,L,T,E,m;
return g.r(function(H){switch(H.B){case 1:return S=hT(p),O=g.f4(p.entityKey),P=O.entityId,g.F(H,pg(N.T,p.entityKey,"musicTrack"),2);case 2:W=H.T;if(!W){X=void 0;H.XB(3);break}return g.F(H,pg(N.T,W.downloadMetadata,"musicTrackDownloadMetadataEntity"),4);case 4:X=H.T;case 3:l=X;if(!W||!l)return H.return(new Kg("OFFLINE_ORCHESTRATION_ACTION_RESULT_SUCCESS",S));h=g.t(p.actionMetadata,wFt);g.vg(H,5);return g.F(H,R2y(N,P,l.addedTimestampMillis,(x=h)==null?void 0:x.track,(y=h)==null?void 0:y.albumRelease),
7);case 7:L=Number(((V=p.actionMetadata)==null?void 0:V.priority)||0)+1;b=MB("OFFLINE_ORCHESTRATION_ACTION_TYPE_REFRESH",P,"playbackData",L,Isl);g.Bg(H,6);break;case 5:T=g.zd(H);if(!(T instanceof Error&&T.message==="No data")){if(T instanceof Error&&T.message==="Empty response body")Xv(T.message);else return E="OFFLINE_OPERATION_FAILURE_REASON_UNKNOWN",m="OFFLINE_ORCHESTRATION_FAILURE_REASON_DATABASE_OPERATION_FAILED",T instanceof g.V9&&T.type==="QUOTA_EXCEEDED"&&(E="OFFLINE_OPERATION_FAILURE_REASON_DATABASE_REQUEST_FAILED",
m="OFFLINE_ORCHESTRATION_FAILURE_REASON_NO_STORAGE"),H.return(new Kg("OFFLINE_ORCHESTRATION_ACTION_RESULT_FAILURE",S,void 0,E,m));H.XB(6);break}return g.F(H,ag(P,N.T,p,N.X),6);case 6:return H.return(new Kg("OFFLINE_ORCHESTRATION_ACTION_RESULT_SUCCESS",S,b?[b]:void 0))}})},keG=function(N,p){var S,O;
return g.r(function(P){switch(P.B){case 1:return S=hT(p),g.vg(P,2),O=g.f4(p.entityKey).entityId,O==="!*$_ALL_ENTITIES_!*$"?g.F(P,gH(N.T,p,N.X),5):g.F(P,ag(O,N.T,p,N.X),6);case 6:return g.F(P,Txq(N.T,p.entityKey),5);case 5:g.Bg(P,3);break;case 2:return g.zd(P),P.return(new Kg("OFFLINE_ORCHESTRATION_ACTION_RESULT_FAILURE",S,void 0,"OFFLINE_OPERATION_FAILURE_REASON_DATABASE_REQUEST_FAILED","OFFLINE_ORCHESTRATION_FAILURE_REASON_DATABASE_OPERATION_FAILED"));case 3:return P.return(new Kg("OFFLINE_ORCHESTRATION_ACTION_RESULT_SUCCESS",
S))}})},R2y=function(N,p,S,O,P){var W,X,l,b,h,x;
return g.r(function(y){switch(y.B){case 1:if(W=O){y.XB(2);break}return g.F(y,EQE([p]),3);case 3:X=y.T,l=X[0],W=VXs(l);case 2:return g.F(y,qOV(N,W,p,P,S),4);case 4:b=y.T;h=b.musicTrackEntity;x=b.DY;var V=BG(h.thumbnailDetails),L=[];x&&(L=BG(x.thumbnailDetails));return g.F(y,mU(V.concat(L)),0)}})},qOV=function(N,p,S,O,P){var W;
return g.r(function(X){return X.B==1?(P||(P=Date.now().toString()),W={id:g.l0(S,"musicTrackDownloadMetadataEntity"),playbackData:g.l0(S,"playbackData"),addedTimestampMillis:P,videoDownloadContextEntity:g.l0(S,"videoDownloadContextEntity")},O&&(p.albumRelease=O.id),g.F(X,q3(N.T,{mode:"readwrite",Hj:!0},function(l){var b=[],h=I4(l,W,"musicTrackDownloadMetadataEntity");b.push(h);h=I4(l,p,"musicTrack");b.push(h);O&&(l=I4(l,O,"musicAlbumRelease"),b.push(l));return g.$H.all(b)}),2)):X.B!=3?g.F(X,Lg(S,"musicTrackDownloadMetadataEntity",
N.T,"DOWNLOAD_STATE_PENDING_DOWNLOAD"),3):X.return({musicTrackEntity:p,
DY:O})})},os=function(){Dr.apply(this,arguments);
this.W="musicTrack"},NEl=function(N,p,S){p=p===void 0?43200:p;
S=S===void 0?!0:S;var O=O===void 0?!1:O;var P,W;return g.r(function(X){switch(X.B){case 1:if(!N.N.K7())return X.return([]);P=[];g.vg(X,2);return g.F(X,aVE(p,S,O),4);case 4:P=X.T;g.Bg(X,3);break;case 2:g.zd(X);case 3:return W=WTB(N,P,S,"musicPlaylist"),X.return(W)}})},pbE=function(){g.dg.apply(this,arguments);
var N=this;this.events=new g.Ke(this);this.aj=this.player.J();this.Rc={ykH:function(){return N.T},
f5:function(){return N.f5()},
gI:function(p){return N.gI(p)}}},ocQ=function(N){var p;
N=g.t((p=N.getWatchNextResponse())==null?void 0:p.currentVideoEndpoint,g.PC);if(N==null?0:N.playlistId)var S=N.playlistId;return S},SHV=function(N,p){var S,O,P,W;
return g.r(function(X){if(X.B==1){S=p.clientPlaybackNonce;O={cpn:S,offlineSourceVisualElement:g.$k(p.xO||"").getAsJson(),selectedOfflineMode:"OFFLINE_NOW",isPartialPlayback:!1};p.B&&(O.videoFmt=Number(p.B.itag));p.G&&(O.audioFmt=Number(p.G.itag));if((P=ocQ(p))&&p.videoId){var l=p.videoId;l=P!=="PPSV"?Promise.resolve(!1):N.T.xt(l);X=g.F(X,l,3)}else X=X.XB(2);return X}X.B!=2&&(W=X.T)&&(O.selectedOfflineMode="OFFLINE_MODE_TYPE_AUTO_OFFLINE");N.B=S;g.le("offlinePlaybackStarted",O);g.Ls(X)})};
g.B(dr,G1);g.Pg.Object.defineProperties(dr.prototype,{entityMetadata:{configurable:!0,enumerable:!0,get:function(){return this.T.entityMetadata},
set:function(N){this.T.entityMetadata=N}}});
g.B(ppd,dr);ppd.prototype.B=function(){return[]};
g.B(ohf,dr);ohf.prototype.B=function(){return[]};
g.B(SSB,dr);SSB.prototype.B=function(){return[]};
g.B(O8E,dr);O8E.prototype.B=function(){var N=[];this.T.alternateChannel&&N.push(this.T.alternateChannel);this.T.alternateChannelList&&N.push.apply(N,g.J(this.T.alternateChannelList));this.T.oneofChannelEntity&&N.push(this.T.oneofChannelEntity);return[].concat(g.J(new Set(N)))};
g.B(PWC,dr);PWC.prototype.B=function(){var N=[];this.T.entryCollection&&N.push(this.T.entryCollection);return[].concat(g.J(new Set(N)))};
g.B(Wny,G1);Wny.prototype.B=function(){var N=[];this.T.video&&N.push(this.T.video);return[].concat(g.J(new Set(N)))};
g.B(XpB,dr);XpB.prototype.B=function(){var N=[];this.T.parentPlaylist&&N.push(this.T.parentPlaylist);if(this.T.entries)for(var p=g.z(this.T.entries),S=p.next();!S.done;S=p.next())N.push.apply(N,g.J((new Wny(S.value)).B()));return[].concat(g.J(new Set(N)))};
g.B(fjB,dr);fjB.prototype.B=function(){var N=[];this.T.descriptionEntity&&N.push(this.T.descriptionEntity);this.T.creators&&N.push.apply(N,g.J(this.T.creators));this.T.theBiggestFan&&N.push(this.T.theBiggestFan);return[].concat(g.J(new Set(N)))};
g.B(ljB,dr);ljB.prototype.B=function(){return[]};
g.B(b8f,dr);b8f.prototype.B=function(){return[]};
g.B(jnl,dr);jnl.prototype.B=function(){return[]};
g.B(sn0,dr);sn0.prototype.B=function(){return[]};
g.B(h8E,dr);h8E.prototype.B=function(){return[]};
g.B(x8Y,dr);x8Y.prototype.B=function(){return[]};
g.B(yOt,dr);yOt.prototype.B=function(){return[]};
g.B(VZR,dr);VZR.prototype.B=function(){return[]};
g.B(LnV,dr);LnV.prototype.B=function(){return[]};
g.B(TuC,dr);TuC.prototype.B=function(){var N=[];this.T.downloadsList&&N.push(this.T.downloadsList);this.T.smartDownloadsList&&N.push(this.T.smartDownloadsList);this.T.recommendedDownloadsList&&N.push(this.T.recommendedDownloadsList);this.T.refresh&&N.push(this.T.refresh);return[].concat(g.J(new Set(N)))};
g.B(vhf,G1);vhf.prototype.B=function(){var N=[];this.T.video&&N.push(this.T.video);this.T.playlist&&N.push(this.T.playlist);this.T.videoItem&&N.push(this.T.videoItem);this.T.playlistItem&&N.push(this.T.playlistItem);return[].concat(g.J(new Set(N)))};
g.B(BuY,dr);BuY.prototype.B=function(){var N=[];this.T.refresh&&N.push(this.T.refresh);if(this.T.downloads)for(var p=g.z(this.T.downloads),S=p.next();!S.done;S=p.next())N.push.apply(N,g.J((new vhf(S.value)).B()));return[].concat(g.J(new Set(N)))};
g.B(z8s,dr);z8s.prototype.B=function(){var N=[];this.T.localImageEntities&&N.push.apply(N,g.J(this.T.localImageEntities));return[].concat(g.J(new Set(N)))};
g.B(EhE,dr);EhE.prototype.B=function(){var N=[];this.T.playbackData&&N.push(this.T.playbackData);this.T.localImageEntities&&N.push.apply(N,g.J(this.T.localImageEntities));this.T.videoDownloadContextEntity&&N.push(this.T.videoDownloadContextEntity);return[].concat(g.J(new Set(N)))};
g.B($8G,dr);$8G.prototype.B=function(){return[]};
g.B(JOy,dr);JOy.prototype.B=function(){var N=[];this.T.fakeChildren&&N.push.apply(N,g.J(this.T.fakeChildren));return[].concat(g.J(new Set(N)))};
g.B(m8q,dr);m8q.prototype.B=function(){var N=[];this.T.video&&N.push(this.T.video);this.T.playbackData&&N.push(this.T.playbackData);this.T.offlineVideoPolicy&&N.push(this.T.offlineVideoPolicy);return[].concat(g.J(new Set(N)))};
g.B(U8t,dr);U8t.prototype.B=function(){return[]};
g.B(H8l,dr);H8l.prototype.B=function(){var N=[];this.T.channelOwner&&N.push(this.T.channelOwner);this.T.videos&&N.push.apply(N,g.J(this.T.videos));this.T.collaboratorChannels&&N.push.apply(N,g.J(this.T.collaboratorChannels));this.T.downloadState&&N.push(this.T.downloadState);this.T.refresh&&N.push(this.T.refresh);return[].concat(g.J(new Set(N)))};
g.B(i8Q,dr);i8Q.prototype.B=function(){var N=[];this.T.video&&N.push(this.T.video);this.T.channelContributor&&N.push(this.T.channelContributor);return[].concat(g.J(new Set(N)))};
g.B(ajE,G1);ajE.prototype.B=function(){var N=[];this.T.localImageEntities&&N.push.apply(N,g.J(this.T.localImageEntities));this.T.videoDownloadContextEntity&&N.push(this.T.videoDownloadContextEntity);return[].concat(g.J(new Set(N)))};
g.B(QnB,G1);QnB.prototype.B=function(){var N=[];this.T.recommendedVideoMetadata&&N.push.apply(N,g.J((new ajE(this.T.recommendedVideoMetadata)).B()));return[].concat(g.J(new Set(N)))};
g.B(ght,G1);ght.prototype.B=function(){var N=[];this.T.playbackPosition&&N.push(this.T.playbackPosition);return[].concat(g.J(new Set(N)))};
g.B(cOy,dr);cOy.prototype.B=function(){var N=[];this.T.owner&&N.push(this.T.owner);this.T.downloadState&&N.push(this.T.downloadState);this.T.userState&&N.push.apply(N,g.J((new ght(this.T.userState)).B()));this.T.additionalMetadata&&N.push.apply(N,g.J((new QnB(this.T.additionalMetadata)).B()));return[].concat(g.J(new Set(N)))};
g.B(Fnt,dr);Fnt.prototype.B=function(){var N=[];this.T.userChannelDetails&&N.push(this.T.userChannelDetails);return[].concat(g.J(new Set(N)))};
g.B(nhQ,dr);nhQ.prototype.B=function(){var N=[];this.T.channelOwner&&N.push(this.T.channelOwner);this.T.playbackPosition&&N.push(this.T.playbackPosition);this.T.localImageEntities&&N.push.apply(N,g.J(this.T.localImageEntities));this.T.downloadStatus&&N.push(this.T.downloadStatus);return[].concat(g.J(new Set(N)))};
g.B(rOB,dr);rOB.prototype.B=function(){return[]};
g.B(MZC,dr);MZC.prototype.B=function(){return[]};
g.B(Knq,dr);Knq.prototype.B=function(){return[]};
g.B(YSf,dr);YSf.prototype.B=function(){return[]};
g.B(GzB,dr);GzB.prototype.B=function(){return[]};
g.B(d8R,dr);d8R.prototype.B=function(){return[]};
g.B(e8y,dr);e8y.prototype.B=function(){return[]};
g.B(CWR,dr);CWR.prototype.B=function(){return[]};
g.B(AOE,dr);AOE.prototype.B=function(){return[]};
g.B(tZE,dr);tZE.prototype.B=function(){return[]};
g.B(uAq,dr);uAq.prototype.B=function(){var N=[];this.T.trackDownloadMetadatas&&N.push.apply(N,g.J(this.T.trackDownloadMetadatas));return[].concat(g.J(new Set(N)))};
g.B(wpC,dr);
wpC.prototype.B=function(){var N=[];this.T.downloadedTracks&&N.push.apply(N,g.J(this.T.downloadedTracks));this.T.smartDownloadedTracks&&N.push.apply(N,g.J(this.T.smartDownloadedTracks));this.T.downloadedEpisodes&&N.push.apply(N,g.J(this.T.downloadedEpisodes));this.T.downloadedAlbumReleases&&N.push.apply(N,g.J(this.T.downloadedAlbumReleases));this.T.smartDownloadedAlbumReleases&&N.push.apply(N,g.J(this.T.smartDownloadedAlbumReleases));this.T.downloadedPlaylists&&N.push.apply(N,g.J(this.T.downloadedPlaylists));this.T.smartDownloadedPlaylists&&
N.push.apply(N,g.J(this.T.smartDownloadedPlaylists));this.T.metadataOnlyTracks&&N.push.apply(N,g.J(this.T.metadataOnlyTracks));return[].concat(g.J(new Set(N)))};
g.B(R80,dr);R80.prototype.B=function(){var N=[];this.T.trackDownloadMetadatas&&N.push.apply(N,g.J(this.T.trackDownloadMetadatas));return[].concat(g.J(new Set(N)))};
g.B(IjR,dr);IjR.prototype.B=function(){var N=[];this.T.playbackData&&N.push(this.T.playbackData);this.T.localImageEntities&&N.push.apply(N,g.J(this.T.localImageEntities));this.T.videoDownloadContextEntity&&N.push(this.T.videoDownloadContextEntity);return[].concat(g.J(new Set(N)))};
g.B(D8s,dr);D8s.prototype.B=function(){var N=[];this.T.musicLibraryStatusEntity&&N.push(this.T.musicLibraryStatusEntity);this.T.primaryArtists&&N.push.apply(N,g.J(this.T.primaryArtists));this.T.details&&N.push(this.T.details);this.T.userDetails&&N.push(this.T.userDetails);this.T.tracks&&N.push.apply(N,g.J(this.T.tracks));this.T.share&&N.push(this.T.share);this.T.downloadMetadata&&N.push(this.T.downloadMetadata);this.T.refresh&&N.push(this.T.refresh);return[].concat(g.J(new Set(N)))};
g.B(Z8C,dr);Z8C.prototype.B=function(){var N=[];this.T.albumRelease&&N.push(this.T.albumRelease);this.T.tracks&&N.push.apply(N,g.J(this.T.tracks));return[].concat(g.J(new Set(N)))};
g.B(kzR,dr);kzR.prototype.B=function(){var N=[];this.T.albumRelease&&N.push(this.T.albumRelease);return[].concat(g.J(new Set(N)))};
g.B(qSy,dr);qSy.prototype.B=function(){var N=[];this.T.details&&N.push(this.T.details);this.T.userDetails&&N.push(this.T.userDetails);return[].concat(g.J(new Set(N)))};
g.B(N8t,dr);N8t.prototype.B=function(){var N=[];this.T.parentArtist&&N.push(this.T.parentArtist);return[].concat(g.J(new Set(N)))};
g.B(p_l,dr);p_l.prototype.B=function(){var N=[];this.T.parentArtist&&N.push(this.T.parentArtist);return[].concat(g.J(new Set(N)))};
g.B(o4d,dr);o4d.prototype.B=function(){return[]};
g.B(SZy,dr);SZy.prototype.B=function(){return[]};
g.B(OHy,G1);OHy.prototype.B=function(){var N=[];this.T.creatorEntity&&N.push(this.T.creatorEntity);return[].concat(g.J(new Set(N)))};
g.B(PiC,dr);
PiC.prototype.B=function(){var N=[];this.T.tracks&&N.push.apply(N,g.J(this.T.tracks));this.T.refresh&&N.push(this.T.refresh);this.T.musicLibraryStatusEntity&&N.push(this.T.musicLibraryStatusEntity);this.T.details&&N.push(this.T.details);this.T.downloadMetadata&&N.push(this.T.downloadMetadata);this.T.sideloadMetadata&&N.push(this.T.sideloadMetadata);this.T.userDetails&&N.push(this.T.userDetails);this.T.entryCollection&&N.push(this.T.entryCollection);this.T.share&&N.push(this.T.share);this.T.podcastShowAdditionalMetadata&&N.push.apply(N,
g.J((new OHy(this.T.podcastShowAdditionalMetadata)).B()));return[].concat(g.J(new Set(N)))};
g.B(WP0,dr);WP0.prototype.B=function(){return[]};
g.B(X_d,dr);
X_d.prototype.B=function(){var N=[];this.T.musicLibraryStatusEntity&&N.push(this.T.musicLibraryStatusEntity);this.T.artists&&N.push.apply(N,g.J(this.T.artists));this.T.audioModeVersion&&N.push(this.T.audioModeVersion);this.T.videoModeVersion&&N.push(this.T.videoModeVersion);this.T.userDetails&&N.push(this.T.userDetails);this.T.details&&N.push(this.T.details);this.T.albumRelease&&N.push(this.T.albumRelease);this.T.share&&N.push(this.T.share);this.T.libraryEdit&&N.push(this.T.libraryEdit);this.T.downloadMetadata&&
N.push(this.T.downloadMetadata);this.T.playbackPosition&&N.push(this.T.playbackPosition);this.T.lyrics&&N.push(this.T.lyrics);return[].concat(g.J(new Set(N)))};
g.B(fxB,dr);fxB.prototype.B=function(){var N=[];this.T.parentTrack&&N.push(this.T.parentTrack);return[].concat(g.J(new Set(N)))};
g.B(lxY,dr);lxY.prototype.B=function(){var N=[];this.T.parentTrack&&N.push(this.T.parentTrack);return[].concat(g.J(new Set(N)))};
g.B(bHR,dr);bHR.prototype.B=function(){return[]};
g.B(j2t,dr);j2t.prototype.B=function(){return[]};
g.B(s2y,dr);s2y.prototype.B=function(){return[]};
g.B(hJq,dr);hJq.prototype.B=function(){return[]};
g.B(xqR,dr);xqR.prototype.B=function(){var N=[];this.T.transfer&&N.push(this.T.transfer);this.T.adsPlaybackData&&N.push.apply(N,g.J(this.T.adsPlaybackData));this.T.drmLicense&&N.push(this.T.drmLicense);this.T.offlineVideoPolicy&&N.push(this.T.offlineVideoPolicy);this.T.videoDownloadContextEntity&&N.push(this.T.videoDownloadContextEntity);return[].concat(g.J(new Set(N)))};
g.B(ynl,dr);ynl.prototype.B=function(){return[]};
g.B(VLE,dr);VLE.prototype.B=function(){var N=[];this.T.offlineVideoStreams&&N.push.apply(N,g.J(this.T.offlineVideoStreams));this.T.captionTrack&&N.push.apply(N,g.J(this.T.captionTrack));return[].concat(g.J(new Set(N)))};
g.B(LPt,dr);LPt.prototype.B=function(){return[]};
g.B(T8B,dr);T8B.prototype.B=function(){return[]};
g.B(v4G,dr);v4G.prototype.B=function(){return[]};
g.B(B8V,dr);B8V.prototype.B=function(){return[]};
g.B(zJf,dr);zJf.prototype.B=function(){return[]};
g.B(E4f,dr);E4f.prototype.B=function(){return[]};
g.B($qQ,dr);$qQ.prototype.B=function(){return[]};
g.B(Jnd,dr);Jnd.prototype.B=function(){return[]};
g.B(mqs,dr);mqs.prototype.B=function(){return[]};
g.B(UqR,dr);UqR.prototype.B=function(){return[]};
g.B(HHf,dr);HHf.prototype.B=function(){return[]};
g.B(iHR,dr);iHR.prototype.B=function(){return[]};
g.B(axY,dr);axY.prototype.B=function(){return[]};
g.B(Q2R,dr);Q2R.prototype.B=function(){return[]};
g.B(g4Y,dr);g4Y.prototype.B=function(){return[]};
g.B(cns,dr);cns.prototype.B=function(){return[]};
g.B(FPt,dr);FPt.prototype.B=function(){return[]};
var Q9f=["browse","music/browse","unplugged/browse"],rIC=["offline/playlist_sync_check"],zXB=["offline"],gQy=["offline/offline_video_playback_position_sync"],F5R=["offline/get_playback_data_entity"],e6;Cj.getInstance=function(){return g.r(function(N){return N.return(new Promise(function(p){g.kH().then(function(S){S?(Cj.instance||(Cj.instance=new Cj(S)),p(Cj.instance)):p(void 0)})}))})};
Cj.prototype.get=function(N){var p=this,S,O,P;return g.r(function(W){if(W.B==1)return g.F(W,KPy(p.token),2);if(W.B!=3)return S=W.T,g.F(W,S.get("prefs",N),3);O=W.T;if(!O)return W.return();P=(0,g.Hm)();return O.expirationTimestampMs<=P?W.return():W.return(O.value)})};
Cj.prototype.set=function(N,p,S){S=S===void 0?31536E3:S;var O=this,P,W,X;return g.r(function(l){if(l.B==1)return P=(0,g.Hm)(),W={key:N,value:p,expirationTimestampMs:P+S*1E3},g.F(l,KPy(O.token),2);X=l.T;return g.F(l,g.FL(X,"prefs",W),0)})};
Cj.prototype.remove=function(N){var p=this,S;return g.r(function(O){if(O.B==1)return g.F(O,KPy(p.token),2);S=O.T;return g.F(O,S.delete("prefs",N),0)})};
g.B(Ai,g.wp);g.B(ti,Cif);ti.prototype.X=function(N,p){p=tLG(p);N=(new TextEncoder).encode(JSON.stringify(N));return this.T.encrypt(N,p)};
ti.prototype.B=function(N,p){if(!(N instanceof Uint8Array))throw YZC(1);var S=new TextDecoder;p=tLG(p);N=this.T.decrypt(N,p);return JSON.parse(S.decode(N))};
var uIB={accountLinkStatusEntity:jnl,booleanEntity:SSB,buttonEntity:UqR,captionTrack:bHR,channelHandle:ppd,commerceAcquisitionClientPayloadEntity:iHR,commerceCartListEntity:axY,contextNoteFeedEntityPayload:ohf,continuationTokenEntity:U8t,downloadQualityPickerEntity:yOt,downloadsPageRefreshTokenEntity:LnV,downloadsPageViewConfigurationEntity:rOB,downloadStatusEntity:VZR,sfvAudioItemCurrentlyPlayingEntity:T8B,emojiFountainDataEntity:Jnd,emojiCustomizationSetEntity:$qQ,fakeChannel:O8E,fakePlaylist:PWC,
fakePlaylistEntryCollection:XpB,fakeVideo:fjB,fakeVideoDescription:ljB,featuredProductsEntity:CWR,flowStateEntity:b8f,iconBadgeEntity:Q2R,interstitialInteractionStateEntity:h8E,liveChatPollStateEntity:x8Y,liveReactionsDataEntity:mqs,logoEntity:sn0,macroMarkerEntity:MZC,mainDownloadsLibraryEntity:TuC,mainDownloadsListEntity:BuY,mainPlaylistDownloadStateEntity:z8s,mainPlaylistEntity:H8l,mainPlaylistVideoEntity:i8Q,mainVideoDownloadStateEntity:EhE,mainVideoEntity:cOy,markersEngagementPanelSyncEntity:Knq,
markersVisibilityOverrideEntity:YSf,musicAlbumReleaseDetail:Z8C,musicAlbumReleaseDownloadMetadataEntity:uAq,musicAlbumRelease:D8s,musicAlbumReleaseUserDetail:kzR,musicArtistDetail:N8t,musicArtist:qSy,musicArtistUserDetail:p_l,musicDownloadsLibraryEntity:wpC,musicLibraryEdit:o4d,musicLibraryStatusEntity:SZy,musicPlaylist:PiC,musicPlaylistDownloadMetadataEntity:R80,musicShare:WP0,musicTrackDetail:fxB,musicTrackDownloadMetadataEntity:IjR,musicTrack:X_d,musicTrackUserDetail:lxY,offlineOrchestrationActionWrapperEntity:j2t,
offlineVideoPolicy:s2y,offlineVideoStreams:hJq,offlineabilityEntity:$8G,orchestrationWebSamplingEntity:JOy,pageHeaderEntity:zJf,pdpStateEntity:g4Y,pinnedProductEntity:AOE,playbackData:xqR,playerStateEntity:GzB,quantityIncrementerEntity:cns,refresh:ynl,saveToPlaylistListEntity:v4G,settingEntity:B8V,suggestedFeedbackChipStateEntity:d8R,transfer:VLE,trendingOfferEntity:tZE,videoDownloadContextEntity:LPt,videoOverviewAsyncDataEntity:FPt,videoPlaybackPositionEntity:HHf,votingEntity:E4f,ytMainChannelEntity:Fnt,
youchatPendingResponseEntity:e8y,ytMainDownloadedVideoEntity:m8q,ytMainVideoEntity:nhQ};g.B(Z5,Cif);Z5.prototype.X=function(N){return N};
Z5.prototype.B=function(N){if(N instanceof Uint8Array)throw YZC(0);return N};
g.B(kX,g.e);kX.prototype.observe=function(N){var p=this;this.observers.push(N);return function(){var S=p.observers.indexOf(N);S>=0&&p.observers.splice(S,1)}};
kX.prototype.B=function(N){Wzf(this,N.data)};
kX.prototype.BP=function(){this.channel.close()};
var jSt,XcE=new g.UH("elementsCommand");var HG=new g.UH("entityBatchUpdate");var IXC=new g.UH("downloadStatusEntity");var sFE=new g.UH("mainPlaylistEntityActionMetadata");var qB=new g.UH("mainVideoEntityActionMetadata");var BxQ=new g.UH("musicPlaylistEntityActionMetadata");var wFt=new g.UH("musicTrackEntityActionMetadata");var HEY=new g.UH("localImageEntityActionMetadata");var Y2=new g.UH("playbackDataActionMetadata");var fUf=new g.UH("transferEntityActionMetadata");var wc0=new g.UH("videoPlaybackPositionEntityActionMetadata");var UCq;new g.mj;new g.mj;ggC.prototype.request=function(N,p,S){p=p===void 0?{}:p;return this.locks.request(N,p,function(O){return S(O)})};var WG=g.M6.caches,PG,Mp0;OW.prototype.open=function(N){return WG.open(ngB(N))};
OW.prototype.has=function(N){return WG.has(ngB(N))};
OW.prototype.delete=function(N){return WG.delete(ngB(N))};
OW.prototype.match=function(N,p){var S=this,O,P,W,X,l,b;return g.r(function(h){switch(h.B){case 1:return g.F(h,S.keys(),2);case 2:O=h.T,P=g.z(O),W=P.next();case 3:if(W.done){h.XB(5);break}X=W.value;return g.F(h,S.open(X),6);case 6:return l=h.T,g.F(h,l.match(N,p),7);case 7:if(b=h.T)return h.return(b);W=P.next();h.XB(3);break;case 5:return h.return()}})};
g.B(Fzl,OW);Fzl.prototype.keys=function(){var N,p,S,O,P,W,X,l,b;return g.r(function(h){if(h.B==1)return N=[],p=g.RR("CacheStorage keys"),g.F(h,WG.keys(),2);S=h.T;O=g.z(S);for(P=O.next();!P.done;P=O.next()){W=P.value;var x=W.indexOf(":");X=x===-1?{u3:W}:{u3:W.substring(0,x),datasyncId:W.substring(x+1)};l=X.u3;b=X.datasyncId;b===p&&N.push(l)}return h.return(N)})};g.B(fg,g.e);fg.prototype.X=function(N){this.api.YO("onOfflineOperationFailure",N.data)};
fg.prototype.G=function(N){this.api.publish("offlinetransferpause",N.data)};
fg.prototype.BP=function(){var N;(N=this.T)==null||N.close();var p;(p=this.B)==null||p.close()};GPE.prototype.cG=function(){this.T&&bZ(this)};
GPE.prototype.UD=function(){this.B&&this.B.resolve();this.X=this.T=!1;this.W()};var JYf=["OFFLINE_ORCHESTRATION_ACTION_TYPE_ADD","OFFLINE_ORCHESTRATION_ACTION_TYPE_REFRESH"];var O_l="captionTrack downloadStatusEntity ytMainChannelEntity mainPlaylistEntity mainPlaylistDownloadStateEntity mainPlaylistVideoEntity mainVideoEntity mainVideoDownloadStateEntity offlineVideoPolicy offlineVideoStreams playbackData transfer videoDownloadContextEntity videoPlaybackPositionEntity".split(" ");var yIl="downloadStatusEntity musicAlbumRelease musicDownloadsLibraryEntity musicPlaylist musicTrack musicTrackDownloadMetadataEntity offlineVideoPolicy offlineVideoStreams playbackData transfer videoDownloadContextEntity".split(" ");g.B(K5Q,rH);K5Q.prototype.B=function(N){return x2(N)?dOY(this,N):yD(N)?AIE(this,N):Promise.reject(Error("Unsupported action type: "+N.actionType))};g.B(tXQ,rH);tXQ.prototype.B=function(N){return yD(N)?uXf(this,N):RTB(N)?RXl(this,N):VD(N)?IVy(this,N):Promise.reject(Error("Unsupported action type: "+N.actionType))};g.f=DOV.prototype;g.f.UpP=function(N){var p=this,S,O,P,W;return g.r(function(X){if(!g.Z(N.state,128))return X.XB(0);S=N.state.Lg;var l=(O=S)==null?void 0:O.errorCode,b=(P=S)==null?void 0:P.OI;W=l==="net.connect"&&b===1?"TRANSFER_FAILURE_REASON_NETWORK_LOST":(l==null?0:l.startsWith("net."))?"TRANSFER_FAILURE_REASON_NETWORK":"TRANSFER_FAILURE_REASON_INTERNAL";return g.F(X,p.xH(p.player.getVideoData().videoId,W),0)})};
g.f.xH=function(N,p){var S=this;return g.r(function(O){if(O.B==1){if(S.B)return O.return();S.B=!0;return p==="TRANSFER_FAILURE_REASON_NETWORK_LOST"?(eE(S,N,!1,!0),O.XB(0)):g.F(O,dH(S,N),3)}g.H7(N,4);return g.F(O,S.T.xH(p),0)})};
g.f.J2=function(N){N.status===2?(N.status!==this.X&&(wJG(this.T),g.H7(N.videoId,2)),N.jh&&ksV(this.T,N.videoId,N.jh)):N.status===4?(dH(this,N.videoId),this.xH(N.videoId,N.HR?"TRANSFER_FAILURE_REASON_FILESYSTEM_WRITE":"TRANSFER_FAILURE_REASON_INTERNAL")):N.status===1&&Z$R(this.T);this.X=N.status;this.api.YO("localmediachange",{videoId:N.videoId,status:N.status})};
g.f.zr=function(){var N=this,p;return g.r(function(S){if(S.B==1){if(N.B)return S.return();N.B=!0;p=N.player.getVideoData().videoId;return g.F(S,dH(N,p),2)}return g.F(S,N.T.zr(),0)})};
g.f.Ud=function(N){switch(N){case "HD_1080":return"hd1080";case "HD":return"hd720";case "SD":return"large";case "LD":return"tiny";default:return"hd720"}};
g.f.U=function(N){return this.api.J().U(N)};g.B(SIt,rH);SIt.prototype.B=function(N){return x2(N)?PLl(this,N):yD(N)?WWl(this,N):RTB(N)?XJR(this,N):Promise.reject(Error("Unsupported action type: "+N.actionType))};hnQ.prototype.T=function(N,p){var S=N.action.actionMetadata.priority-p.action.actionMetadata.priority;S===0&&(N.T<p.T?S=-1:N.T>p.T&&(S=1));return S};g.B(Cg,g.e);Cg.prototype.BP=function(){this.W&&this.W();g.e.prototype.BP.call(this)};
Cg.prototype.createAction=function(N,p){var S=g.f4(N.entityKey).entityType,O=g.E8(16);return new zV(S,O,N,p.actionId,p.rootActionId)};
Cg.prototype.zk=function(N){var p=this,S,O,P,W,X,l,b,h,x;return g.r(function(y){if(y.B==1){if(p.wH())return y.return();O=(S=N.offlineOrchestrationActionWrapperEntity)!=null?S:new Set;P=[];W=g.z(O);for(X=W.next();!X.done;X=W.next())l=X.value,b=g.f4(l),h=b.entityId,VCs(p.T,h)||P.push(l);return g.F(y,H$B(p,P),2)}x=y.T;return g.F(y,U7d(p,x),0)})};
Cg.prototype.retry=function(){var N=this;return g.r(function(p){return g.F(p,i$d(N),0)})};g.B(AT,g.e);AT.prototype.BP=function(){this.B&&this.B();g.e.prototype.BP.call(this)};
AT.prototype.X=function(N){var p=this,S,O,P,W,X,l,b,h;return g.r(function(x){O=(S=N.transfer)!=null?S:new Set;P=[];W=g.z(O);for(X=W.next();!X.done;X=W.next())l=X.value,b=g.f4(l),h=b.entityId,P.push(h);return P.length===0?x.return():g.F(x,n6B(p,P),0)})};g.B(GsQ,g.e);g.f=GsQ.prototype;g.f.BP=function(){this.py&&this.py();this.eS.dispose();this.G.dispose();this.i_&&g.ZM(this.N.Gd,this.i_);this.Qd&&g.ZM(this.N.Gd,this.Qd);g.e.prototype.BP.call(this)};
g.f.nKp=function(N){var p=this,S,O,P;return g.r(function(W){switch(W.B){case 1:S=g.l0(N,"transfer");if(p.T&&S===p.T.key){eE(p.j,p.K,!0);p.G.stop();W.XB(0);break}return g.F(W,q3(p.B,{mode:"readwrite",Hj:!0},function(X){return u6(X,S,"transfer").then(function(l){if(l&&l.transferState!=="TRANSFER_STATE_COMPLETE"&&l.transferState!=="TRANSFER_STATE_FAILED")return l.transferState="TRANSFER_STATE_PAUSED_BY_USER",I4(X,l,"transfer").then(function(){return l})})}),3);
case 3:O=W.T;if(!O){W.XB(0);break}if(!N||!p.X){W.XB(5);break}return g.F(W,Lg(N,p.X,p.B,"DOWNLOAD_STATE_PAUSED"),5);case 5:return g.F(W,wH(p,N),7);case 7:P=W.T,uCd({videoId:N,YS:O,offlineModeType:P}),g.Ls(W)}})};
g.f.ZGP=function(){var N=this;if(this.T&&this.K){eE(this.j,this.K,!1);var p=this.T,S=(p==null?0:p.key)?g.f4(p.key).entityId:"";S&&this.X&&(new Promise(function(O,P){Lg(S,N.X,N.B,"DOWNLOAD_STATE_PAUSED").catch(function(W){P(W)})})).catch(function(O){Xv("Download state setting error",O)})}this.G.stop()};
g.f.ll=function(){this.T?CLV(this,this.T):uZ(this)};
g.f.aL=function(N){var p=this;return g.r(function(S){switch(S.B){case 1:if(!p.T){S.XB(2);break}if(p.T.transferState==="TRANSFER_STATE_COMPLETE"||p.T.transferState==="TRANSFER_STATE_FAILED"||!N.transfer||!N.transfer.has(p.T.key)){S.XB(3);break}return g.F(S,pg(p.B,p.T.key,"transfer"),4);case 4:p.T=S.T;if(p.T){S.XB(3);break}return g.F(S,AYG(p),3);case 3:if(p.T)return S.return();case 2:return g.F(S,uZ(p),0)}})};
g.f.xH=function(N,p){var S=this,O,P,W,X,l;return g.r(function(b){switch(b.B){case 1:if(!S.T){Rg(S,"onTransferFailure: "+N);b.XB(2);break}O=S.T;W=((P=O)==null?0:P.key)?g.f4(O.key).entityId:"";a:switch(N){case "TRANSFER_FAILURE_REASON_FILESYSTEM_WRITE":case "TRANSFER_FAILURE_REASON_EXTERNAL_FILESYSTEM_WRITE":case "TRANSFER_FAILURE_REASON_PLAYABILITY":case "TRANSFER_FAILURE_REASON_TOO_MANY_RETRIES":var h=!1;break a;default:h=!0}return h&&qIy(S)?g.F(b,Ig(S,"TRANSFER_STATE_TRANSFER_IN_QUEUE"),8):g.F(b,
NFQ(S,N),5);case 5:if(!W||!S.X){b.XB(2);break}return g.F(b,Lg(W,S.X,S.B,"DOWNLOAD_STATE_FAILED"),2);case 8:return g.F(b,wH(S,W),9);case 9:X=b.T;sW({transferStatusType:"TRANSFER_STATUS_TYPE_REENQUEUED_BY_RETRY"},{videoId:W,YS:O,offlineModeType:X});if(!W||!S.X){b.XB(2);break}return g.F(b,Lg(W,S.X,S.B,"DOWNLOAD_STATE_RETRYABLE_FAILURE"),2);case 2:tT(S),l=uZ(S,!0),p&&p(l),g.Ls(b)}})};
g.f.zr=function(N){var p=this,S,O,P,W,X,l,b,h,x,y,V,L;return g.r(function(T){switch(T.B){case 1:if(!p.T){Rg(p,"onMaybeTransferStreamsExpired");T.XB(2);break}return qIy(p)?g.F(T,Ig(p,"TRANSFER_STATE_WAITING_FOR_PLAYER_RESPONSE_REFRESH"),9):g.F(T,NFQ(p,"TRANSFER_FAILURE_REASON_STREAM_MISSING"),5);case 5:if(!p.X){T.XB(2);break}S=p.T;P=((O=S)==null?0:O.key)?g.f4(S.key).entityId:"";if(!P){T.XB(2);break}return g.F(T,Lg(P,p.X,p.B,"DOWNLOAD_STATE_FAILED"),2);case 9:return p.T||Rg(p,"onMaybeTransferStreamsExpiredRetryAttempting"),
W=p.T,l=((X=W)==null?0:X.key)?g.f4(W.key).entityId:"",g.F(T,wH(p,l),10);case 10:return b=T.T,sW({transferStatusType:"TRANSFER_STATUS_TYPE_DEQUEUED_BY_PLAYER_RESPONSE_EXPIRATION"},{videoId:l,YS:W,offlineModeType:b}),h=kPl(),g.dO(h,Y2,{isEnqueuedForExpiredStreamUrlRefetch:!0}),x=g.l0(l,"playbackData"),y={actionType:"OFFLINE_ORCHESTRATION_ACTION_TYPE_ADD",entityKey:x,actionMetadata:h},V=$2(new zV("playbackData",l,y)),g.F(T,NB(p.B,V,"offlineOrchestrationActionWrapperEntity"),2);case 2:tT(p),L=uZ(p,!0),
N&&N(L),g.Ls(T)}})};
var O6G={},pFR=(O6G.TRANSFER_STATE_TRANSFERRING=1,O6G.TRANSFER_STATE_TRANSFER_IN_QUEUE=2,O6G);g.f=Dr.prototype;g.f.Zf=function(){return this.K.promise};
g.f.k5=function(){if(this.B&&this.j)return this.K.promise;OEl(this).then(this.K.resolve).catch(this.K.reject);return this.K.promise};
g.f.Dz=function(N){var p={};return p.playbackData=new K5Q(N,this.aj,this.T),p.transfer=new SIt(N,this.aj),p.videoPlaybackPositionEntity=new tXQ(N,this.aj),p};
g.f.wP=function(){var N=this;return g.r(function(p){return N.B?g.F(p,d7G(N.B),0):p.XB(0)})};
g.f.s6=function(){var N=this,p,S;return g.r(function(O){if(O.B==1)return N.B||N.j?g.F(O,N.Zf(),2):O.return();N.Y!==void 0&&(g.T0(N.Y),N.Y=void 0);N.G!==void 0&&(g.T0(N.G),N.G=void 0);(p=N.B)==null||p.dispose();N.B=void 0;(S=N.j)==null||S.dispose();N.j=void 0;N.api.YO("onOrchestrationLostLeader");N.K=new g.mj;g.Ls(O)})};
g.f.isOrchestrationLeader=function(){return this.X.T};
g.f.xt=function(){return g.r(function(N){return N.return(!1)})};
g.f.Io=function(N){var p=this.T;p.api.publish("offlinetransferpause",N);var S;(S=p.B)==null||S.postMessage(N)};
g.f.ll=function(N){var p,S;return g.r(function(O){if(O.B==1)return g.F(O,SE(),2);p=O.T;if(!p)return O.return();S=g.l0(N,"transfer");return g.F(O,q3(p,{mode:"readwrite",Hj:!0},function(P){var W=u6(P,S,"transfer"),X=u6(P,g.l0(N,"videoDownloadContextEntity"),"videoDownloadContextEntity");return g.$H.all([W,X]).then(function(l){l=g.z(l);var b=l.next().value;var h=l.next().value;return b&&b.transferState==="TRANSFER_STATE_PAUSED_BY_USER"?(b.transferState="TRANSFER_STATE_TRANSFER_IN_QUEUE",I4(P,b,"transfer").then(function(){sW({transferStatusType:"TRANSFER_STATUS_TYPE_REENQUEUED_BY_USER_RESUME",
statusType:"USER_RESUMED"},{videoId:N,YS:b,offlineModeType:h==null?void 0:h.offlineModeType});return g.$H.resolve(null)})):g.$H.resolve(null)})}),0)})};
g.f.Bg=function(N){N=N===void 0?43200:N;var p=this,S,O,P,W,X,l,b,h;return g.r(function(x){if(x.B==1)return p.N.K7()?g.F(x,SE(),2):x.return(PSs());if(x.B!=3){S=x.T;if(!S)return x.return([]);O=Date.now()/1E3;return g.F(x,og(S,"offlineVideoPolicy"),3)}P=x.T;W=[];X=g.z(P);for(l=X.next();!l.done;l=X.next())b=l.value,Number(b.lastUpdatedTimestampSeconds)+N<=O&&(h=g.f4(b.key).entityId,W.push(h));return W.length?x.return(Zr(p,W,p.W,"OFFLINE_ORCHESTRATION_ACTION_TYPE_REFRESH")):x.return([])})};
g.f.deleteAll=function(){return Zr(this,["!*$_ALL_ENTITIES_!*$"],this.W,"OFFLINE_ORCHESTRATION_ACTION_TYPE_DELETE",{offlineLoggingData:{offlineDeleteReason:"OFFLINE_DELETE_REASON_USER_INITIATED"}})};
g.f.refreshAllStaleEntities=function(N){var p=this;return g.r(function(S){return S.B==1?g.F(S,p.Bg(N),2):S.return(S.T)})};
g.f.setUpPositionSyncInterval=function(N){var p=this;this.G!==void 0&&(g.T0(this.G),this.G=void 0);var S=N!=null?N:864E5;this.G=g.V0(function(){p.Bs(S)},S)};
g.f.Bs=function(N){var p=this,S,O,P,W,X,l;return g.r(function(b){switch(b.B){case 1:return g.vg(b,2),g.F(b,Cj.getInstance(),4);case 4:S=b.T;if(!S)throw Error("prefStorage is undefined");return g.F(b,S.get("psi"),5);case 5:O=b.T;W=((P=O)==null?0:P.aY)?Number(O.aY)/1E3:0;X=Date.now();if(!(W+N<=X)){b.XB(6);break}return g.F(b,Zr(p,["!*$_ALL_ENTITIES_!*$"],"videoPlaybackPositionEntity","OFFLINE_ORCHESTRATION_ACTION_TYPE_REFRESH"),6);case 6:g.Bg(b,0);break;case 2:l=g.zd(b),Xv("Offline manager error",l),
g.Ls(b)}})};
g.f.iV=function(){var N=this,p,S,O,P,W,X,l;return g.r(function(b){if(b.B==1)return g.F(b,SE(),2);if(b.B!=3)return(p=b.T)?g.F(b,og(p,"transfer"),3):b.return([]);S=b.T;O=[];P=g.z(S);for(W=P.next();!W.done;W=P.next())X=W.value,X.transferState==="TRANSFER_STATE_WAITING_FOR_PLAYER_RESPONSE_REFRESH"&&X.key&&(l=g.f4(X.key).entityId,O.push(l));return b.return(XFq(N,O))})};
g.f.GZ=function(){return g.r(function(N){return N.return([])})};
g.f.GM=function(){return g.r(function(N){g.Ls(N)})};
g.f.UY=function(){return g.r(function(N){g.Ls(N)})};g.B(fsy,rH);fsy.prototype.B=function(N){return x2(N)?jFE(this,N):yD(N)?h2d(this,N):VD(N)?xvQ(this,N):Promise.reject(Error("Unsupported action type: "+N.actionType))};
var k2=[10];g.B(veV,rH);veV.prototype.B=function(N){return x2(N)?EeR(this,N):yD(N)?$vC(this,N):VD(N)?J4l(this,N):Promise.reject(Error("Unsupported action type: "+N.actionType))};
var z2E=[10];g.B(Uvs,rH);Uvs.prototype.B=function(N){return yD(N)?iE0(this,N):Promise.reject(Error("Unsupported action type: "+N.actionType))};g.B(ast,Dr);g.f=ast.prototype;g.f.Dz=function(N){var p=Dr.prototype.Dz.call(this,N);p.mainVideoEntity=new veV(N,this.aj,this.T);p.mainPlaylistEntity=new fsy(N,this.aj,this.T);p.mainDownloadsListEntity=new Uvs(N,this.aj,this.T);return p};
g.f.refreshAllStaleEntities=function(N,p){var S=this,O,P,W,X,l,b,h,x,y,V,L;return g.r(function(T){switch(T.B){case 1:O=[];if(!S.aj.U("web_player_offline_playlist_auto_refresh")){T.XB(2);break}return g.F(T,QFy(S,N,p),3);case 3:O=T.T;case 2:return g.F(T,Cj.getInstance(),4);case 4:return P=T.T,g.F(T,(W=P)==null?void 0:W.get("sdois"),5);case 5:return X=T.T,g.F(T,(l=P)==null?void 0:l.get("lmqf"),6);case 6:b=T.T;if(!X){T.XB(7);break}x=O;y=x.concat;return g.F(T,geB(S,X,(h=b)!=null?h:"SD",N===0),8);case 8:O=
y.call(x,T.T);case 7:return V=O,L=V.concat,g.F(T,Dr.prototype.refreshAllStaleEntities.call(S,N,p),9);case 9:return O=L.call(V,T.T),T.return(O)}})};
g.f.xt=function(N){var p,S,O,P,W,X,l,b;return g.r(function(h){if(h.B==1)return g.F(h,SE(),2);if(h.B!=3)return(p=h.T)?g.F(h,pg(p,g.YW,"mainDownloadsListEntity"),3):h.return(!1);S=h.T;if((O=S)==null?0:(P=O.downloads)==null?0:P.length)for(W=g.l0(N,"mainVideoEntity"),X=g.z(S.downloads),l=X.next();!l.done;l=X.next())if(b=l.value,b.videoItem===W)return h.return(!0);return h.return(!1)})};
g.f.GZ=function(){var N=this,p,S,O,P,W,X,l,b;return g.r(function(h){if(h.B==1)return g.F(h,SE(),2);if(h.B!=3)return(p=h.T)?g.F(h,og(p,"downloadStatusEntity"),3):h.return([]);S=h.T;O=[];P=g.z(S);for(W=P.next();!W.done;W=P.next())X=W.value,X.downloadState==="DOWNLOAD_STATE_USER_DELETED"&&X.key&&(l=g.f4(X.key).entityId,O.push(l));return O.length?(b={offlineLoggingData:{offlineDeleteReason:"OFFLINE_DELETE_REASON_USER_INITIATED"}},h.return(Zr(N,O,"mainVideoEntity","OFFLINE_ORCHESTRATION_ACTION_TYPE_DELETE",
b))):h.return([])})};
g.f.UY=function(){var N;return g.r(function(p){return p.B==1?g.F(p,SE(),2):(N=p.T)?g.F(p,q3(N,{mode:"readwrite",Hj:!0},function(S){return wr(S,"mainVideoEntity").then(function(O){var P=[];O=g.z(O);for(var W=O.next();!W.done;W=O.next()){W=W.value;var X=void 0;(X=W.userState)!=null&&X.playbackPosition||(X=g.f4(W.key).entityId,X={key:g.l0(X,"videoPlaybackPositionEntity"),videoId:X,lastPlaybackPositionSeconds:"0"},P.push(I4(S,X,"videoPlaybackPositionEntity")),W.userState={playbackPosition:X.key},P.push(I4(S,
W,"mainVideoEntity")))}return g.$H.all(P)})}),0):p.return()})};
g.f.GM=function(){var N,p,S,O,P,W,X,l,b,h,x,y,V,L,T,E,m,H,Q,n,K,d,D,u,oH,bX,I,A,k,v,w,Zb,Tf,bG,iX,o0,xs,k5;return g.r(function(U){if(U.B==1)return g.F(U,SE(),2);if(U.B!=3){N=U.T;if(!N)return U.return();p=g.l0("DOWNLOADS_LIST_ENTITY_ID_MANUAL_DOWNLOADS","mainDownloadsListEntity");return g.F(U,q3(N,{mode:"readonly",Hj:!0},function(a){return g.$H.all([u6(a,p,"mainDownloadsListEntity"),u6(a,g.YW,"mainDownloadsListEntity"),wr(a,"mainVideoEntity"),wr(a,"mainPlaylistEntity")])}),3)}S=U.T;
O=g.z(S);P=O.next().value;W=O.next().value;X=O.next().value;l=O.next().value;b=P;h=W;x=X;y=l;V=new Set;if((L=b)==null?0:(T=L.downloads)==null?0:T.length)for(E=g.z(b.downloads),m=E.next();!m.done;m=E.next())H=m.value,Q=void 0,(n=(Q=H.videoItem)!=null?Q:H.playlistItem)&&V.add(n);if((K=h)==null?0:(d=K.downloads)==null?0:d.length)for(D=g.z(h.downloads),u=D.next();!u.done;u=D.next())oH=u.value,oH.videoItem&&V.add(oH.videoItem);bX=new Set;I=[];A=g.z(y);for(k=A.next();!k.done;k=A.next()){v=k.value;if(v.videos)for(w=
g.z(v.videos),Zb=w.next();!Zb.done;Zb=w.next())Tf=Zb.value,(bG=JSON.parse(g.f4(Tf).entityId).videoId)&&bX.add(bG);v.key&&!V.has(v.key)&&I.push(v.key)}iX=g.z(x);for(o0=iX.next();!o0.done;o0=iX.next())xs=o0.value,xs.key&&!V.has(xs.key)&&(k5=g.f4(xs.key).entityId,bX.has(k5)||I.push(xs.key));return I.length?g.F(U,j90(N,I),0):U.XB(0)})};g.B(c4Q,rH);c4Q.prototype.B=function(N){return x2(N)?ned(this,N):yD(N)?r4s(this,N):VD(N)?MlB(this,N):Promise.reject(Error("Unsupported action type: "+N.actionType))};
var NR=[10];g.B(YOG,rH);YOG.prototype.B=function(N){return x2(N)?dvV(this,N):yD(N)?e2G(this,N):VD(N)?CSY(this,N):Promise.reject(Error("Unsupported action type: "+N.actionType))};
var pY=[10];g.B(uiY,rH);uiY.prototype.B=function(N){return x2(N)?DvR(this,N):yD(N)?ZEC(this,N):VD(N)?keG(this,N):Promise.reject(Error("Unsupported action type: "+N.actionType))};
var Isl=[10];g.B(os,Dr);os.prototype.Dz=function(N){var p=Dr.prototype.Dz.call(this,N);p.musicTrack=new uiY(N,this.T);p.musicPlaylist=new YOG(N,this.T);p.musicAlbumRelease=new c4Q(N,this.T);return p};
os.prototype.refreshAllStaleEntities=function(N,p){var S=this,O,P,W;return g.r(function(X){if(X.B==1)return g.F(X,NEl(S,N,p),2);if(X.B!=3)return P=O=X.T,W=P.concat,g.F(X,Dr.prototype.refreshAllStaleEntities.call(S,N,p),3);O=W.call(P,X.T);return X.return(O)})};g.B(pbE,g.dg);g.f=pbE.prototype;g.f.create=function(){var N=this;g.C(this,this.events);g.wN(this.aj)?this.T=new ast(this.aj,this.player):g.eM(this.aj)&&(this.T=new os(this.aj,this.player));this.events.C(this.player,"onPlaybackStartExternal",function(){N.f5()});
this.events.C(this.player,"videodatachange",function(){N.f5()});
this.aj.U("html5_offline_playback_position_sync")&&this.events.C(this.player,"presentingplayerstatechange",this.gI)};
g.f.Vp=function(){return!1};
g.f.nN=function(N,p,S,O){var P=this;return g.r(function(W){return P.T?W.return(Zr(P.T,N,p,S,O)):W.return(Promise.reject())})};
g.f.deleteAll=function(){return this.T.deleteAll()};
g.f.Bg=function(N){return this.T.Bg(N)};
g.f.refreshAllStaleEntities=function(N){return this.T.refreshAllStaleEntities(N)};
g.f.setUpPositionSyncInterval=function(N){this.T.setUpPositionSyncInterval(N)};
g.f.Io=function(N){this.T.Io(N)};
g.f.ll=function(N){return this.T.ll(N)};
g.f.f5=function(){var N=this,p;return g.r(function(S){p=N.player.getVideoData();return g.hp(p)?ocQ(p)&&N.B!==p.clientPlaybackNonce?g.F(S,SHV(N,p),0):S.XB(0):S.return()})};
g.f.gI=function(N){var p=this,S,O,P,W,X,l,b;return g.r(function(h){if(h.B==1)return S=p.player.getVideoData(),O=S.Zb,g.Tt(N,2)||g.Tt(N,512)?g.F(h,SE(),2):h.return();if(h.B!=3){P=h.T;if(!P)return Xv("PES is undefined"),h.return();W=S.videoId;return g.F(h,pg(P,g.l0(W,"mainVideoEntity"),"mainVideoEntity"),3)}X=h.T;if(!X)return h.return();l=Math.floor(O).toString();b={videoPlaybackPositionEntityActionMetadata:{lastPlaybackPositionSeconds:l}};return g.F(h,p.nN([W],"videoPlaybackPositionEntity","OFFLINE_ORCHESTRATION_ACTION_TYPE_UPDATE",
b),0)})};
g.f.isOrchestrationLeader=function(){return this.T.isOrchestrationLeader()};
g.f.updateDownloadState=function(N,p){var S,O,P,W;return g.r(function(X){if(X.B==1)return g.F(X,SE(),2);S=X.T;if(!S)return Xv("PES is undefined"),X.return();O=g.f4(N);P=O.entityType;W=O.entityId;return g.F(X,Lg(W,P,S,p,!0),0)})};g.Gc("offline",pbE);})(_yt_player);
